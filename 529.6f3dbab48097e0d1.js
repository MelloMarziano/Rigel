"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[529],{8529:(no,F,c)=>{c.r(F),c.d(F,{ProductosPageModule:()=>so});var u=c(177),s=c(9417),v=c(5743),b=c(467),l=c(9173),_=c(8032),m=c.n(_),j=c(8359),C=c(4572),p=c(7673),f=c(9172),k=c(152),x=c(5558),o=c(7705);function P(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function I(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function R(i,r){1&i&&(o.j41(0,"div",86)(1,"p",54),o.EFF(2,"No se encontraron productos con los filtros seleccionados."),o.k0s()())}function $(i,r){1&i&&(o.j41(0,"div",108),o.nrm(1,"i",109),o.EFF(2," AGOTADO "),o.k0s())}function y(i,r){1&i&&(o.j41(0,"div",110),o.nrm(1,"i",111),o.EFF(2," STOCK BAJO "),o.k0s())}function S(i,r){if(1&i&&(o.j41(0,"div",105),o.DNE(1,$,3,0,"div",106),o.DNE(2,y,3,0,"div",107),o.k0s()),2&i){const e=o.XpG().$implicit;o.R7$(1),o.Y8G("ngIf",0===(e.stock||0)),o.R7$(1),o.Y8G("ngIf",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0))}}function D(i,r){if(1&i&&o.nrm(0,"div",112),2&i){const e=o.XpG().$implicit;o.AVh("bg-danger",0===(e.stock||0))("bg-warning",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0))}}function G(i,r){if(1&i&&(o.j41(0,"span",113),o.EFF(1),o.k0s()),2&i){const e=o.XpG().$implicit,a=o.XpG();o.R7$(1),o.SpI(" ",a.getFamiliaName(e.categoriaId,e.familiaId)," ")}}function M(i,r){1&i&&o.nrm(0,"i",118)}function w(i,r){1&i&&o.nrm(0,"i",119)}function N(i,r){1&i&&(o.j41(0,"span",123),o.nrm(1,"i",124),o.EFF(2,"\xa1Reponer! "),o.k0s())}function Y(i,r){1&i&&(o.j41(0,"span",125),o.nrm(1,"i",126),o.EFF(2,"Bajo "),o.k0s())}function T(i,r){if(1&i&&(o.j41(0,"div",120)(1,"span",54),o.EFF(2),o.k0s(),o.DNE(3,N,3,0,"span",121),o.DNE(4,Y,3,0,"span",122),o.k0s()),2&i){const e=o.XpG(2).$implicit;o.R7$(2),o.SpI("M\xedn: ",e.stockMinimo||0,""),o.R7$(1),o.Y8G("ngIf",0===(e.stock||0)),o.R7$(1),o.Y8G("ngIf",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0))}}function V(i,r){if(1&i&&(o.j41(0,"div",101)(1,"div",99),o.EFF(2,"Stock (unidades)"),o.k0s(),o.j41(3,"div",114)(4,"span"),o.EFF(5),o.k0s(),o.DNE(6,M,1,0,"i",115),o.DNE(7,w,1,0,"i",116),o.k0s(),o.DNE(8,T,5,3,"div",117),o.k0s()),2&i){const e=o.XpG().$implicit,a=o.XpG();o.R7$(3),o.HbH(a.getStockClass(e)),o.R7$(2),o.JRh(e.stock||0),o.R7$(1),o.Y8G("ngIf",0===(e.stock||0)),o.R7$(1),o.Y8G("ngIf",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0)),o.R7$(1),o.Y8G("ngIf",(e.stock||0)<=(e.stockMinimo||0))}}function A(i,r){1&i&&(o.j41(0,"div",101)(1,"div",99),o.EFF(2,"Tipo"),o.k0s(),o.j41(3,"div",127),o.EFF(4," Receta/Combinado "),o.k0s()())}function B(i,r){1&i&&(o.j41(0,"strong"),o.EFF(1,"\xa1Stock agotado!"),o.k0s())}function J(i,r){1&i&&(o.j41(0,"strong"),o.EFF(1,"Stock bajo"),o.k0s())}function O(i,r){if(1&i&&(o.j41(0,"div",128),o.nrm(1,"i",129),o.j41(2,"small",130),o.DNE(3,B,2,0,"strong",131),o.DNE(4,J,2,0,"strong",131),o.k0s()()),2&i){const e=o.XpG().$implicit;o.AVh("alert-danger",0===(e.stock||0))("alert-warning",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0)),o.R7$(1),o.AVh("bi-exclamation-triangle-fill",0===(e.stock||0))("bi-exclamation-circle-fill",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0)),o.R7$(2),o.Y8G("ngIf",0===(e.stock||0)),o.R7$(1),o.Y8G("ngIf",(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0))}}function z(i,r){if(1&i){const e=o.RV6();o.j41(0,"div",87)(1,"div",88),o.bIt("click",function(){const n=o.eBV(e).$implicit,d=o.XpG();return o.Njj(d.verDetalleProducto(n))}),o.DNE(2,S,3,2,"div",89),o.DNE(3,D,1,4,"div",90),o.j41(4,"div",91)(5,"div",49)(6,"div",30)(7,"h6",92),o.EFF(8),o.k0s(),o.j41(9,"p",93),o.EFF(10),o.k0s(),o.j41(11,"div",94)(12,"span",95),o.EFF(13),o.k0s(),o.DNE(14,G,2,1,"span",96),o.k0s()()(),o.j41(15,"div",97)(16,"div",98)(17,"div",99),o.EFF(18,"Contenido por unidad"),o.k0s(),o.j41(19,"div",100),o.EFF(20),o.k0s()(),o.j41(21,"div",101)(22,"div",99),o.EFF(23,"Costo"),o.k0s(),o.j41(24,"div",102),o.EFF(25),o.nI1(26,"currency"),o.k0s()(),o.DNE(27,V,9,6,"div",103),o.DNE(28,A,5,0,"div",103),o.k0s(),o.DNE(29,O,5,10,"div",104),o.k0s()()()}if(2&i){const e=r.$implicit,a=o.XpG();o.R7$(1),o.xc7("border-width",!e.esCombinado&&(e.stock||0)<=(e.stockMinimo||0)?"2px":"1px"),o.AVh("border-warning",!e.esCombinado&&(e.stock||0)<=(e.stockMinimo||0)&&(e.stock||0)>0)("border-danger",!e.esCombinado&&0===(e.stock||0)),o.R7$(1),o.Y8G("ngIf",!e.esCombinado&&(e.stock||0)<=(e.stockMinimo||0)),o.R7$(1),o.Y8G("ngIf",!e.esCombinado&&(e.stock||0)<=(e.stockMinimo||0)),o.R7$(4),o.AVh("text-danger",!e.esCombinado&&0===(e.stock||0))("text-warning",!e.esCombinado&&(e.stock||0)>0&&(e.stock||0)<=(e.stockMinimo||0))("text-dark",e.esCombinado||(e.stock||0)>(e.stockMinimo||0)),o.R7$(1),o.SpI(" ",e.nombre," "),o.R7$(2),o.JRh(e.descripcion),o.R7$(2),o.Y8G("ngClass",a.getCategoryBadgeClass(e.categoriaId)),o.R7$(1),o.SpI(" ",a.getCategoryName(e.categoriaId)," "),o.R7$(1),o.Y8G("ngIf",e.familiaId),o.R7$(6),o.Lme(" ",e.cantidad," ",e.unidadMedida," "),o.R7$(5),o.SpI(" ",o.ii3(26,25,e.costo,"EUR","symbol","1.2-2")," "),o.R7$(2),o.Y8G("ngIf",!e.esCombinado),o.R7$(1),o.Y8G("ngIf",e.esCombinado),o.R7$(1),o.Y8G("ngIf",!e.esCombinado&&(e.stock||0)<=(e.stockMinimo||0))}}function X(i,r){if(1&i&&(o.j41(0,"span",165),o.nrm(1,"i",166),o.EFF(2),o.k0s()),2&i){const e=o.XpG(2);o.R7$(2),o.SpI(" ",e.getFamiliaName(e.productoSeleccionado.categoriaId,e.productoSeleccionado.familiaId)," ")}}function U(i,r){if(1&i&&(o.j41(0,"div",167)(1,"div",9)(2,"h6",49),o.nrm(3,"i",168),o.EFF(4,"Control de Stock"),o.k0s(),o.j41(5,"div",152)(6,"div",101)(7,"div",169)(8,"div")(9,"small",155),o.EFF(10,"Stock Actual"),o.k0s(),o.j41(11,"h4",170),o.EFF(12),o.k0s()(),o.nrm(13,"i",171),o.k0s()(),o.j41(14,"div",101)(15,"div",169)(16,"div")(17,"small",155),o.EFF(18,"Stock M\xednimo"),o.k0s(),o.j41(19,"h4",172),o.EFF(20),o.k0s()(),o.nrm(21,"i",173),o.k0s()()()()()),2&i){const e=o.XpG(2);o.R7$(11),o.Y8G("ngClass",e.getStockClass(e.productoSeleccionado)),o.R7$(1),o.JRh(e.productoSeleccionado.stock),o.R7$(1),o.Y8G("ngClass",e.getStockClass(e.productoSeleccionado)),o.R7$(7),o.JRh(e.productoSeleccionado.stockMinimo)}}function L(i,r){if(1&i&&(o.j41(0,"div")(1,"small",155),o.EFF(2,"Valor en stock"),o.k0s(),o.j41(3,"strong",174),o.EFF(4),o.nI1(5,"currency"),o.k0s()()),2&i){const e=o.XpG(2);o.R7$(4),o.SpI(" ",o.ii3(5,1,(e.productoSeleccionado.stock||0)*e.productoSeleccionado.costo,"EUR","symbol","1.2-2")," ")}}function Z(i,r){1&i&&(o.j41(0,"div",175),o.nrm(1,"i",176),o.j41(2,"div")(3,"strong"),o.EFF(4,"\xa1Atenci\xf3n!"),o.k0s(),o.EFF(5," El stock actual est\xe1 por debajo o igual al stock m\xednimo. Considera realizar un pedido. "),o.k0s()())}function H(i,r){if(1&i&&(o.j41(0,"div",132)(1,"div",133)(2,"span",134),o.nrm(3,"i",135),o.EFF(4),o.k0s(),o.DNE(5,X,3,1,"span",136),o.j41(6,"span",134),o.nrm(7,"i",137),o.EFF(8),o.k0s()(),o.j41(9,"div",138)(10,"div",139)(11,"div",140)(12,"div",141),o.nrm(13,"i",142),o.j41(14,"h3",143),o.EFF(15),o.nI1(16,"currency"),o.k0s(),o.j41(17,"small",54),o.EFF(18,"Costo"),o.k0s()()()(),o.j41(19,"div",139)(20,"div",144)(21,"div",141),o.nrm(22,"i",145),o.j41(23,"h3",146),o.EFF(24),o.k0s(),o.j41(25,"small",147),o.EFF(26,"IVA"),o.k0s()()()(),o.j41(27,"div",139)(28,"div",148)(29,"div",141),o.nrm(30,"i",149),o.j41(31,"h3",150),o.EFF(32),o.nI1(33,"currency"),o.k0s(),o.j41(34,"small",54),o.EFF(35,"Precio + IVA"),o.k0s()()()()(),o.DNE(36,U,22,4,"div",151),o.j41(37,"div",152)(38,"div",48)(39,"div",153)(40,"div",9)(41,"h6",49),o.nrm(42,"i",154),o.EFF(43,"Informaci\xf3n del Producto"),o.k0s(),o.j41(44,"div",49)(45,"small",155),o.EFF(46,"Contenido por unidad"),o.k0s(),o.j41(47,"strong",156),o.EFF(48),o.k0s(),o.j41(49,"small",157),o.nrm(50,"i",158),o.EFF(51," Cada unidad contiene esta cantidad "),o.k0s()(),o.j41(52,"div",49)(53,"small",155),o.EFF(54,"Proveedor"),o.k0s(),o.j41(55,"div",159),o.nrm(56,"i",160),o.j41(57,"strong"),o.EFF(58),o.k0s()()()()()(),o.j41(59,"div",48)(60,"div",153)(61,"div",9)(62,"h6",49),o.nrm(63,"i",161),o.EFF(64,"An\xe1lisis"),o.k0s(),o.j41(65,"div",49)(66,"small",155),o.EFF(67,"Margen de ganancia"),o.k0s(),o.j41(68,"div",162)(69,"div",163)(70,"strong"),o.EFF(71),o.k0s()()()(),o.DNE(72,L,6,6,"div",131),o.k0s()()()(),o.DNE(73,Z,6,0,"div",164),o.k0s()),2&i){const e=o.XpG();o.R7$(2),o.Y8G("ngClass",e.getCategoryBadgeClass(e.productoSeleccionado.categoriaId)),o.R7$(2),o.SpI(" ",e.getCategoryName(e.productoSeleccionado.categoriaId)," "),o.R7$(1),o.Y8G("ngIf",e.productoSeleccionado.familiaId),o.R7$(1),o.Y8G("ngClass",e.productoSeleccionado.esCombinado?"bg-warning text-dark":"bg-info"),o.R7$(1),o.Y8G("ngClass",e.productoSeleccionado.esCombinado?"bi-cup-straw":"bi-box"),o.R7$(1),o.SpI(" ",e.productoSeleccionado.esCombinado?"Receta/Combinado":"Producto Simple"," "),o.R7$(7),o.JRh(o.ii3(16,19,e.productoSeleccionado.costo,"EUR","symbol","1.2-2")),o.R7$(9),o.SpI("",e.productoSeleccionado.IVA,"%"),o.R7$(8),o.JRh(o.ii3(33,24,e.getPrecioVenta(e.productoSeleccionado),"EUR","symbol","1.2-2")),o.R7$(4),o.Y8G("ngIf",!e.productoSeleccionado.esCombinado),o.R7$(12),o.Lme("",e.productoSeleccionado.cantidad," ",e.productoSeleccionado.unidadMedida,""),o.R7$(10),o.JRh(e.getProveedorName(e.productoSeleccionado.proveedorId)),o.R7$(11),o.xc7("width",e.getMargenPorcentaje(e.productoSeleccionado),"%"),o.BMQ("aria-valuenow",e.getMargenPorcentaje(e.productoSeleccionado)),o.R7$(2),o.SpI("",e.getMargenPorcentaje(e.productoSeleccionado),"%"),o.R7$(1),o.Y8G("ngIf",!e.productoSeleccionado.esCombinado),o.R7$(1),o.Y8G("ngIf",!e.productoSeleccionado.esCombinado&&(e.productoSeleccionado.stock||0)<=(e.productoSeleccionado.stockMinimo||0))}}function q(i,r){1&i&&(o.j41(0,"div",177),o.EFF(1," Este nombre de producto ya existe. "),o.k0s())}function Q(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function K(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function W(i,r){1&i&&(o.j41(0,"small",54),o.EFF(1," Las familias se cargar\xe1n al seleccionar una categor\xeda "),o.k0s())}function oo(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function eo(i,r){if(1&i&&(o.j41(0,"option",85),o.EFF(1),o.k0s()),2&i){const e=r.$implicit;o.Y8G("value",e),o.R7$(1),o.JRh(e)}}function io(i,r){1&i&&(o.j41(0,"div",178)(1,"div",9)(2,"h6",73),o.nrm(3,"i",179),o.EFF(4," Control de Inventario "),o.k0s(),o.j41(5,"div",1)(6,"div",56)(7,"label",50),o.EFF(8," Stock Actual "),o.nrm(9,"i",180),o.k0s(),o.nrm(10,"input",181),o.k0s(),o.j41(11,"div",56)(12,"label",50),o.EFF(13," Stock M\xednimo "),o.nrm(14,"i",182),o.k0s(),o.nrm(15,"input",183),o.k0s()(),o.j41(16,"div",184)(17,"small"),o.nrm(18,"i",185),o.EFF(19," El stock se cuenta en unidades completas del producto. "),o.k0s()()()())}function to(i,r){1&i&&(o.j41(0,"div",186)(1,"div",141),o.nrm(2,"i",187),o.j41(3,"h6",188),o.EFF(4,"Producto Receta/Combinado"),o.k0s(),o.j41(5,"small",54),o.EFF(6," Este producto no maneja stock f\xedsico ya que se prepara con otros ingredientes. "),o.k0s()()())}const ao=[{path:"",component:(()=>{class i{constructor(e,a){this.fb=e,this.firestore=a,this.productos=[],this.filteredProducts=[],this.categorias=[],this.proveedores=[],this.unidadesDisponibles=[],this.familiasDisponibles=[],this.totalProveedores=0,this.totalStockValue=0,this.productosBajosEnStock=0,this.subscriptions=new j.yU,this.productSearch=new s.MJ(""),this.categoryFilter=new s.MJ("all"),this.supplierFilter=new s.MJ("all"),this.productoSeleccionado=null}ngOnInit(){this.productoForm=this.fb.group({id:[""],nombre:["",{validators:[s.k0.required],asyncValidators:[this.productNameValidator()],updateOn:"blur"}],descripcion:["",s.k0.required],costo:[0,[s.k0.required,s.k0.min(0)]],IVA:[0,[s.k0.required,s.k0.min(0)]],categoriaId:["",s.k0.required],familiaId:["",s.k0.required],proveedorId:[null],esCombinado:[!1],stock:[0,s.k0.min(0)],stockMinimo:[0,s.k0.min(0)],cantidad:[0,[s.k0.required,s.k0.min(0)]],unidadMedida:["",s.k0.required]}),this.cargarProductos(),this.cargarCategorias(),this.cargarProveedores();const e=document.getElementById("productModal");e&&(this.modal=new bootstrap.Modal(e));const a=document.getElementById("detalleProductoModal");a&&(this.detalleModal=new bootstrap.Modal(a)),this.subscriptions.add(this.productoForm.get("categoriaId")?.valueChanges.subscribe(t=>{this.onCategoriaChange(t)})),this.subscriptions.add(this.productoForm.get("esCombinado")?.valueChanges.subscribe(t=>{this.onEsCombinadoChange(t)})),this.subscriptions.add((0,C.z)([this.productSearch.valueChanges.pipe((0,f.Z)("")),this.categoryFilter.valueChanges.pipe((0,f.Z)("all")),this.supplierFilter.valueChanges.pipe((0,f.Z)("all"))]).pipe((0,k.B)(300)).subscribe(([t,n,d])=>{this.filterProducts(t||"",n||"all",d||"all")}))}ngOnDestroy(){this.subscriptions.unsubscribe()}productNameValidator(){return e=>(0,p.of)(e.value).pipe((0,k.B)(500),(0,x.n)(a=>{if(!a||!a.trim())return(0,p.of)(null);const t=a.trim().toLowerCase(),n=this.productoForm?.get("id")?.value;return this.productos&&0!==this.productos.length&&this.productos.some(g=>g.nombre.toLowerCase()===t&&g.id!==n)?(0,p.of)({productNameExists:!0}):(0,p.of)(null)}))}cargarProductos(){const e=(0,l.collection)(this.firestore,"productos");this.subscriptions.add((0,l.collectionData)(e,{idField:"id"}).subscribe(a=>{this.productos=a,this.filteredProducts=a,this.totalStockValue=a.reduce((t,n)=>t+(n.stock||0)*n.costo,0),this.productosBajosEnStock=a.filter(t=>!t.esCombinado&&(t.stock||0)<=(t.stockMinimo||0)).length}))}cargarCategorias(){const e=(0,l.collection)(this.firestore,"categorias");this.subscriptions.add((0,l.collectionData)(e,{idField:"id"}).subscribe(a=>{this.categorias=a}))}cargarProveedores(){const e=(0,l.collection)(this.firestore,"proveedores");this.subscriptions.add((0,l.collectionData)(e,{idField:"id"}).subscribe(a=>{this.proveedores=a,this.totalProveedores=a.length}))}filterProducts(e,a,t){let n=[...this.productos];e&&(n=n.filter(d=>d.nombre.toLowerCase().includes(e.toLowerCase()))),a&&"all"!==a&&(n=n.filter(d=>d.categoriaId===a)),t&&"all"!==t&&(n=n.filter(d=>d.proveedorId===t)),this.filteredProducts=n}onCategoriaChange(e){const a=this.categorias.find(t=>t.id===e);this.unidadesDisponibles=a?.unidadesDisponibles||[],this.unidadesDisponibles.length>0?this.productoForm.get("unidadMedida")?.setValue(this.unidadesDisponibles[0]):this.productoForm.get("unidadMedida")?.setValue(""),this.familiasDisponibles=a?.familias||[],this.productoForm.get("familiaId")?.setValue("")}onEsCombinadoChange(e){const a=this.productoForm.get("stock"),t=this.productoForm.get("stockMinimo");e?(a?.setValue(null),a?.disable(),t?.setValue(null),t?.disable()):(a?.enable(),t?.enable())}guardarProducto(){var e=this;return(0,b.A)(function*(){if(e.productoForm.invalid)return void m().fire("Error","Por favor, complete todos los campos requeridos.","error");const a=e.productoForm.getRawValue();m().showLoading();try{if(a.id){const t=(0,l.doc)(e.firestore,"productos",a.id);yield(0,l.updateDoc)(t,a),m().fire("\xa1Actualizado!","El producto ha sido actualizado.","success")}else a.fechaCreacion=(0,l.serverTimestamp)(),delete a.id,yield(0,l.addDoc)((0,l.collection)(e.firestore,"productos"),a),m().fire("\xa1Creado!","El nuevo producto ha sido guardado.","success");e.modal.hide(),e.resetForm()}catch(t){console.error("Error al guardar el producto:",t),m().fire("Error","Hubo un problema al guardar el producto.","error")}})()}editarProducto(e){this.productoForm.contains("id")||this.productoForm.addControl("id",this.fb.control(""));const a=this.categorias.find(t=>t.id===e.categoriaId);this.unidadesDisponibles=a?.unidadesDisponibles||[],this.familiasDisponibles=a?.familias||[],this.productoForm.patchValue({id:e.id,nombre:e.nombre,descripcion:e.descripcion,costo:e.costo,IVA:e.IVA,categoriaId:e.categoriaId,familiaId:e.familiaId,proveedorId:e.proveedorId,esCombinado:e.esCombinado,stock:e.stock,stockMinimo:e.stockMinimo,cantidad:e.cantidad,unidadMedida:e.unidadMedida}),this.modal.show()}eliminarProducto(e){var a=this;return(0,b.A)(function*(){if((yield m().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield(0,l.deleteDoc)((0,l.doc)(a.firestore,"productos",e)),m().fire("\xa1Eliminado!","El producto ha sido eliminado.","success")}catch(n){console.error("Error al eliminar el producto:",n),m().fire("Error","No se pudo eliminar el producto.","error")}})()}abrirModalNuevo(){this.resetForm(),this.modal.show()}resetForm(){this.productoForm.reset({id:"",nombre:"",descripcion:"",costo:0,IVA:0,categoriaId:"",familiaId:"",proveedorId:null,esCombinado:!1,stock:0,stockMinimo:0,cantidad:0,unidadMedida:""}),this.familiasDisponibles=[],this.unidadesDisponibles=[]}getCategoryName(e){const a=this.categorias.find(t=>t.id===e);return a?a.nombre:""}getFamiliaName(e,a){if(!a)return"";const t=this.categorias.find(d=>d.id===e);if(!t||!t.familias)return"";const n=t.familias.find(d=>d.id===a);return n?n.nombre:""}getCategoryBadgeClass(e){const a=this.categorias.find(d=>d.id===e);if(!a)return"bg-secondary";const t=["bg-primary","bg-success","bg-info","bg-warning","bg-danger"];return t[a.nombre.length%t.length]}getPrecioVenta(e){return e.costo*(1+(e.IVA||0)/100)}getStockClass(e){if(e.esCombinado)return"text-muted";const a=e.stock||0;return a<=0?"text-danger":a<=(e.stockMinimo||0)?"text-warning":"text-success"}getUnidadDisplay(e){return e.cantidad&&e.unidadMedida?`${e.unidadMedida}`:"unidades"}getMargenPorcentaje(e){const a=this.getPrecioVenta(e),t=e.costo;return 0===t?"0.0":((a-t)/t*100).toFixed(1)}verDetalleProducto(e){this.productoSeleccionado=e,this.detalleModal.show()}editarDesdeDetalle(){this.productoSeleccionado&&(this.detalleModal.hide(),this.editarProducto(this.productoSeleccionado))}eliminarDesdeDetalle(){var e=this;return(0,b.A)(function*(){e.productoSeleccionado&&(e.detalleModal.hide(),yield e.eliminarProducto(e.productoSeleccionado.id),e.productoSeleccionado=null)})()}getProveedorName(e){if(!e)return"Sin proveedor";const a=this.proveedores.find(t=>t.id===e);return a?a.nombre:"Sin proveedor"}static{this.\u0275fac=function(a){return new(a||i)(o.rXU(s.ok),o.rXU(l.Firestore))}}static{this.\u0275cmp=o.VBU({type:i,selectors:[["app-productos-page"]],decls:177,vars:27,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-3"],[1,"col"],[1,"card"],[1,"card-body"],[1,"row","d-flex","align-items-center"],[1,"col-12","col-sm-4","mt-2"],["type","text","placeholder","Buscar productos...",1,"form-control",3,"formControl"],[1,"col-12","col-sm-3","mt-2"],[1,"form-select",3,"formControl"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-sm-2","mt-2"],[1,"bi","bi-box","text-primary"],[1,"bi","bi-exclamation-circle","text-danger"],[1,"row","mt-4"],["class","col-12 text-center",4,"ngIf"],["class","col-12 col-sm-3 mb-4",4,"ngFor","ngForOf"],["id","detalleProductoModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header","border-0","pb-0"],[1,"d-flex","align-items-center","w-100"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"background","linear-gradient(135deg, #667eea 0%, #764ba2 100%)","width","56px","height","56px"],[1,"bi","bi-box-seam-fill","text-white","fs-3"],[1,"flex-grow-1"],[1,"mb-1"],[1,"text-muted","mb-0","small"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body pt-3",4,"ngIf"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-lg","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-fill","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[1,"bi","bi-trash3-fill","me-2"],["id","productModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-xl"],[3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","nombre","placeholder","Ej: Coca-Cola",1,"form-control"],["class","text-danger mt-1",4,"ngIf"],[1,"text-muted"],["formControlName","descripcion","placeholder","Descripci\xf3n del producto","rows","2",1,"form-control"],[1,"col-6","mb-3"],["type","number","formControlName","costo","placeholder","0.00","step","0.01",1,"form-control"],["formControlName","IVA",1,"form-select"],["selected","","disabled",""],["value","4"],["value","10"],["value","21"],["formControlName","categoriaId",1,"form-select"],["value","","disabled",""],["formControlName","familiaId",1,"form-select",3,"disabled"],["class","text-muted",4,"ngIf"],["formControlName","proveedorId",1,"form-select"],[3,"ngValue"],[1,"form-check"],["type","checkbox","formControlName","esCombinado","id","esCombinadoCheck",1,"form-check-input"],["for","esCombinadoCheck",1,"form-check-label"],[1,"card","bg-light","mb-3"],[1,"card-title","mb-3"],[1,"bi","bi-info-circle","me-2"],["title","\xbfCu\xe1nto contiene cada unidad? Ej: 500ml, 1kg, 250g",1,"bi","bi-question-circle","text-info","ms-1"],["type","number","formControlName","cantidad","placeholder","Ej: 500","step","0.01",1,"form-control"],["formControlName","unidadMedida",1,"form-select"],[1,"alert","alert-info","py-2","px-3","mb-0"],[1,"bi","bi-lightbulb","me-1"],["class","card bg-light",4,"ngIf"],["class","card bg-warning bg-opacity-10",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn","btn-danger",3,"disabled"],[1,"bi","bi-save","me-2"],[3,"value"],[1,"col-12","text-center"],[1,"col-12","col-sm-3","mb-4"],[1,"card","shadow-sm","border-0","h-100","position-relative",2,"cursor","pointer",3,"click"],["class","position-absolute top-0 end-0 m-2",4,"ngIf"],["class","alert-bar position-absolute top-0 start-0 w-100","style","height: 4px; border-radius: 0.375rem 0.375rem 0 0;",3,"bg-danger","bg-warning",4,"ngIf"],[1,"card-body","p-3"],[1,"mb-1","fw-bold"],[1,"text-muted","small","mb-2"],[1,"d-flex","flex-wrap","gap-1"],[1,"badge","rounded-pill",2,"font-size","0.75rem",3,"ngClass"],["class","badge rounded-pill bg-secondary","style","font-size: 0.7rem;",4,"ngIf"],[1,"row","mb-3"],[1,"col-12","mb-2"],[1,"text-muted","small"],[1,"fw-bold","text-info",2,"font-size","1rem"],[1,"col-6"],[1,"fw-bold","text-danger",2,"font-size","1.1rem"],["class","col-6",4,"ngIf"],["class","alert py-2 px-3 mb-0 d-flex align-items-center",3,"alert-danger","alert-warning",4,"ngIf"],[1,"position-absolute","top-0","end-0","m-2"],["class","badge bg-danger d-flex align-items-center gap-1 px-2 py-1","style","font-size: 0.7rem;",4,"ngIf"],["class","badge bg-warning text-dark d-flex align-items-center gap-1 px-2 py-1","style","font-size: 0.7rem;",4,"ngIf"],[1,"badge","bg-danger","d-flex","align-items-center","gap-1","px-2","py-1",2,"font-size","0.7rem"],[1,"bi","bi-exclamation-triangle-fill"],[1,"badge","bg-warning","text-dark","d-flex","align-items-center","gap-1","px-2","py-1",2,"font-size","0.7rem"],[1,"bi","bi-exclamation-circle-fill"],[1,"alert-bar","position-absolute","top-0","start-0","w-100",2,"height","4px","border-radius","0.375rem 0.375rem 0 0"],[1,"badge","rounded-pill","bg-secondary",2,"font-size","0.7rem"],[1,"fw-bold","d-flex","align-items-center","gap-1"],["class","bi bi-exclamation-triangle-fill text-danger",4,"ngIf"],["class","bi bi-exclamation-circle-fill text-warning",4,"ngIf"],["class","small mt-1",4,"ngIf"],[1,"bi","bi-exclamation-triangle-fill","text-danger"],[1,"bi","bi-exclamation-circle-fill","text-warning"],[1,"small","mt-1"],["class","text-danger ms-2",4,"ngIf"],["class","text-warning ms-2",4,"ngIf"],[1,"text-danger","ms-2"],[1,"bi","bi-arrow-down-circle-fill","me-1"],[1,"text-warning","ms-2"],[1,"bi","bi-exclamation-circle","me-1"],[1,"fw-bold","text-warning",2,"font-size","0.9rem"],[1,"alert","py-2","px-3","mb-0","d-flex","align-items-center"],[1,"bi","me-2"],[1,"mb-0"],[4,"ngIf"],[1,"modal-body","pt-3"],[1,"mb-4","d-flex","gap-2","align-items-center"],[1,"badge","rounded-pill","px-3","py-2",3,"ngClass"],[1,"bi","bi-tag-fill","me-1"],["class","badge rounded-pill bg-secondary px-3 py-2",4,"ngIf"],[1,"bi",3,"ngClass"],[1,"row","g-3","mb-3"],[1,"col-md-4"],[1,"card","border-0","bg-danger","bg-opacity-10","h-100"],[1,"card-body","text-center"],[1,"bi","bi-cash-coin","text-danger","fs-2","d-block","mb-2"],[1,"mb-0","text-danger"],[1,"card","border-0","bg-primary","h-100"],[1,"bi","bi-percent","text-white","fs-2","d-block","mb-2"],[1,"mb-0","text-white"],[1,"text-white","opacity-75"],[1,"card","border-0","bg-success","bg-opacity-10","h-100"],[1,"bi","bi-calculator","text-success","fs-2","d-block","mb-2"],[1,"mb-0","text-success"],["class","card border-0 bg-light mb-3",4,"ngIf"],[1,"row","g-3"],[1,"card","border-0","bg-light","h-100"],[1,"bi","bi-info-circle","me-2","text-primary"],[1,"text-muted","d-block"],[1,"fs-5","text-info"],[1,"text-muted","d-block","mt-1"],[1,"bi","bi-info-circle","me-1"],[1,"d-flex","align-items-center","mt-1"],[1,"bi","bi-building","me-2","text-primary"],[1,"bi","bi-graph-up","me-2","text-primary"],[1,"progress","mt-2",2,"height","25px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],["class","alert alert-warning d-flex align-items-center mt-3",4,"ngIf"],[1,"badge","rounded-pill","bg-secondary","px-3","py-2"],[1,"bi","bi-diagram-3-fill","me-1"],[1,"card","border-0","bg-light","mb-3"],[1,"bi","bi-boxes","me-2","text-primary"],[1,"d-flex","align-items-center","justify-content-between","p-3","bg-white","rounded"],[1,"mb-0",3,"ngClass"],[1,"bi","bi-box-seam","fs-2",3,"ngClass"],[1,"mb-0","text-warning"],[1,"bi","bi-exclamation-triangle","fs-2","text-warning"],[1,"fs-5","text-success"],[1,"alert","alert-warning","d-flex","align-items-center","mt-3"],[1,"bi","bi-exclamation-triangle-fill","fs-4","me-3"],[1,"text-danger","mt-1"],[1,"card","bg-light"],[1,"bi","bi-boxes","me-2"],["title","\xbfCu\xe1ntas unidades tienes en inventario?",1,"bi","bi-question-circle","text-info","ms-1"],["type","number","formControlName","stock","placeholder","Ej: 24","min","0",1,"form-control"],["title","\xbfCu\xe1ndo quieres que te avise para reponer?",1,"bi","bi-question-circle","text-info","ms-1"],["type","number","formControlName","stockMinimo","placeholder","Ej: 5","min","0",1,"form-control"],[1,"alert","alert-warning","py-2","px-3","mb-0"],[1,"bi","bi-exclamation-triangle","me-1"],[1,"card","bg-warning","bg-opacity-10"],[1,"bi","bi-cup-straw","fs-1","text-warning","mb-2"],[1,"text-warning"]],template:function(a,t){if(1&a&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),o.EFF(4,"Gesti\xf3n de Productos"),o.k0s(),o.j41(5,"span"),o.EFF(6,"Crea, edita y organiza todos tus productos."),o.k0s()(),o.j41(7,"div",3)(8,"button",4),o.bIt("click",function(){return t.abrirModalNuevo()}),o.nrm(9,"i",5),o.EFF(10," Nuevo Producto "),o.k0s()()(),o.j41(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11),o.nrm(17,"input",12),o.k0s(),o.j41(18,"div",13)(19,"select",14)(20,"option",15),o.EFF(21,"Todas las categor\xedas"),o.k0s(),o.DNE(22,P,2,2,"option",16),o.k0s()(),o.j41(23,"div",13)(24,"select",14)(25,"option",15),o.EFF(26,"Todos los proveedores"),o.k0s(),o.DNE(27,I,2,2,"option",16),o.k0s()(),o.j41(28,"div",17)(29,"span"),o.nrm(30,"i",18),o.EFF(31),o.k0s(),o.EFF(32,"\xa0\xa0 "),o.j41(33,"span"),o.nrm(34,"i",19),o.EFF(35),o.k0s()()()()()()(),o.j41(36,"div",20),o.DNE(37,R,3,0,"div",21),o.DNE(38,z,30,30,"div",22),o.k0s()(),o.j41(39,"div",23)(40,"div",24)(41,"div",25)(42,"div",26)(43,"div",27)(44,"div",28),o.nrm(45,"i",29),o.k0s(),o.j41(46,"div",30)(47,"h4",31),o.EFF(48),o.k0s(),o.j41(49,"p",32),o.EFF(50),o.k0s()()(),o.nrm(51,"button",33),o.k0s(),o.DNE(52,H,74,29,"div",34),o.j41(53,"div",35)(54,"button",36),o.nrm(55,"i",37),o.EFF(56,"Cerrar "),o.k0s(),o.j41(57,"button",38),o.bIt("click",function(){return t.editarDesdeDetalle()}),o.nrm(58,"i",39),o.EFF(59,"Editar "),o.k0s(),o.j41(60,"button",40),o.bIt("click",function(){return t.eliminarDesdeDetalle()}),o.nrm(61,"i",41),o.EFF(62,"Eliminar "),o.k0s()()()()(),o.j41(63,"div",42)(64,"div",43)(65,"div",25)(66,"form",44),o.bIt("ngSubmit",function(){return t.guardarProducto()}),o.j41(67,"div",45)(68,"h5",46),o.EFF(69),o.k0s(),o.nrm(70,"button",33),o.k0s(),o.j41(71,"div",47)(72,"div",1)(73,"div",48)(74,"div",49)(75,"label",50),o.EFF(76,"Nombre del Producto "),o.j41(77,"span",51),o.EFF(78,"*"),o.k0s()(),o.nrm(79,"input",52),o.DNE(80,q,2,0,"div",53),o.k0s(),o.j41(81,"div",49)(82,"label",50),o.EFF(83,"Descripci\xf3n "),o.j41(84,"small",54),o.EFF(85,"(Opcional)"),o.k0s()(),o.nrm(86,"textarea",55),o.k0s(),o.j41(87,"div",1)(88,"div",56)(89,"label",50),o.EFF(90,"Costo "),o.j41(91,"span",51),o.EFF(92,"*"),o.k0s()(),o.nrm(93,"input",57),o.k0s(),o.j41(94,"div",56)(95,"label",50),o.EFF(96,"IVA(%) "),o.j41(97,"span",51),o.EFF(98,"*"),o.k0s()(),o.j41(99,"select",58)(100,"option",59),o.EFF(101,"Selecciona un IVA"),o.k0s(),o.j41(102,"option",60),o.EFF(103,"4%"),o.k0s(),o.j41(104,"option",61),o.EFF(105,"10%"),o.k0s(),o.j41(106,"option",62),o.EFF(107,"21%"),o.k0s()()()(),o.j41(108,"div",49)(109,"label",50),o.EFF(110,"Categor\xeda "),o.j41(111,"span",51),o.EFF(112,"*"),o.k0s()(),o.j41(113,"select",63)(114,"option",64),o.EFF(115,"Selecciona una categor\xeda"),o.k0s(),o.DNE(116,Q,2,2,"option",16),o.k0s()(),o.j41(117,"div",49)(118,"label",50),o.EFF(119,"Familia "),o.j41(120,"span",51),o.EFF(121,"*"),o.k0s()(),o.j41(122,"select",65)(123,"option",64),o.EFF(124),o.k0s(),o.DNE(125,K,2,2,"option",16),o.k0s(),o.DNE(126,W,2,0,"small",66),o.k0s(),o.j41(127,"div",49)(128,"label",50),o.EFF(129,"Proveedor "),o.j41(130,"small",54),o.EFF(131,"(Opcional)"),o.k0s()(),o.j41(132,"select",67)(133,"option",68),o.EFF(134,"Ninguno"),o.k0s(),o.DNE(135,oo,2,2,"option",16),o.k0s()(),o.j41(136,"div",69),o.nrm(137,"input",70),o.j41(138,"label",71),o.EFF(139," Es Receta/Combinado (sin control de stock) "),o.k0s()()(),o.j41(140,"div",48)(141,"div",72)(142,"div",9)(143,"h6",73),o.nrm(144,"i",74),o.EFF(145," Informaci\xf3n del Producto "),o.k0s(),o.j41(146,"div",1)(147,"div",56)(148,"label",50),o.EFF(149," Contenido por Unidad "),o.j41(150,"span",51),o.EFF(151,"*"),o.k0s(),o.nrm(152,"i",75),o.k0s(),o.nrm(153,"input",76),o.k0s(),o.j41(154,"div",56)(155,"label",50),o.EFF(156," Unidad de Medida "),o.j41(157,"span",51),o.EFF(158,"*"),o.k0s()(),o.j41(159,"select",77)(160,"option",64),o.EFF(161,"Selecciona una unidad"),o.k0s(),o.DNE(162,eo,2,2,"option",16),o.k0s()()(),o.j41(163,"div",78)(164,"small"),o.nrm(165,"i",79),o.j41(166,"strong"),o.EFF(167,"Ejemplo:"),o.k0s(),o.EFF(168," Botella de 500ml \u2192 Contenido: 500, Unidad: ml "),o.k0s()()()(),o.DNE(169,io,20,0,"div",80),o.DNE(170,to,7,0,"div",81),o.k0s()()(),o.j41(171,"div",82)(172,"button",36),o.EFF(173,"Cancelar"),o.k0s(),o.j41(174,"button",83),o.nrm(175,"i",84),o.EFF(176),o.k0s()()()()()()),2&a){let n,d,g,h,E;o.R7$(17),o.Y8G("formControl",t.productSearch),o.R7$(2),o.Y8G("formControl",t.categoryFilter),o.R7$(3),o.Y8G("ngForOf",t.categorias),o.R7$(2),o.Y8G("formControl",t.supplierFilter),o.R7$(3),o.Y8G("ngForOf",t.proveedores),o.R7$(4),o.SpI("\xa0",t.filteredProducts.length,"\xa0Productos"),o.R7$(4),o.SpI("\xa0",t.productosBajosEnStock,"\xa0Stock"),o.R7$(2),o.Y8G("ngIf",0===t.filteredProducts.length),o.R7$(1),o.Y8G("ngForOf",t.filteredProducts),o.R7$(10),o.JRh(null==t.productoSeleccionado?null:t.productoSeleccionado.nombre),o.R7$(2),o.JRh(null==t.productoSeleccionado?null:t.productoSeleccionado.descripcion),o.R7$(2),o.Y8G("ngIf",t.productoSeleccionado),o.R7$(14),o.Y8G("formGroup",t.productoForm),o.R7$(3),o.JRh(null!=(n=t.productoForm.get("id"))&&n.value?"Editar Producto":"Nuevo Producto"),o.R7$(11),o.Y8G("ngIf",null==(d=t.productoForm.get("nombre"))?null:d.hasError("productNameExists")),o.R7$(36),o.Y8G("ngForOf",t.categorias),o.R7$(6),o.Y8G("disabled",0===t.familiasDisponibles.length),o.R7$(2),o.SpI(" ",0===t.familiasDisponibles.length?"Primero selecciona una categor\xeda":"Selecciona una familia"," "),o.R7$(1),o.Y8G("ngForOf",t.familiasDisponibles),o.R7$(1),o.Y8G("ngIf",0===t.familiasDisponibles.length),o.R7$(7),o.Y8G("ngValue",null),o.R7$(2),o.Y8G("ngForOf",t.proveedores),o.R7$(27),o.Y8G("ngForOf",t.unidadesDisponibles),o.R7$(7),o.Y8G("ngIf",!(null!=(g=t.productoForm.get("esCombinado"))&&g.value)),o.R7$(1),o.Y8G("ngIf",null==(h=t.productoForm.get("esCombinado"))?null:h.value),o.R7$(4),o.Y8G("disabled",t.productoForm.invalid),o.R7$(2),o.SpI(" ",null!=(E=t.productoForm.get("id"))&&E.value?"Actualizar":"Crear"," ")}},dependencies:[u.YU,u.Sq,u.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.VZ,s.l_,s.j4,s.JD,u.oe]})}}return i})()}];let ro=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[v.iI.forChild(ao),v.iI]})}}return i})(),so=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[u.MD,s.YN,s.X1,ro]})}}return i})()}}]);