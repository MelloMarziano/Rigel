"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[830],{5449:(z,P,u)=>{u.r(P),u.d(P,{FacturasPageModule:()=>Y});var C=u(7412),i=u(9417),g=u(177),k=u(8498),b=u(467),s=u(2418),j=u(8032),d=u.n(j),M=u(8359),t=u(7705);function O(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",85)(1,"small",5),t.nrm(2,"i",86),t.EFF(3),t.j41(4,"button",87),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.limpiarFiltros())}),t.nrm(5,"i",88),t.EFF(6," Limpiar filtros "),t.k0s()()()}if(2&o){const e=t.XpG();t.R7$(3),t.Lme(" Mostrando ",e.facturasFiltradas.length," de ",e.facturas.length," facturas ")}}function y(o,l){if(1&o&&(t.j41(0,"div",115)(1,"span",116),t.EFF(2),t.k0s(),t.j41(3,"span",117),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&o){const e=l.$implicit;t.R7$(2),t.JRh(e.productoNombre),t.R7$(2),t.Lme("",e.cantidad," x ",t.ii3(5,3,e.precioUnitario,"EUR","symbol","1.2-2"),"")}}function x(o,l){if(1&o&&(t.j41(0,"div",118),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(1),t.SpI(" +",e.productos.length-3," productos m\xe1s ")}}function I(o,l){if(1&o&&(t.j41(0,"div",50)(1,"small",119),t.EFF(2,"Observaciones:"),t.k0s(),t.j41(3,"small",120),t.EFF(4),t.k0s()()),2&o){const e=t.XpG().$implicit;t.R7$(4),t.JRh(e.observaciones)}}function R(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",121),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return t.Njj(r.enviarFactura(a))}),t.nrm(1,"i",122),t.EFF(2," Enviar "),t.k0s()}}function T(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",123),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return t.Njj(r.marcarComoPagada(a))}),t.nrm(1,"i",124),t.EFF(2," Marcar como Pagada "),t.k0s()}}function w(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",125),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return t.Njj(r.cancelarFactura(a))}),t.nrm(1,"i",88),t.EFF(2," Cancelar "),t.k0s()}}function N(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",89)(1,"div",10)(2,"div",18)(3,"div",90)(4,"div",91),t.nrm(5,"i",92),t.j41(6,"h5",47),t.EFF(7),t.k0s(),t.j41(8,"span",93),t.EFF(9),t.k0s()(),t.j41(10,"div",94)(11,"button",95),t.bIt("click",function(){const r=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.verFactura(r))}),t.nrm(12,"i",96),t.k0s(),t.j41(13,"button",97),t.bIt("click",function(){const r=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.imprimirFactura(r))}),t.nrm(14,"i",98),t.k0s(),t.j41(15,"button",99),t.bIt("click",function(){const r=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.editarFactura(r))}),t.nrm(16,"i",100),t.k0s(),t.j41(17,"button",101),t.bIt("click",function(){const r=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.eliminarFactura(r))}),t.nrm(18,"i",102),t.k0s()()(),t.j41(19,"div",50)(20,"strong"),t.EFF(21),t.k0s(),t.nrm(22,"br"),t.j41(23,"small",5),t.EFF(24),t.k0s()(),t.j41(25,"div",68)(26,"div",49)(27,"small",5),t.EFF(28,"Fecha Emisi\xf3n"),t.k0s(),t.j41(29,"div",103),t.EFF(30),t.nI1(31,"date"),t.k0s()(),t.j41(32,"div",49)(33,"small",5),t.EFF(34,"Fecha Vencimiento"),t.k0s(),t.j41(35,"div",103),t.EFF(36),t.nI1(37,"date"),t.k0s()()(),t.j41(38,"div",68)(39,"div",104)(40,"small",5),t.EFF(41,"Subtotal"),t.k0s(),t.j41(42,"div",103),t.EFF(43),t.nI1(44,"currency"),t.k0s()(),t.j41(45,"div",104)(46,"small",5),t.EFF(47,"IVA"),t.k0s(),t.j41(48,"div",103),t.EFF(49),t.nI1(50,"currency"),t.k0s()(),t.j41(51,"div",104)(52,"small",5),t.EFF(53,"Total"),t.k0s(),t.j41(54,"div",105),t.EFF(55),t.nI1(56,"currency"),t.k0s()()(),t.j41(57,"div",50)(58,"small",106),t.EFF(59),t.k0s(),t.j41(60,"div",107),t.DNE(61,y,6,8,"div",108),t.DNE(62,x,2,1,"div",109),t.k0s()(),t.DNE(63,I,5,1,"div",70),t.j41(64,"div",110)(65,"div",111),t.DNE(66,R,3,0,"button",112),t.DNE(67,T,3,0,"button",113),t.DNE(68,w,3,0,"button",114),t.k0s()()()()()}if(2&o){const e=l.$implicit,n=t.XpG();t.R7$(7),t.JRh(e.numero),t.R7$(1),t.HbH(n.getEstadoBadgeClass(e.estado)),t.R7$(1),t.SpI(" ",e.estado," "),t.R7$(6),t.Y8G("disabled","Pagada"===e.estado),t.R7$(2),t.Y8G("disabled","Pagada"===e.estado),t.R7$(4),t.JRh(e.clienteNombre),t.R7$(3),t.JRh(e.clienteEmail||"Sin email"),t.R7$(6),t.SpI(" ",t.i5U(31,22,e.fechaEmision,"dd/MM/yyyy")," "),t.R7$(5),t.AVh("text-danger",n.isFacturaVencida(e)),t.R7$(1),t.SpI(" ",t.i5U(37,25,e.fechaVencimiento,"dd/MM/yyyy")," "),t.R7$(7),t.SpI(" ",t.ii3(44,28,e.subtotal,"EUR","symbol","1.2-2")," "),t.R7$(6),t.SpI(" ",t.ii3(50,33,e.iva,"EUR","symbol","1.2-2")," "),t.R7$(6),t.SpI(" ",t.ii3(56,38,e.total,"EUR","symbol","1.2-2")," "),t.R7$(4),t.SpI("Productos (",e.productos.length,"):"),t.R7$(2),t.Y8G("ngForOf",e.productos.slice(0,3)),t.R7$(1),t.Y8G("ngIf",e.productos.length>3),t.R7$(1),t.Y8G("ngIf",e.observaciones),t.R7$(3),t.Y8G("ngIf","Borrador"===e.estado),t.R7$(1),t.Y8G("ngIf","Enviada"===e.estado||"Vencida"===e.estado),t.R7$(1),t.Y8G("ngIf","Pagada"!==e.estado&&"Cancelada"!==e.estado)}}function $(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",2)(1,"div",126),t.nrm(2,"i",127),t.j41(3,"h5",128),t.EFF(4,"No se encontraron facturas"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Intenta ajustar los filtros de b\xfasqueda"),t.k0s(),t.j41(7,"button",129),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.limpiarFiltros())}),t.nrm(8,"i",130),t.EFF(9," Mostrar todas las facturas "),t.k0s()()()}}function V(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",2)(1,"div",126),t.nrm(2,"i",131),t.j41(3,"h5",128),t.EFF(4,"No tienes facturas creadas"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Crea tu primera factura para comenzar"),t.k0s(),t.j41(7,"button",6),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.abrirModalFactura())}),t.nrm(8,"i",132),t.EFF(9," Nueva Factura "),t.k0s()()()}}function G(o,l){if(1&o&&(t.j41(0,"div",1)(1,"div",137)(2,"small",5),t.EFF(3),t.k0s()(),t.j41(4,"div",49)(5,"small",103),t.EFF(6),t.nI1(7,"currency"),t.k0s()()()),2&o){const e=l.$implicit;t.R7$(3),t.SpI("IVA ",e.porcentaje,"%:"),t.R7$(3),t.JRh(t.ii3(7,2,e.importe,"EUR","symbol","1.2-2"))}}function S(o,l){if(1&o&&(t.j41(0,"div",50)(1,"div",133)(2,"h6",134),t.EFF(3,"Desglose de IVA"),t.k0s(),t.DNE(4,G,8,7,"div",135),t.nrm(5,"hr",136),t.j41(6,"div",1)(7,"div",137)(8,"strong"),t.EFF(9,"Total IVA:"),t.k0s()(),t.j41(10,"div",49)(11,"strong"),t.EFF(12),t.nI1(13,"currency"),t.k0s()()()()()),2&o){const e=t.XpG();t.R7$(4),t.Y8G("ngForOf",e.ivaBreakdown),t.R7$(8),t.JRh(t.ii3(13,2,e.ivaFactura,"EUR","symbol","1.2-2"))}}function A(o,l){if(1&o&&(t.j41(0,"option",146),t.EFF(1),t.k0s()),2&o){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function B(o,l){if(1&o){const e=t.RV6();t.j41(0,"tr",138)(1,"td")(2,"select",139),t.bIt("change",function(){const r=t.eBV(e).index,c=t.XpG();return t.Njj(c.onProductoChange(r))}),t.j41(3,"option",27),t.EFF(4,"Seleccionar producto"),t.k0s(),t.DNE(5,A,2,2,"option",140),t.k0s()(),t.j41(6,"td")(7,"input",141),t.bIt("input",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.calcularTotales())}),t.k0s()(),t.j41(8,"td")(9,"input",142),t.bIt("input",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.calcularTotales())}),t.k0s()(),t.j41(10,"td")(11,"span",103),t.EFF(12),t.nI1(13,"currency"),t.k0s()(),t.j41(14,"td")(15,"span",143),t.EFF(16),t.nI1(17,"currency"),t.k0s()(),t.j41(18,"td")(19,"span",144),t.EFF(20),t.nI1(21,"currency"),t.k0s()(),t.j41(22,"td")(23,"button",145),t.bIt("click",function(){const r=t.eBV(e).index,c=t.XpG();return t.Njj(c.eliminarProducto(r))}),t.nrm(24,"i",102),t.k0s()()()}if(2&o){const e=l.index,n=t.XpG();t.Y8G("formGroupName",e),t.R7$(5),t.Y8G("ngForOf",n.productos),t.R7$(7),t.JRh(t.ii3(13,5,n.getProductoSubtotal(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(17,10,n.getProductoIvaImporte(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(21,15,n.getProductoTotal(e),"EUR","symbol","1.2-2"))}}const D=[{path:"",component:(()=>{class o{constructor(e,n){this.fb=e,this.firestore=n,this.facturas=[],this.facturasFiltradas=[],this.productos=[],this.modoEdicion=!1,this.facturaEditando=null,this.estadisticas={totalFacturas:0,pagadas:0,pendientes:0,valorTotal:0},this.filtros={busqueda:"",estado:""},this.subtotalFactura=0,this.ivaFactura=0,this.totalFactura=0,this.ivaBreakdown=[],this.subscriptions=new M.yU,this.initForm()}ngOnInit(){this.cargarFacturas(),this.cargarProductos(),this.initModal()}ngOnDestroy(){this.subscriptions.unsubscribe()}initForm(){this.facturaForm=this.fb.group({numero:["",i.k0.required],clienteNombre:["",i.k0.required],clienteEmail:[""],clienteTelefono:[""],fechaEmision:[(new Date).toISOString().split("T")[0],i.k0.required],fechaVencimiento:[this.getFechaVencimientoDefault(),i.k0.required],estado:["Borrador"],metodoPago:["Efectivo"],observaciones:[""],productos:this.fb.array([])})}getFechaVencimientoDefault(){const e=new Date;return e.setDate(e.getDate()+30),e.toISOString().split("T")[0]}initModal(){const e=document.getElementById("modalFactura");e&&(this.modal=new bootstrap.Modal(e))}cargarFacturas(){const e=(0,s.rJ)(this.firestore,"facturas");this.subscriptions.add((0,s.xs)(e,{idField:"id"}).subscribe(n=>{this.facturas=n.map(a=>({...a,fechaEmision:a.fechaEmision?.toDate()||new Date,fechaVencimiento:a.fechaVencimiento?.toDate()||new Date})),this.actualizarEstadisticas(),this.aplicarFiltros()}))}cargarProductos(){const e=(0,s.rJ)(this.firestore,"productos");this.subscriptions.add((0,s.xs)(e,{idField:"id"}).subscribe(n=>{this.productos=n}))}actualizarEstadisticas(){this.estadisticas.totalFacturas=this.facturas.length,this.estadisticas.pagadas=this.facturas.filter(e=>"Pagada"===e.estado).length,this.estadisticas.pendientes=this.facturas.filter(e=>"Enviada"===e.estado||"Vencida"===e.estado).length,this.estadisticas.valorTotal=this.facturas.reduce((e,n)=>e+n.total,0)}get productosFormArray(){return this.facturaForm.get("productos")}aplicarFiltros(){let e=[...this.facturas];if(this.filtros.busqueda){const n=this.filtros.busqueda.toLowerCase();e=e.filter(a=>a.numero.toLowerCase().includes(n)||a.clienteNombre.toLowerCase().includes(n)||a.clienteEmail&&a.clienteEmail.toLowerCase().includes(n))}this.filtros.estado&&(e=e.filter(n=>n.estado===this.filtros.estado)),this.facturasFiltradas=e}limpiarFiltros(){this.filtros={busqueda:"",estado:""},this.aplicarFiltros()}abrirModalFactura(){this.modoEdicion=!1,this.facturaEditando=null,this.resetForm(),this.generarNumeroFactura(),this.modal.show()}generarNumeroFactura(){const a=`FAC-${(new Date).getFullYear()}-${(this.facturas.length+1).toString().padStart(3,"0")}`;this.facturaForm.patchValue({numero:a})}editarFactura(e){"Pagada"!==e.estado?(this.modoEdicion=!0,this.facturaEditando=e,this.cargarFacturaEnFormulario(e),this.modal.show()):d().fire("Error","No se puede editar una factura pagada","error")}cargarFacturaEnFormulario(e){this.facturaForm.patchValue({numero:e.numero,clienteNombre:e.clienteNombre,clienteEmail:e.clienteEmail||"",clienteTelefono:e.clienteTelefono||"",fechaEmision:e.fechaEmision.toISOString().split("T")[0],fechaVencimiento:e.fechaVencimiento.toISOString().split("T")[0],estado:e.estado,metodoPago:e.metodoPago,observaciones:e.observaciones||""});const n=this.productosFormArray;n.clear(),e.productos.forEach(a=>{n.push(this.fb.group({productoId:[a.productoId,i.k0.required],cantidad:[a.cantidad,[i.k0.required,i.k0.min(1)]],precioUnitario:[a.precioUnitario,[i.k0.required,i.k0.min(0)]]}))}),this.calcularTotales()}agregarProducto(){const e=this.fb.group({productoId:["",i.k0.required],cantidad:[1,[i.k0.required,i.k0.min(1)]],precioUnitario:[0,[i.k0.required,i.k0.min(0)]]});this.productosFormArray.push(e)}eliminarProducto(e){this.productosFormArray.removeAt(e),this.calcularTotales()}onProductoChange(e){const n=this.productosFormArray.at(e),a=n.get("productoId")?.value;if(a){const r=this.productos.find(c=>c.id===a);r&&(n.patchValue({precioUnitario:r.costo*(1+(r.IVA||0)/100)}),this.calcularTotales())}}calcularTotales(){let e=0;const n=new Map;this.productosFormArray.controls.forEach((a,r)=>{const c=a.get("productoId")?.value,h=a.get("cantidad")?.value||0,f=a.get("precioUnitario")?.value||0;if(c&&h&&f){const m=this.productos.find(_=>_.id===c)?.IVA||0,p=h*f,F=p*(m/100);e+=p,n.has(m)?n.set(m,n.get(m)+F):n.set(m,F)}}),this.subtotalFactura=e,this.ivaFactura=Array.from(n.values()).reduce((a,r)=>a+r,0),this.totalFactura=this.subtotalFactura+this.ivaFactura,this.ivaBreakdown=Array.from(n.entries()).map(([a,r])=>({porcentaje:a,importe:r}))}getProductoSubtotal(e){const n=this.productosFormArray.at(e);return(n.get("cantidad")?.value||0)*(n.get("precioUnitario")?.value||0)}getProductoIvaImporte(e){const a=this.productosFormArray.at(e).get("productoId")?.value;if(a){const c=this.productos.find(f=>f.id===a)?.IVA||0;return this.getProductoSubtotal(e)*(c/100)}return 0}getProductoTotal(e){return this.getProductoSubtotal(e)+this.getProductoIvaImporte(e)}guardarFactura(){var e=this;return(0,b.A)(function*(){if(e.facturaForm.valid)if(0!==e.productosFormArray.length)try{d().showLoading();const n=e.facturaForm.value,a=[];e.productosFormArray.controls.forEach((c,h)=>{const f=c.get("productoId")?.value,v=c.get("cantidad")?.value,m=c.get("precioUnitario")?.value;if(f&&v&&m){const p=e.productos.find(X=>X.id===f),F=p?.IVA||0,_=v*m,E=_*(F/100);a.push({productoId:f,productoNombre:p?.nombre||"",cantidad:v,precioUnitario:m,ivaProducto:F,subtotal:_,ivaImporte:E,total:_+E})}});const r={numero:n.numero,clienteNombre:n.clienteNombre,clienteEmail:n.clienteEmail,clienteTelefono:n.clienteTelefono,fechaEmision:new Date(n.fechaEmision),fechaVencimiento:new Date(n.fechaVencimiento),estado:n.estado,metodoPago:n.metodoPago,subtotal:e.subtotalFactura,iva:e.ivaFactura,total:e.totalFactura,productos:a,observaciones:n.observaciones};if(e.modoEdicion&&e.facturaEditando?.id){r.fechaActualizacion=(0,s.O5)();const c=(0,s.H9)(e.firestore,"facturas",e.facturaEditando.id);yield(0,s.mZ)(c,r),d().fire("\xa1Actualizada!","La factura ha sido actualizada exitosamente","success")}else r.fechaCreacion=(0,s.O5)(),yield(0,s.gS)((0,s.rJ)(e.firestore,"facturas"),r),d().fire("\xa1Creada!","La factura ha sido creada exitosamente","success");e.cerrarModal()}catch(n){console.error("Error al guardar factura:",n),d().fire("Error","Hubo un problema al guardar la factura","error")}else d().fire("Error","Debe agregar al menos un producto","error");else d().fire("Error","Por favor complete todos los campos requeridos","error")})()}eliminarFactura(e){var n=this;return(0,b.A)(function*(){if("Pagada"!==e.estado){if((yield d().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed&&e.id)try{yield(0,s.kd)((0,s.H9)(n.firestore,"facturas",e.id)),d().fire("\xa1Eliminada!","La factura ha sido eliminada","success")}catch(r){console.error("Error al eliminar factura:",r),d().fire("Error","No se pudo eliminar la factura","error")}}else d().fire("Error","No se puede eliminar una factura pagada","error")})()}verFactura(e){console.log("Ver factura:",e)}imprimirFactura(e){console.log("Imprimir factura:",e)}enviarFactura(e){var n=this;return(0,b.A)(function*(){if(e.id)try{const a=(0,s.H9)(n.firestore,"facturas",e.id);yield(0,s.mZ)(a,{estado:"Enviada",fechaActualizacion:(0,s.O5)()}),d().fire("\xa1Enviada!","La factura ha sido marcada como enviada","success")}catch{d().fire("Error","No se pudo enviar la factura","error")}})()}marcarComoPagada(e){var n=this;return(0,b.A)(function*(){if(e.id)try{const a=(0,s.H9)(n.firestore,"facturas",e.id);yield(0,s.mZ)(a,{estado:"Pagada",fechaActualizacion:(0,s.O5)()}),d().fire("\xa1Pagada!","La factura ha sido marcada como pagada","success")}catch{d().fire("Error","No se pudo marcar como pagada","error")}})()}cancelarFactura(e){var n=this;return(0,b.A)(function*(){if((yield d().fire({title:"\xbfCancelar factura?",text:"Esta acci\xf3n marcar\xe1 la factura como cancelada",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, cancelar",cancelButtonText:"No"})).isConfirmed&&e.id)try{const r=(0,s.H9)(n.firestore,"facturas",e.id);yield(0,s.mZ)(r,{estado:"Cancelada",fechaActualizacion:(0,s.O5)()}),d().fire("\xa1Cancelada!","La factura ha sido cancelada","success")}catch{d().fire("Error","No se pudo cancelar la factura","error")}})()}seleccionarClienteExistente(){console.log("Seleccionar cliente existente")}cerrarModal(){this.modal.hide(),this.resetForm()}resetForm(){this.facturaForm.reset({numero:"",clienteNombre:"",clienteEmail:"",clienteTelefono:"",fechaEmision:(new Date).toISOString().split("T")[0],fechaVencimiento:this.getFechaVencimientoDefault(),estado:"Borrador",metodoPago:"Efectivo",observaciones:""}),this.productosFormArray.clear(),this.subtotalFactura=0,this.ivaFactura=0,this.totalFactura=0,this.ivaBreakdown=[]}getEstadoBadgeClass(e){return{Borrador:"bg-secondary",Enviada:"bg-info",Pagada:"bg-success",Vencida:"bg-danger",Cancelada:"bg-dark"}[e]||"bg-secondary"}isFacturaVencida(e){return e.fechaVencimiento<new Date&&"Pagada"!==e.estado}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(i.ok),t.rXU(s._7))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-facturas-page"]],decls:210,vars:33,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus"],[1,"row","mt-4"],[1,"col-12","col-md-6","col-xl-3","mb-4"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-body","text-center"],[1,"text-primary","fw-bold","mb-1"],[1,"text-muted","mb-0"],[1,"text-success","fw-bold","mb-1"],[1,"text-warning","fw-bold","mb-1"],[1,"text-info","fw-bold","mb-1"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-12","col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Buscar facturas...",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"col-12","col-md-4"],[1,"form-select",3,"ngModel","ngModelChange","change"],["value",""],["value","Borrador"],["value","Enviada"],["value","Pagada"],["value","Vencida"],["value","Cancelada"],["class","mt-3",4,"ngIf"],["class","col-12 col-lg-6 mb-4",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],["id","modalFactura","tabindex","-1","data-bs-backdrop","static",1,"modal","fade"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"col-12","col-lg-6"],[1,"card","border-0","bg-light","mb-4"],[1,"card-header","bg-transparent","border-0"],[1,"mb-0"],[1,"bi","bi-info-circle","me-2"],[1,"col-6"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","numero","placeholder","FAC-2025-001",1,"form-control"],["formControlName","estado",1,"form-select"],["type","text","formControlName","clienteNombre","placeholder","Nombre del cliente",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-person-lines-fill"],["type","email","formControlName","clienteEmail","placeholder","cliente@email.com",1,"form-control"],["type","tel","formControlName","clienteTelefono","placeholder","600 123 456",1,"form-control"],["type","date","formControlName","fechaEmision",1,"form-control"],["type","date","formControlName","fechaVencimiento",1,"form-control"],["formControlName","metodoPago",1,"form-select"],["value","Efectivo"],["value","Tarjeta"],["value","Transferencia"],["value","Bizum"],["value","Cheque"],[1,"bi","bi-calculator","me-2"],[1,"row","mb-3"],[1,"text-center","p-3","bg-warning","bg-opacity-10","rounded","mb-3"],["class","mb-3",4,"ngIf"],[1,"text-center","p-3","bg-danger","bg-opacity-10","rounded","mb-3"],[1,"mb-1","text-danger"],["rows","3","formControlName","observaciones","placeholder","Observaciones de la factura...",1,"form-control"],[1,"card","border-0","bg-light"],[1,"card-header","bg-transparent","border-0","d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-sm","btn-info",3,"click"],[1,"table-responsive"],[1,"table","table-borderless"],["width","50"],["formArrayName","productos"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"mt-3"],[1,"bi","bi-funnel","me-1"],[1,"btn","btn-sm","btn-link","p-0","ms-2",3,"click"],[1,"bi","bi-x-circle"],[1,"col-12","col-lg-6","mb-4"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"d-flex","align-items-center"],[1,"bi","bi-receipt","text-muted","me-2"],[1,"badge","ms-2"],[1,"d-flex","gap-2"],["title","Ver factura",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"bi","bi-eye"],["title","Imprimir factura",1,"btn","btn-sm","btn-outline-info",3,"click"],[1,"bi","bi-printer"],["title","Editar factura",1,"btn","btn-sm","btn-outline-secondary",3,"disabled","click"],[1,"bi","bi-pencil"],["title","Eliminar factura",1,"btn","btn-sm","btn-outline-danger",3,"disabled","click"],[1,"bi","bi-trash"],[1,"fw-bold"],[1,"col-4"],[1,"fw-bold","text-danger"],[1,"text-muted","d-block","mb-2"],[1,"product-list"],["class","d-flex justify-content-between align-items-center mb-1",4,"ngFor","ngForOf"],["class","text-muted small",4,"ngIf"],[1,"mt-3","pt-3","border-top"],[1,"d-flex","gap-2","flex-wrap"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","btn btn-sm btn-warning",3,"click",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mb-1"],[1,"small"],[1,"small","text-muted"],[1,"text-muted","small"],[1,"text-muted","d-block"],[1,"text-info"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"bi","bi-send"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"bi","bi-check-circle"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"text-center","py-5"],[1,"bi","bi-search","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"bi","bi-receipt","fs-1","text-muted"],[1,"bi","bi-plus","me-1"],[1,"p-3","bg-info","bg-opacity-10","rounded"],[1,"text-center","mb-2"],["class","row",4,"ngFor","ngForOf"],[1,"my-2"],[1,"col-6","text-end"],[3,"formGroupName"],["formControlName","productoId",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","cantidad","min","0","step","1",1,"form-control",3,"input"],["type","number","formControlName","precioUnitario","min","0","step","0.01",1,"form-control",3,"input"],[1,"fw-bold","text-info"],[1,"fw-bold","text-success"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[3,"value"]],template:function(n,a){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h3",4),t.EFF(6,"Gesti\xf3n de Facturas"),t.k0s(),t.j41(7,"span",5),t.EFF(8,"Administra las facturas de venta a clientes"),t.k0s()(),t.j41(9,"button",6),t.bIt("click",function(){return a.abrirModalFactura()}),t.nrm(10,"i",7),t.EFF(11," Nueva Factura "),t.k0s()()()(),t.j41(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"h2",12),t.EFF(17),t.k0s(),t.j41(18,"p",13),t.EFF(19,"Total Facturas"),t.k0s()()()(),t.j41(20,"div",9)(21,"div",10)(22,"div",11)(23,"h2",14),t.EFF(24),t.k0s(),t.j41(25,"p",13),t.EFF(26,"Pagadas"),t.k0s()()()(),t.j41(27,"div",9)(28,"div",10)(29,"div",11)(30,"h2",15),t.EFF(31),t.k0s(),t.j41(32,"p",13),t.EFF(33,"Pendientes"),t.k0s()()()(),t.j41(34,"div",9)(35,"div",10)(36,"div",11)(37,"h2",16),t.EFF(38),t.nI1(39,"currency"),t.k0s(),t.j41(40,"p",13),t.EFF(41,"Valor Total"),t.k0s()()()()(),t.j41(42,"div",8)(43,"div",2)(44,"div",17)(45,"div",18)(46,"div",19)(47,"div",20)(48,"div",21)(49,"span",22),t.nrm(50,"i",23),t.k0s(),t.j41(51,"input",24),t.bIt("ngModelChange",function(c){return a.filtros.busqueda=c})("input",function(){return a.aplicarFiltros()}),t.k0s()()(),t.j41(52,"div",25)(53,"select",26),t.bIt("ngModelChange",function(c){return a.filtros.estado=c})("change",function(){return a.aplicarFiltros()}),t.j41(54,"option",27),t.EFF(55,"Todos los estados"),t.k0s(),t.j41(56,"option",28),t.EFF(57,"Borrador"),t.k0s(),t.j41(58,"option",29),t.EFF(59,"Enviada"),t.k0s(),t.j41(60,"option",30),t.EFF(61,"Pagada"),t.k0s(),t.j41(62,"option",31),t.EFF(63,"Vencida"),t.k0s(),t.j41(64,"option",32),t.EFF(65,"Cancelada"),t.k0s()()()(),t.DNE(66,O,7,2,"div",33),t.k0s()()()(),t.j41(67,"div",1),t.DNE(68,N,69,43,"div",34),t.DNE(69,$,10,0,"div",35),t.DNE(70,V,10,0,"div",35),t.k0s()(),t.j41(71,"div",36)(72,"div",37)(73,"div",38)(74,"div",39)(75,"h5",40),t.EFF(76),t.k0s(),t.j41(77,"button",41),t.bIt("click",function(){return a.cerrarModal()}),t.k0s()(),t.j41(78,"div",42)(79,"form",43),t.bIt("ngSubmit",function(){return a.guardarFactura()}),t.j41(80,"div",1)(81,"div",44)(82,"div",45)(83,"div",46)(84,"h6",47),t.nrm(85,"i",48),t.EFF(86," Informaci\xf3n de la Factura "),t.k0s()(),t.j41(87,"div",18)(88,"div",1)(89,"div",49)(90,"div",50)(91,"label",51),t.EFF(92,"N\xfamero de Factura *"),t.k0s(),t.nrm(93,"input",52),t.k0s()(),t.j41(94,"div",49)(95,"div",50)(96,"label",51),t.EFF(97,"Estado"),t.k0s(),t.j41(98,"select",53)(99,"option",28),t.EFF(100,"Borrador"),t.k0s(),t.j41(101,"option",29),t.EFF(102,"Enviada"),t.k0s(),t.j41(103,"option",30),t.EFF(104,"Pagada"),t.k0s(),t.j41(105,"option",31),t.EFF(106,"Vencida"),t.k0s(),t.j41(107,"option",32),t.EFF(108,"Cancelada"),t.k0s()()()()(),t.j41(109,"div",50)(110,"label",51),t.EFF(111,"Cliente *"),t.k0s(),t.j41(112,"div",21),t.nrm(113,"input",54),t.j41(114,"button",55),t.bIt("click",function(){return a.seleccionarClienteExistente()}),t.nrm(115,"i",56),t.k0s()()(),t.j41(116,"div",1)(117,"div",49)(118,"div",50)(119,"label",51),t.EFF(120,"Email del Cliente"),t.k0s(),t.nrm(121,"input",57),t.k0s()(),t.j41(122,"div",49)(123,"div",50)(124,"label",51),t.EFF(125,"Tel\xe9fono"),t.k0s(),t.nrm(126,"input",58),t.k0s()()(),t.j41(127,"div",1)(128,"div",49)(129,"div",50)(130,"label",51),t.EFF(131,"Fecha de Emisi\xf3n *"),t.k0s(),t.nrm(132,"input",59),t.k0s()(),t.j41(133,"div",49)(134,"div",50)(135,"label",51),t.EFF(136,"Fecha de Vencimiento *"),t.k0s(),t.nrm(137,"input",60),t.k0s()()(),t.j41(138,"div",50)(139,"label",51),t.EFF(140,"M\xe9todo de Pago"),t.k0s(),t.j41(141,"select",61)(142,"option",62),t.EFF(143,"Efectivo"),t.k0s(),t.j41(144,"option",63),t.EFF(145,"Tarjeta"),t.k0s(),t.j41(146,"option",64),t.EFF(147,"Transferencia"),t.k0s(),t.j41(148,"option",65),t.EFF(149,"Bizum"),t.k0s(),t.j41(150,"option",66),t.EFF(151,"Cheque"),t.k0s()()()()()(),t.j41(152,"div",44)(153,"div",45)(154,"div",46)(155,"h6",47),t.nrm(156,"i",67),t.EFF(157," Resumen de la Factura "),t.k0s()(),t.j41(158,"div",18)(159,"div",68)(160,"div",2)(161,"div",69)(162,"h4",4),t.EFF(163),t.nI1(164,"currency"),t.k0s(),t.j41(165,"small",5),t.EFF(166,"Subtotal"),t.k0s()()()(),t.DNE(167,S,14,7,"div",70),t.j41(168,"div",71)(169,"h3",72),t.EFF(170),t.nI1(171,"currency"),t.k0s(),t.j41(172,"small",5),t.EFF(173,"Total"),t.k0s()(),t.j41(174,"div",50)(175,"label",51),t.EFF(176,"Observaciones"),t.k0s(),t.nrm(177,"textarea",73),t.k0s()()()()(),t.j41(178,"div",74)(179,"div",75)(180,"h6",47),t.EFF(181,"Productos de la Factura"),t.k0s(),t.j41(182,"button",76),t.bIt("click",function(){return a.agregarProducto()}),t.nrm(183,"i",7),t.EFF(184," Agregar Producto "),t.k0s()(),t.j41(185,"div",18)(186,"div",77)(187,"table",78)(188,"thead")(189,"tr")(190,"th"),t.EFF(191,"Producto"),t.k0s(),t.j41(192,"th"),t.EFF(193,"Cantidad"),t.k0s(),t.j41(194,"th"),t.EFF(195,"Precio Unit."),t.k0s(),t.j41(196,"th"),t.EFF(197,"Subtotal"),t.k0s(),t.j41(198,"th"),t.EFF(199,"IVA"),t.k0s(),t.j41(200,"th"),t.EFF(201,"Total"),t.k0s(),t.nrm(202,"th",79),t.k0s()(),t.j41(203,"tbody",80),t.DNE(204,B,25,20,"tr",81),t.k0s()()()()()()(),t.j41(205,"div",82)(206,"button",83),t.bIt("click",function(){return a.cerrarModal()}),t.EFF(207," Cancelar "),t.k0s(),t.j41(208,"button",84),t.bIt("click",function(){return a.guardarFactura()}),t.EFF(209),t.k0s()()()()()),2&n&&(t.R7$(17),t.SpI(" ",a.estadisticas.totalFacturas," "),t.R7$(7),t.SpI(" ",a.estadisticas.pagadas," "),t.R7$(7),t.SpI(" ",a.estadisticas.pendientes," "),t.R7$(7),t.SpI(" ",t.ii3(39,18,a.estadisticas.valorTotal,"EUR","symbol","1.2-2")," "),t.R7$(13),t.Y8G("ngModel",a.filtros.busqueda),t.R7$(2),t.Y8G("ngModel",a.filtros.estado),t.R7$(13),t.Y8G("ngIf",a.filtros.busqueda||a.filtros.estado),t.R7$(2),t.Y8G("ngForOf",a.facturasFiltradas),t.R7$(1),t.Y8G("ngIf",0===a.facturasFiltradas.length&&a.facturas.length>0),t.R7$(1),t.Y8G("ngIf",0===a.facturas.length),t.R7$(6),t.SpI(" ",a.modoEdicion?"Editar":"Nueva"," Factura "),t.R7$(3),t.Y8G("formGroup",a.facturaForm),t.R7$(84),t.SpI(" ",t.ii3(164,23,a.subtotalFactura,"EUR","symbol","1.2-2")," "),t.R7$(4),t.Y8G("ngIf",a.ivaBreakdown.length>0),t.R7$(3),t.SpI(" ",t.ii3(171,28,a.totalFactura,"EUR","symbol","1.2-2")," "),t.R7$(34),t.Y8G("ngForOf",a.productosFormArray.controls),t.R7$(4),t.Y8G("disabled",!a.facturaForm.valid),t.R7$(1),t.SpI(" ",a.modoEdicion?"Actualizar":"Crear"," Factura "))},dependencies:[g.Sq,g.bT,i.qT,i.xH,i.y7,i.me,i.Q0,i.wz,i.BC,i.cb,i.VZ,i.j4,i.JD,i.$R,i.v8,i.vS,g.oe,g.vh],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px}.container-fluid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.container-fluid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026!important}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]{max-height:120px;overflow-y:auto}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:2px}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:2px}.container-fluid[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.container-fluid[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{border-radius:8px}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin-bottom:0}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:2px solid var(--bs-border-color);font-weight:600;font-size:.875rem;padding:12px 8px}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px;vertical-align:middle}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem}.container-fluid[_ngcontent-%COMP%]   .modal-xl[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}.container-fluid[_ngcontent-%COMP%]   .bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important}.container-fluid[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.container-fluid[_ngcontent-%COMP%]   .text-success[_ngcontent-%COMP%]{color:#198754!important}.container-fluid[_ngcontent-%COMP%]   .text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.container-fluid[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#0dcaf0!important}.container-fluid[_ngcontent-%COMP%]   .border-top[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-info[_ngcontent-%COMP%]{background-color:#0dcaf0!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-success[_ngcontent-%COMP%]{background-color:#198754!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-danger[_ngcontent-%COMP%]{background-color:#dc3545!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-dark[_ngcontent-%COMP%]{background-color:#212529!important}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{transition:all .2s ease}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.container-fluid[_ngcontent-%COMP%]   .bg-info.bg-opacity-10[_ngcontent-%COMP%]{background-color:#0dcaf01a!important}.container-fluid[_ngcontent-%COMP%]   .bg-warning.bg-opacity-10[_ngcontent-%COMP%]{background-color:#ffc1071a!important}.container-fluid[_ngcontent-%COMP%]   .bg-danger.bg-opacity-10[_ngcontent-%COMP%]{background-color:#dc35451a!important}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:10px}.container-fluid[_ngcontent-%COMP%]   .col-12.col-lg-6[_ngcontent-%COMP%]{margin-bottom:1rem}.container-fluid[_ngcontent-%COMP%]   .d-flex.gap-2[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem!important}.container-fluid[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.2rem .4rem;font-size:.8rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{font-size:.8rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 4px}.container-fluid[_ngcontent-%COMP%]   .modal-xl[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{margin:.5rem;max-width:calc(100% - 1rem)}}@media (max-width: 576px){.container-fluid[_ngcontent-%COMP%]   .row.g-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:1rem}.container-fluid[_ngcontent-%COMP%]   .col-12.col-md-8[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .col-12.col-md-4[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%}.container-fluid[_ngcontent-%COMP%]   .d-flex.justify-content-between[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.container-fluid[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}}.text-danger.fw-bold[_ngcontent-%COMP%]{font-weight:700!important}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .2rem #0d6efd40}.btn-group-sm[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%], .btn-sm[_ngcontent-%COMP%]{--bs-btn-padding-y: .25rem;--bs-btn-padding-x: .5rem;--bs-btn-font-size: .875rem;--bs-btn-border-radius: .375rem}"]})}}return o})()}];let U=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[k.iI.forChild(D),k.iI]})}}return o})(),Y=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[U,C.PrivateModule,g.MD,i.X1,i.YN]})}}return o})()}}]);