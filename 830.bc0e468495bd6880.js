"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[830],{5449:(Q,E,u)=>{u.r(E),u.d(E,{FacturasPageModule:()=>q});var j=u(7412),r=u(9417),g=u(177),k=u(5743),b=u(467),d=u(9173),C=u(8032),l=u.n(C),y=u(8359),t=u(7705);function M(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",105)(1,"small",5),t.nrm(2,"i",106),t.EFF(3),t.j41(4,"button",107),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.limpiarFiltros())}),t.nrm(5,"i",108),t.EFF(6," Limpiar filtros "),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(3),t.Lme(" Mostrando ",e.facturasFiltradas.length," de ",e.facturas.length," facturas ")}}function I(n,c){if(1&n&&(t.j41(0,"div",127)(1,"span",128),t.EFF(2),t.k0s(),t.j41(3,"span",129),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&n){const e=c.$implicit;t.R7$(2),t.JRh(e.productoNombre),t.R7$(2),t.Lme("",e.cantidad," x ",t.ii3(5,3,e.precioUnitario,"EUR","symbol","1.2-2"),"")}}function O(n,c){if(1&n&&(t.j41(0,"div",130),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(1),t.SpI(" +",e.productos.length-3," productos m\xe1s ")}}function R(n,c){if(1&n&&(t.j41(0,"div",71)(1,"small",131),t.EFF(2,"Observaciones:"),t.k0s(),t.j41(3,"small",132),t.EFF(4),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(4),t.JRh(e.observaciones)}}function x(n,c){if(1&n){const e=t.RV6();t.j41(0,"button",133),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,i=t.XpG();return t.Njj(i.enviarFactura(a))}),t.nrm(1,"i",134),t.EFF(2," Enviar "),t.k0s()}}function S(n,c){if(1&n){const e=t.RV6();t.j41(0,"button",135),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,i=t.XpG();return t.Njj(i.marcarComoPagada(a))}),t.nrm(1,"i",136),t.EFF(2," Marcar como Pagada "),t.k0s()}}function T(n,c){if(1&n){const e=t.RV6();t.j41(0,"button",137),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,i=t.XpG();return t.Njj(i.cancelarFactura(a))}),t.nrm(1,"i",108),t.EFF(2," Cancelar "),t.k0s()}}function $(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",109)(1,"div",110),t.bIt("click",function(){const i=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.verDetalleFactura(i))}),t.j41(2,"div",18)(3,"div",111)(4,"div",112),t.nrm(5,"i",113),t.j41(6,"h5",68),t.EFF(7),t.k0s(),t.j41(8,"span",114),t.EFF(9),t.k0s()()(),t.j41(10,"div",71)(11,"strong"),t.EFF(12),t.k0s(),t.nrm(13,"br"),t.j41(14,"small",5),t.EFF(15),t.k0s()(),t.j41(16,"div",89)(17,"div",70)(18,"small",5),t.EFF(19,"Fecha Emisi\xf3n"),t.k0s(),t.j41(20,"div",115),t.EFF(21),t.nI1(22,"date"),t.k0s()(),t.j41(23,"div",70)(24,"small",5),t.EFF(25,"Fecha Vencimiento"),t.k0s(),t.j41(26,"div",115),t.EFF(27),t.nI1(28,"date"),t.k0s()()(),t.j41(29,"div",89)(30,"div",116)(31,"small",5),t.EFF(32,"Subtotal"),t.k0s(),t.j41(33,"div",115),t.EFF(34),t.nI1(35,"currency"),t.k0s()(),t.j41(36,"div",116)(37,"small",5),t.EFF(38,"IVA"),t.k0s(),t.j41(39,"div",115),t.EFF(40),t.nI1(41,"currency"),t.k0s()(),t.j41(42,"div",116)(43,"small",5),t.EFF(44,"Total"),t.k0s(),t.j41(45,"div",117),t.EFF(46),t.nI1(47,"currency"),t.k0s()()(),t.j41(48,"div",71)(49,"small",118),t.EFF(50),t.k0s(),t.j41(51,"div",119),t.DNE(52,I,6,8,"div",120),t.DNE(53,O,2,1,"div",121),t.k0s()(),t.DNE(54,R,5,1,"div",91),t.j41(55,"div",122)(56,"div",123),t.DNE(57,x,3,0,"button",124),t.DNE(58,S,3,0,"button",125),t.DNE(59,T,3,0,"button",126),t.k0s()()()()()}if(2&n){const e=c.$implicit,o=t.XpG();t.R7$(7),t.JRh(e.numero),t.R7$(1),t.HbH(o.getEstadoBadgeClass(e.estado)),t.R7$(1),t.SpI(" ",e.estado," "),t.R7$(3),t.JRh(e.clienteNombre),t.R7$(3),t.JRh(e.clienteEmail||"Sin email"),t.R7$(6),t.SpI(" ",t.i5U(22,20,e.fechaEmision,"dd/MM/yyyy")," "),t.R7$(5),t.AVh("text-danger",o.isFacturaVencida(e)),t.R7$(1),t.SpI(" ",t.i5U(28,23,e.fechaVencimiento,"dd/MM/yyyy")," "),t.R7$(7),t.SpI(" ",t.ii3(35,26,e.subtotal,"EUR","symbol","1.2-2")," "),t.R7$(6),t.SpI(" ",t.ii3(41,31,e.iva,"EUR","symbol","1.2-2")," "),t.R7$(6),t.SpI(" ",t.ii3(47,36,e.total,"EUR","symbol","1.2-2")," "),t.R7$(4),t.SpI("Productos (",e.productos.length,"):"),t.R7$(2),t.Y8G("ngForOf",e.productos.slice(0,3)),t.R7$(1),t.Y8G("ngIf",e.productos.length>3),t.R7$(1),t.Y8G("ngIf",e.observaciones),t.R7$(3),t.Y8G("ngIf","Borrador"===e.estado),t.R7$(1),t.Y8G("ngIf","Enviada"===e.estado||"Vencida"===e.estado),t.R7$(1),t.Y8G("ngIf","Pagada"!==e.estado&&"Cancelada"!==e.estado)}}function w(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",138),t.nrm(2,"i",139),t.j41(3,"h5",140),t.EFF(4,"No se encontraron facturas"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Intenta ajustar los filtros de b\xfasqueda"),t.k0s(),t.j41(7,"button",141),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.limpiarFiltros())}),t.nrm(8,"i",142),t.EFF(9," Mostrar todas las facturas "),t.k0s()()()}}function N(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",138),t.nrm(2,"i",143),t.j41(3,"h5",140),t.EFF(4,"No tienes facturas creadas"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Crea tu primera factura para comenzar"),t.k0s(),t.j41(7,"button",6),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.abrirModalFactura())}),t.nrm(8,"i",144),t.EFF(9," Nueva Factura "),t.k0s()()()}}function V(n,c){if(1&n&&(t.j41(0,"div",161)(1,"div",5),t.nrm(2,"i",176),t.EFF(3),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(3),t.SpI(" ",e.facturaSeleccionada.clienteEmail," ")}}function D(n,c){if(1&n&&(t.j41(0,"div",161)(1,"div",5),t.nrm(2,"i",177),t.EFF(3),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(3),t.SpI(" ",e.facturaSeleccionada.clienteTelefono," ")}}function G(n,c){if(1&n&&(t.j41(0,"tr")(1,"td")(2,"div",115),t.EFF(3),t.k0s(),t.j41(4,"small",5),t.EFF(5),t.k0s()(),t.j41(6,"td",167)(7,"span",178),t.EFF(8),t.k0s()(),t.j41(9,"td",45),t.EFF(10),t.nI1(11,"currency"),t.k0s(),t.j41(12,"td",45),t.EFF(13),t.nI1(14,"currency"),t.k0s(),t.j41(15,"td",179),t.EFF(16),t.nI1(17,"currency"),t.k0s(),t.j41(18,"td",170),t.EFF(19),t.nI1(20,"currency"),t.k0s()()),2&n){const e=c.$implicit;t.R7$(3),t.JRh(e.productoNombre),t.R7$(2),t.SpI("IVA: ",e.ivaProducto,"%"),t.R7$(3),t.JRh(e.cantidad),t.R7$(2),t.SpI(" ",t.ii3(11,7,e.precioUnitario,"EUR","symbol","1.2-2")," "),t.R7$(3),t.SpI(" ",t.ii3(14,12,e.subtotal,"EUR","symbol","1.2-2")," "),t.R7$(3),t.SpI(" ",t.ii3(17,17,e.ivaImporte,"EUR","symbol","1.2-2")," "),t.R7$(3),t.SpI(" ",t.ii3(20,22,e.total,"EUR","symbol","1.2-2")," ")}}function A(n,c){if(1&n&&(t.j41(0,"div",95)(1,"div",18)(2,"h6",162),t.nrm(3,"i",180),t.EFF(4,"Observaciones"),t.k0s(),t.j41(5,"p",68),t.EFF(6),t.k0s()()()),2&n){const e=t.XpG(2);t.R7$(6),t.JRh(e.facturaSeleccionada.observaciones)}}function B(n,c){if(1&n&&(t.j41(0,"div",145)(1,"div",146)(2,"div",147)(3,"div",148)(4,"div",11),t.nrm(5,"i",149),t.j41(6,"h6",150),t.EFF(7),t.nI1(8,"date"),t.k0s(),t.j41(9,"small",5),t.EFF(10,"Fecha Emisi\xf3n"),t.k0s()()()(),t.j41(11,"div",147)(12,"div",151)(13,"div",11),t.nrm(14,"i",152),t.j41(15,"h6",153),t.EFF(16),t.nI1(17,"date"),t.k0s(),t.j41(18,"small",5),t.EFF(19,"Vencimiento"),t.k0s()()()(),t.j41(20,"div",147)(21,"div",154)(22,"div",11),t.nrm(23,"i",155),t.j41(24,"h6",156),t.EFF(25),t.k0s(),t.j41(26,"small",5),t.EFF(27,"M\xe9todo de Pago"),t.k0s()()()(),t.j41(28,"div",147)(29,"div",157)(30,"div",11),t.nrm(31,"i",158),t.j41(32,"h5",159),t.EFF(33),t.k0s(),t.j41(34,"small",5),t.EFF(35,"Productos"),t.k0s()()()()(),t.j41(36,"div",66)(37,"div",18)(38,"h6",71),t.nrm(39,"i",160),t.EFF(40,"Informaci\xf3n del Cliente"),t.k0s(),t.j41(41,"div",1)(42,"div",161)(43,"div",162)(44,"strong"),t.EFF(45),t.k0s()()(),t.DNE(46,V,4,1,"div",163),t.DNE(47,D,4,1,"div",163),t.k0s()()(),t.j41(48,"div",66)(49,"div",18)(50,"h6",71),t.nrm(51,"i",164),t.EFF(52,"Productos de la Factura"),t.k0s(),t.j41(53,"div",98)(54,"table",165)(55,"thead",166)(56,"tr")(57,"th"),t.EFF(58,"Producto"),t.k0s(),t.j41(59,"th",167),t.EFF(60,"Cantidad"),t.k0s(),t.j41(61,"th",45),t.EFF(62,"Precio Unit."),t.k0s(),t.j41(63,"th",45),t.EFF(64,"Subtotal"),t.k0s(),t.j41(65,"th",45),t.EFF(66,"IVA"),t.k0s(),t.j41(67,"th",45),t.EFF(68,"Total"),t.k0s()()(),t.j41(69,"tbody"),t.DNE(70,G,21,27,"tr",168),t.k0s(),t.j41(71,"tfoot",166)(72,"tr")(73,"td",169),t.EFF(74,"Subtotal:"),t.k0s(),t.j41(75,"td",170),t.EFF(76),t.nI1(77,"currency"),t.k0s(),t.nrm(78,"td",171),t.k0s(),t.j41(79,"tr")(80,"td",169),t.EFF(81,"IVA Total:"),t.k0s(),t.j41(82,"td",172),t.EFF(83),t.nI1(84,"currency"),t.k0s(),t.nrm(85,"td",171),t.k0s(),t.j41(86,"tr")(87,"td",173),t.EFF(88,"Total:"),t.k0s(),t.j41(89,"td",174),t.EFF(90),t.nI1(91,"currency"),t.k0s(),t.nrm(92,"td",171),t.k0s()()()()()(),t.DNE(93,A,7,1,"div",175),t.k0s()),2&n){const e=t.XpG();t.R7$(7),t.JRh(t.i5U(8,14,e.facturaSeleccionada.fechaEmision,"dd/MM/yyyy")),t.R7$(8),t.AVh("text-danger",e.isFacturaVencida(e.facturaSeleccionada)),t.R7$(1),t.SpI(" ",t.i5U(17,17,e.facturaSeleccionada.fechaVencimiento,"dd/MM/yyyy")," "),t.R7$(9),t.JRh(e.facturaSeleccionada.metodoPago),t.R7$(8),t.JRh(e.facturaSeleccionada.productos.length||0),t.R7$(12),t.JRh(e.facturaSeleccionada.clienteNombre),t.R7$(1),t.Y8G("ngIf",e.facturaSeleccionada.clienteEmail),t.R7$(1),t.Y8G("ngIf",e.facturaSeleccionada.clienteTelefono),t.R7$(23),t.Y8G("ngForOf",e.facturaSeleccionada.productos),t.R7$(6),t.SpI(" ",t.ii3(77,20,e.facturaSeleccionada.subtotal,"EUR","symbol","1.2-2")," "),t.R7$(7),t.SpI(" ",t.ii3(84,25,e.facturaSeleccionada.iva,"EUR","symbol","1.2-2")," "),t.R7$(7),t.SpI(" ",t.ii3(91,30,e.facturaSeleccionada.total,"EUR","symbol","1.2-2")," "),t.R7$(3),t.Y8G("ngIf",e.facturaSeleccionada.observaciones)}}function U(n,c){if(1&n&&(t.j41(0,"div",1)(1,"div",185)(2,"small",5),t.EFF(3),t.k0s()(),t.j41(4,"div",70)(5,"small",115),t.EFF(6),t.nI1(7,"currency"),t.k0s()()()),2&n){const e=c.$implicit;t.R7$(3),t.SpI("IVA ",e.porcentaje,"%:"),t.R7$(3),t.JRh(t.ii3(7,2,e.importe,"EUR","symbol","1.2-2"))}}function Y(n,c){if(1&n&&(t.j41(0,"div",71)(1,"div",181)(2,"h6",182),t.EFF(3,"Desglose de IVA"),t.k0s(),t.DNE(4,U,8,7,"div",183),t.nrm(5,"hr",184),t.j41(6,"div",1)(7,"div",185)(8,"strong"),t.EFF(9,"Total IVA:"),t.k0s()(),t.j41(10,"div",70)(11,"strong"),t.EFF(12),t.nI1(13,"currency"),t.k0s()()()()()),2&n){const e=t.XpG();t.R7$(4),t.Y8G("ngForOf",e.ivaBreakdown),t.R7$(8),t.JRh(t.ii3(13,2,e.ivaFactura,"EUR","symbol","1.2-2"))}}function X(n,c){if(1&n&&(t.j41(0,"option",195),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function z(n,c){if(1&n){const e=t.RV6();t.j41(0,"tr",186)(1,"td")(2,"select",187),t.bIt("change",function(){const i=t.eBV(e).index,s=t.XpG();return t.Njj(s.onProductoChange(i))}),t.j41(3,"option",27),t.EFF(4,"Seleccionar producto"),t.k0s(),t.DNE(5,X,2,2,"option",188),t.k0s()(),t.j41(6,"td")(7,"input",189),t.bIt("input",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.calcularTotales())}),t.k0s()(),t.j41(8,"td")(9,"input",190),t.bIt("input",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.calcularTotales())}),t.k0s()(),t.j41(10,"td")(11,"span",115),t.EFF(12),t.nI1(13,"currency"),t.k0s()(),t.j41(14,"td")(15,"span",191),t.EFF(16),t.nI1(17,"currency"),t.k0s()(),t.j41(18,"td")(19,"span",192),t.EFF(20),t.nI1(21,"currency"),t.k0s()(),t.j41(22,"td")(23,"button",193),t.bIt("click",function(){const i=t.eBV(e).index,s=t.XpG();return t.Njj(s.eliminarProducto(i))}),t.nrm(24,"i",194),t.k0s()()()}if(2&n){const e=c.index,o=t.XpG();t.Y8G("formGroupName",e),t.R7$(5),t.Y8G("ngForOf",o.productos),t.R7$(7),t.JRh(t.ii3(13,5,o.getProductoSubtotal(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(17,10,o.getProductoIvaImporte(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(21,15,o.getProductoTotal(e),"EUR","symbol","1.2-2"))}}const J=[{path:"",component:(()=>{class n{constructor(e,o){this.fb=e,this.firestore=o,this.facturas=[],this.facturasFiltradas=[],this.facturaSeleccionada=null,this.productos=[],this.modoEdicion=!1,this.facturaEditando=null,this.estadisticas={totalFacturas:0,pagadas:0,pendientes:0,valorTotal:0},this.filtros={busqueda:"",estado:""},this.subtotalFactura=0,this.ivaFactura=0,this.totalFactura=0,this.ivaBreakdown=[],this.subscriptions=new y.yU,this.initForm()}ngOnInit(){this.cargarFacturas(),this.cargarProductos(),this.initModal()}ngOnDestroy(){this.subscriptions.unsubscribe()}initForm(){this.facturaForm=this.fb.group({numero:["",r.k0.required],clienteNombre:["",r.k0.required],clienteEmail:[""],clienteTelefono:[""],fechaEmision:[(new Date).toISOString().split("T")[0],r.k0.required],fechaVencimiento:[this.getFechaVencimientoDefault(),r.k0.required],estado:["Borrador"],metodoPago:["Efectivo"],observaciones:[""],productos:this.fb.array([])})}getFechaVencimientoDefault(){const e=new Date;return e.setDate(e.getDate()+30),e.toISOString().split("T")[0]}initModal(){const e=document.getElementById("modalFactura");e&&(this.modal=new bootstrap.Modal(e))}cargarFacturas(){const e=(0,d.collection)(this.firestore,"facturas");this.subscriptions.add((0,d.collectionData)(e,{idField:"id"}).subscribe(o=>{this.facturas=o.map(a=>({...a,fechaEmision:a.fechaEmision?.toDate()||new Date,fechaVencimiento:a.fechaVencimiento?.toDate()||new Date})),this.actualizarEstadisticas(),this.aplicarFiltros()}))}cargarProductos(){const e=(0,d.collection)(this.firestore,"productos");this.subscriptions.add((0,d.collectionData)(e,{idField:"id"}).subscribe(o=>{this.productos=o}))}actualizarEstadisticas(){this.estadisticas.totalFacturas=this.facturas.length,this.estadisticas.pagadas=this.facturas.filter(e=>"Pagada"===e.estado).length,this.estadisticas.pendientes=this.facturas.filter(e=>"Enviada"===e.estado||"Vencida"===e.estado).length,this.estadisticas.valorTotal=this.facturas.reduce((e,o)=>e+o.total,0)}get productosFormArray(){return this.facturaForm.get("productos")}aplicarFiltros(){let e=[...this.facturas];if(this.filtros.busqueda){const o=this.filtros.busqueda.toLowerCase();e=e.filter(a=>a.numero.toLowerCase().includes(o)||a.clienteNombre.toLowerCase().includes(o)||a.clienteEmail&&a.clienteEmail.toLowerCase().includes(o))}this.filtros.estado&&(e=e.filter(o=>o.estado===this.filtros.estado)),this.facturasFiltradas=e}limpiarFiltros(){this.filtros={busqueda:"",estado:""},this.aplicarFiltros()}abrirModalFactura(){this.modoEdicion=!1,this.facturaEditando=null,this.resetForm(),this.generarNumeroFactura(),this.modal.show()}generarNumeroFactura(){const a=`FAC-${(new Date).getFullYear()}-${(this.facturas.length+1).toString().padStart(3,"0")}`;this.facturaForm.patchValue({numero:a})}editarFactura(e){"Pagada"!==e.estado?(this.modoEdicion=!0,this.facturaEditando=e,this.cargarFacturaEnFormulario(e),this.modal.show()):l().fire("Error","No se puede editar una factura pagada","error")}cargarFacturaEnFormulario(e){this.facturaForm.patchValue({numero:e.numero,clienteNombre:e.clienteNombre,clienteEmail:e.clienteEmail||"",clienteTelefono:e.clienteTelefono||"",fechaEmision:e.fechaEmision.toISOString().split("T")[0],fechaVencimiento:e.fechaVencimiento.toISOString().split("T")[0],estado:e.estado,metodoPago:e.metodoPago,observaciones:e.observaciones||""});const o=this.productosFormArray;o.clear(),e.productos.forEach(a=>{o.push(this.fb.group({productoId:[a.productoId,r.k0.required],cantidad:[a.cantidad,[r.k0.required,r.k0.min(1)]],precioUnitario:[a.precioUnitario,[r.k0.required,r.k0.min(0)]]}))}),this.calcularTotales()}agregarProducto(){const e=this.fb.group({productoId:["",r.k0.required],cantidad:[1,[r.k0.required,r.k0.min(1)]],precioUnitario:[0,[r.k0.required,r.k0.min(0)]]});this.productosFormArray.push(e)}eliminarProducto(e){this.productosFormArray.removeAt(e),this.calcularTotales()}onProductoChange(e){const o=this.productosFormArray.at(e),a=o.get("productoId")?.value;if(a){const i=this.productos.find(s=>s.id===a);i&&(o.patchValue({precioUnitario:i.costo*(1+(i.IVA||0)/100)}),this.calcularTotales())}}calcularTotales(){let e=0;const o=new Map;this.productosFormArray.controls.forEach((a,i)=>{const s=a.get("productoId")?.value,_=a.get("cantidad")?.value||0,f=a.get("precioUnitario")?.value||0;if(s&&_&&f){const m=this.productos.find(h=>h.id===s)?.IVA||0,p=_*f,F=p*(m/100);e+=p,o.has(m)?o.set(m,o.get(m)+F):o.set(m,F)}}),this.subtotalFactura=e,this.ivaFactura=Array.from(o.values()).reduce((a,i)=>a+i,0),this.totalFactura=this.subtotalFactura+this.ivaFactura,this.ivaBreakdown=Array.from(o.entries()).map(([a,i])=>({porcentaje:a,importe:i}))}getProductoSubtotal(e){const o=this.productosFormArray.at(e);return(o.get("cantidad")?.value||0)*(o.get("precioUnitario")?.value||0)}getProductoIvaImporte(e){const a=this.productosFormArray.at(e).get("productoId")?.value;if(a){const s=this.productos.find(f=>f.id===a)?.IVA||0;return this.getProductoSubtotal(e)*(s/100)}return 0}getProductoTotal(e){return this.getProductoSubtotal(e)+this.getProductoIvaImporte(e)}guardarFactura(){var e=this;return(0,b.A)(function*(){if(e.facturaForm.valid)if(0!==e.productosFormArray.length)try{l().showLoading();const o=e.facturaForm.value,a=[];e.productosFormArray.controls.forEach((s,_)=>{const f=s.get("productoId")?.value,v=s.get("cantidad")?.value,m=s.get("precioUnitario")?.value;if(f&&v&&m){const p=e.productos.find(H=>H.id===f),F=p?.IVA||0,h=v*m,P=h*(F/100);a.push({productoId:f,productoNombre:p?.nombre||"",cantidad:v,precioUnitario:m,ivaProducto:F,subtotal:h,ivaImporte:P,total:h+P})}});const i={numero:o.numero,clienteNombre:o.clienteNombre,clienteEmail:o.clienteEmail,clienteTelefono:o.clienteTelefono,fechaEmision:new Date(o.fechaEmision),fechaVencimiento:new Date(o.fechaVencimiento),estado:o.estado,metodoPago:o.metodoPago,subtotal:e.subtotalFactura,iva:e.ivaFactura,total:e.totalFactura,productos:a,observaciones:o.observaciones};if(e.modoEdicion&&e.facturaEditando?.id){i.fechaActualizacion=(0,d.serverTimestamp)();const s=(0,d.doc)(e.firestore,"facturas",e.facturaEditando.id);yield(0,d.updateDoc)(s,i),l().fire("\xa1Actualizada!","La factura ha sido actualizada exitosamente","success")}else i.fechaCreacion=(0,d.serverTimestamp)(),yield(0,d.addDoc)((0,d.collection)(e.firestore,"facturas"),i),l().fire("\xa1Creada!","La factura ha sido creada exitosamente","success");e.cerrarModal()}catch(o){console.error("Error al guardar factura:",o),l().fire("Error","Hubo un problema al guardar la factura","error")}else l().fire("Error","Debe agregar al menos un producto","error");else l().fire("Error","Por favor complete todos los campos requeridos","error")})()}eliminarFactura(e){var o=this;return(0,b.A)(function*(){if("Pagada"!==e.estado){if((yield l().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed&&e.id)try{yield(0,d.deleteDoc)((0,d.doc)(o.firestore,"facturas",e.id)),l().fire("\xa1Eliminada!","La factura ha sido eliminada","success")}catch(i){console.error("Error al eliminar factura:",i),l().fire("Error","No se pudo eliminar la factura","error")}}else l().fire("Error","No se puede eliminar una factura pagada","error")})()}verFactura(e){console.log("Ver factura:",e)}imprimirFactura(e){console.log("Imprimir factura:",e)}enviarFactura(e){var o=this;return(0,b.A)(function*(){if(e.id)try{const a=(0,d.doc)(o.firestore,"facturas",e.id);yield(0,d.updateDoc)(a,{estado:"Enviada",fechaActualizacion:(0,d.serverTimestamp)()}),l().fire("\xa1Enviada!","La factura ha sido marcada como enviada","success")}catch{l().fire("Error","No se pudo enviar la factura","error")}})()}marcarComoPagada(e){var o=this;return(0,b.A)(function*(){if(e.id)try{const a=(0,d.doc)(o.firestore,"facturas",e.id);yield(0,d.updateDoc)(a,{estado:"Pagada",fechaActualizacion:(0,d.serverTimestamp)()}),l().fire("\xa1Pagada!","La factura ha sido marcada como pagada","success")}catch{l().fire("Error","No se pudo marcar como pagada","error")}})()}cancelarFactura(e){var o=this;return(0,b.A)(function*(){if((yield l().fire({title:"\xbfCancelar factura?",text:"Esta acci\xf3n marcar\xe1 la factura como cancelada",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xed, cancelar",cancelButtonText:"No"})).isConfirmed&&e.id)try{const i=(0,d.doc)(o.firestore,"facturas",e.id);yield(0,d.updateDoc)(i,{estado:"Cancelada",fechaActualizacion:(0,d.serverTimestamp)()}),l().fire("\xa1Cancelada!","La factura ha sido cancelada","success")}catch{l().fire("Error","No se pudo cancelar la factura","error")}})()}seleccionarClienteExistente(){console.log("Seleccionar cliente existente")}cerrarModal(){this.modal.hide(),this.resetForm()}resetForm(){this.facturaForm.reset({numero:"",clienteNombre:"",clienteEmail:"",clienteTelefono:"",fechaEmision:(new Date).toISOString().split("T")[0],fechaVencimiento:this.getFechaVencimientoDefault(),estado:"Borrador",metodoPago:"Efectivo",observaciones:""}),this.productosFormArray.clear(),this.subtotalFactura=0,this.ivaFactura=0,this.totalFactura=0,this.ivaBreakdown=[]}getEstadoBadgeClass(e){return{Borrador:"bg-secondary",Enviada:"bg-info",Pagada:"bg-success",Vencida:"bg-danger",Cancelada:"bg-dark"}[e]||"bg-secondary"}isFacturaVencida(e){return e.fechaVencimiento<new Date&&"Pagada"!==e.estado}verDetalleFactura(e){this.facturaSeleccionada=e;const o=document.getElementById("detalleFacturaModal");o&&new bootstrap.Modal(o).show()}editarDesdeDetalle(){if(this.facturaSeleccionada){const e=document.getElementById("detalleFacturaModal");if(e){const o=bootstrap.Modal.getInstance(e);o&&o.hide()}setTimeout(()=>{this.editarFactura(this.facturaSeleccionada)},300)}}eliminarDesdeDetalle(){var e=this;return(0,b.A)(function*(){if(e.facturaSeleccionada){const o=document.getElementById("detalleFacturaModal");if(o){const a=bootstrap.Modal.getInstance(o);a&&a.hide()}setTimeout((0,b.A)(function*(){yield e.eliminarFactura(e.facturaSeleccionada)}),300)}})()}imprimirDesdeDetalle(){this.facturaSeleccionada&&this.imprimirFactura(this.facturaSeleccionada)}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(r.ok),t.rXU(d.Firestore))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-facturas-page"]],decls:240,vars:40,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus"],[1,"row","mt-4"],[1,"col-12","col-md-6","col-xl-3","mb-4"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-body","text-center"],[1,"text-primary","fw-bold","mb-1"],[1,"text-muted","mb-0"],[1,"text-success","fw-bold","mb-1"],[1,"text-warning","fw-bold","mb-1"],[1,"text-info","fw-bold","mb-1"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-12","col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Buscar facturas...",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"col-12","col-md-4"],[1,"form-select",3,"ngModel","ngModelChange","change"],["value",""],["value","Borrador"],["value","Enviada"],["value","Pagada"],["value","Vencida"],["value","Cancelada"],["class","mt-3",4,"ngIf"],["class","col-12 col-lg-6 mb-4",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],["id","detalleFacturaModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-xl"],[1,"modal-content"],[1,"modal-header","border-0","pb-0"],[1,"d-flex","align-items-center","w-100"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center","bg-primary","bg-opacity-10",2,"width","56px","height","56px"],[1,"bi","bi-receipt","text-primary","fs-3"],[1,"flex-grow-1"],[1,"text-muted","mb-0","small"],[1,"text-end"],[1,"badge","fs-6","px-3","py-2",3,"ngClass"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body pt-3",4,"ngIf"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-lg","me-2"],["type","button",1,"btn","btn-info",3,"click"],[1,"bi","bi-printer","me-2"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"bi","bi-pencil-fill","me-2"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"bi","bi-trash3-fill","me-2"],["id","modalFactura","tabindex","-1","data-bs-backdrop","static",1,"modal","fade"],[1,"modal-dialog","modal-xl"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"col-12","col-lg-6"],[1,"card","border-0","bg-light","mb-4"],[1,"card-header","bg-transparent","border-0"],[1,"mb-0"],[1,"bi","bi-info-circle","me-2"],[1,"col-6"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","numero","placeholder","FAC-2025-001",1,"form-control"],["formControlName","estado",1,"form-select"],["type","text","formControlName","clienteNombre","placeholder","Nombre del cliente",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-person-lines-fill"],["type","email","formControlName","clienteEmail","placeholder","cliente@email.com",1,"form-control"],["type","tel","formControlName","clienteTelefono","placeholder","600 123 456",1,"form-control"],["type","date","formControlName","fechaEmision",1,"form-control"],["type","date","formControlName","fechaVencimiento",1,"form-control"],["formControlName","metodoPago",1,"form-select"],["value","Efectivo"],["value","Tarjeta"],["value","Transferencia"],["value","Bizum"],["value","Cheque"],[1,"bi","bi-calculator","me-2"],[1,"row","mb-3"],[1,"text-center","p-3","bg-warning","bg-opacity-10","rounded","mb-3"],["class","mb-3",4,"ngIf"],[1,"text-center","p-3","bg-danger","bg-opacity-10","rounded","mb-3"],[1,"mb-1","text-danger"],["rows","3","formControlName","observaciones","placeholder","Observaciones de la factura...",1,"form-control"],[1,"card","border-0","bg-light"],[1,"card-header","bg-transparent","border-0","d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-sm","btn-info",3,"click"],[1,"table-responsive"],[1,"table","table-borderless"],["width","50"],["formArrayName","productos"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"mt-3"],[1,"bi","bi-funnel","me-1"],[1,"btn","btn-sm","btn-link","p-0","ms-2",3,"click"],[1,"bi","bi-x-circle"],[1,"col-12","col-lg-6","mb-4"],[1,"card","border-0","shadow-sm","h-100",2,"cursor","pointer",3,"click"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"d-flex","align-items-center"],[1,"bi","bi-receipt","text-muted","me-2"],[1,"badge","ms-2"],[1,"fw-bold"],[1,"col-4"],[1,"fw-bold","text-danger"],[1,"text-muted","d-block","mb-2"],[1,"product-list"],["class","d-flex justify-content-between align-items-center mb-1",4,"ngFor","ngForOf"],["class","text-muted small",4,"ngIf"],[1,"mt-3","pt-3","border-top"],[1,"d-flex","gap-2","flex-wrap"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","btn btn-sm btn-warning",3,"click",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mb-1"],[1,"small"],[1,"small","text-muted"],[1,"text-muted","small"],[1,"text-muted","d-block"],[1,"text-info"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"bi","bi-send"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"bi","bi-check-circle"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"text-center","py-5"],[1,"bi","bi-search","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"bi","bi-receipt","fs-1","text-muted"],[1,"bi","bi-plus","me-1"],[1,"modal-body","pt-3"],[1,"row","g-3","mb-4"],[1,"col-md-3"],[1,"card","border-0","bg-primary","bg-opacity-10","h-100"],[1,"bi","bi-calendar","text-primary","fs-2","d-block","mb-2"],[1,"mb-0","text-primary"],[1,"card","border-0","bg-warning","bg-opacity-10","h-100"],[1,"bi","bi-calendar-check","text-warning","fs-2","d-block","mb-2"],[1,"mb-0","text-warning"],[1,"card","border-0","bg-info","bg-opacity-10","h-100"],[1,"bi","bi-credit-card","text-info","fs-2","d-block","mb-2"],[1,"mb-0","text-info"],[1,"card","border-0","bg-success","bg-opacity-10","h-100"],[1,"bi","bi-box-seam","text-success","fs-2","d-block","mb-2"],[1,"mb-0","text-success"],[1,"bi","bi-person","me-2","text-primary"],[1,"col-md-4"],[1,"mb-2"],["class","col-md-4",4,"ngIf"],[1,"bi","bi-list-ul","me-2","text-primary"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],["colspan","3",1,"text-end","fw-bold"],[1,"text-end","fw-bold"],["colspan","2"],[1,"text-end","fw-bold","text-info"],["colspan","3",1,"text-end","fw-bold","fs-5"],[1,"text-end","fw-bold","fs-5","text-success"],["class","card border-0 bg-light",4,"ngIf"],[1,"bi","bi-envelope","me-1"],[1,"bi","bi-telephone","me-1"],[1,"badge","bg-secondary"],[1,"text-end","text-info"],[1,"bi","bi-chat-text","me-2","text-primary"],[1,"p-3","bg-info","bg-opacity-10","rounded"],[1,"text-center","mb-2"],["class","row",4,"ngFor","ngForOf"],[1,"my-2"],[1,"col-6","text-end"],[3,"formGroupName"],["formControlName","productoId",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","cantidad","min","0","step","1",1,"form-control",3,"input"],["type","number","formControlName","precioUnitario","min","0","step","0.01",1,"form-control",3,"input"],[1,"fw-bold","text-info"],[1,"fw-bold","text-success"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[3,"value"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h3",4),t.EFF(6,"Gesti\xf3n de Facturas"),t.k0s(),t.j41(7,"span",5),t.EFF(8,"Administra las facturas de venta a clientes"),t.k0s()(),t.j41(9,"button",6),t.bIt("click",function(){return a.abrirModalFactura()}),t.nrm(10,"i",7),t.EFF(11," Nueva Factura "),t.k0s()()()(),t.j41(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"h2",12),t.EFF(17),t.k0s(),t.j41(18,"p",13),t.EFF(19,"Total Facturas"),t.k0s()()()(),t.j41(20,"div",9)(21,"div",10)(22,"div",11)(23,"h2",14),t.EFF(24),t.k0s(),t.j41(25,"p",13),t.EFF(26,"Pagadas"),t.k0s()()()(),t.j41(27,"div",9)(28,"div",10)(29,"div",11)(30,"h2",15),t.EFF(31),t.k0s(),t.j41(32,"p",13),t.EFF(33,"Pendientes"),t.k0s()()()(),t.j41(34,"div",9)(35,"div",10)(36,"div",11)(37,"h2",16),t.EFF(38),t.nI1(39,"currency"),t.k0s(),t.j41(40,"p",13),t.EFF(41,"Valor Total"),t.k0s()()()()(),t.j41(42,"div",8)(43,"div",2)(44,"div",17)(45,"div",18)(46,"div",19)(47,"div",20)(48,"div",21)(49,"span",22),t.nrm(50,"i",23),t.k0s(),t.j41(51,"input",24),t.bIt("ngModelChange",function(s){return a.filtros.busqueda=s})("input",function(){return a.aplicarFiltros()}),t.k0s()()(),t.j41(52,"div",25)(53,"select",26),t.bIt("ngModelChange",function(s){return a.filtros.estado=s})("change",function(){return a.aplicarFiltros()}),t.j41(54,"option",27),t.EFF(55,"Todos los estados"),t.k0s(),t.j41(56,"option",28),t.EFF(57,"Borrador"),t.k0s(),t.j41(58,"option",29),t.EFF(59,"Enviada"),t.k0s(),t.j41(60,"option",30),t.EFF(61,"Pagada"),t.k0s(),t.j41(62,"option",31),t.EFF(63,"Vencida"),t.k0s(),t.j41(64,"option",32),t.EFF(65,"Cancelada"),t.k0s()()()(),t.DNE(66,M,7,2,"div",33),t.k0s()()()(),t.j41(67,"div",1),t.DNE(68,$,60,41,"div",34),t.DNE(69,w,10,0,"div",35),t.DNE(70,N,10,0,"div",35),t.k0s()(),t.j41(71,"div",36)(72,"div",37)(73,"div",38)(74,"div",39)(75,"div",40)(76,"div",41),t.nrm(77,"i",42),t.k0s(),t.j41(78,"div",43)(79,"h4",4),t.EFF(80),t.k0s(),t.j41(81,"p",44),t.EFF(82),t.k0s()(),t.j41(83,"div",45)(84,"span",46),t.EFF(85),t.k0s()()(),t.nrm(86,"button",47),t.k0s(),t.DNE(87,B,94,35,"div",48),t.j41(88,"div",49)(89,"button",50),t.nrm(90,"i",51),t.EFF(91,"Cerrar "),t.k0s(),t.j41(92,"button",52),t.bIt("click",function(){return a.imprimirDesdeDetalle()}),t.nrm(93,"i",53),t.EFF(94,"Imprimir "),t.k0s(),t.j41(95,"button",54),t.bIt("click",function(){return a.editarDesdeDetalle()}),t.nrm(96,"i",55),t.EFF(97,"Editar "),t.k0s(),t.j41(98,"button",56),t.bIt("click",function(){return a.eliminarDesdeDetalle()}),t.nrm(99,"i",57),t.EFF(100,"Eliminar "),t.k0s()()()()(),t.j41(101,"div",58)(102,"div",59)(103,"div",38)(104,"div",60)(105,"h5",61),t.EFF(106),t.k0s(),t.j41(107,"button",62),t.bIt("click",function(){return a.cerrarModal()}),t.k0s()(),t.j41(108,"div",63)(109,"form",64),t.bIt("ngSubmit",function(){return a.guardarFactura()}),t.j41(110,"div",1)(111,"div",65)(112,"div",66)(113,"div",67)(114,"h6",68),t.nrm(115,"i",69),t.EFF(116," Informaci\xf3n de la Factura "),t.k0s()(),t.j41(117,"div",18)(118,"div",1)(119,"div",70)(120,"div",71)(121,"label",72),t.EFF(122,"N\xfamero de Factura *"),t.k0s(),t.nrm(123,"input",73),t.k0s()(),t.j41(124,"div",70)(125,"div",71)(126,"label",72),t.EFF(127,"Estado"),t.k0s(),t.j41(128,"select",74)(129,"option",28),t.EFF(130,"Borrador"),t.k0s(),t.j41(131,"option",29),t.EFF(132,"Enviada"),t.k0s(),t.j41(133,"option",30),t.EFF(134,"Pagada"),t.k0s(),t.j41(135,"option",31),t.EFF(136,"Vencida"),t.k0s(),t.j41(137,"option",32),t.EFF(138,"Cancelada"),t.k0s()()()()(),t.j41(139,"div",71)(140,"label",72),t.EFF(141,"Cliente *"),t.k0s(),t.j41(142,"div",21),t.nrm(143,"input",75),t.j41(144,"button",76),t.bIt("click",function(){return a.seleccionarClienteExistente()}),t.nrm(145,"i",77),t.k0s()()(),t.j41(146,"div",1)(147,"div",70)(148,"div",71)(149,"label",72),t.EFF(150,"Email del Cliente"),t.k0s(),t.nrm(151,"input",78),t.k0s()(),t.j41(152,"div",70)(153,"div",71)(154,"label",72),t.EFF(155,"Tel\xe9fono"),t.k0s(),t.nrm(156,"input",79),t.k0s()()(),t.j41(157,"div",1)(158,"div",70)(159,"div",71)(160,"label",72),t.EFF(161,"Fecha de Emisi\xf3n *"),t.k0s(),t.nrm(162,"input",80),t.k0s()(),t.j41(163,"div",70)(164,"div",71)(165,"label",72),t.EFF(166,"Fecha de Vencimiento *"),t.k0s(),t.nrm(167,"input",81),t.k0s()()(),t.j41(168,"div",71)(169,"label",72),t.EFF(170,"M\xe9todo de Pago"),t.k0s(),t.j41(171,"select",82)(172,"option",83),t.EFF(173,"Efectivo"),t.k0s(),t.j41(174,"option",84),t.EFF(175,"Tarjeta"),t.k0s(),t.j41(176,"option",85),t.EFF(177,"Transferencia"),t.k0s(),t.j41(178,"option",86),t.EFF(179,"Bizum"),t.k0s(),t.j41(180,"option",87),t.EFF(181,"Cheque"),t.k0s()()()()()(),t.j41(182,"div",65)(183,"div",66)(184,"div",67)(185,"h6",68),t.nrm(186,"i",88),t.EFF(187," Resumen de la Factura "),t.k0s()(),t.j41(188,"div",18)(189,"div",89)(190,"div",2)(191,"div",90)(192,"h4",4),t.EFF(193),t.nI1(194,"currency"),t.k0s(),t.j41(195,"small",5),t.EFF(196,"Subtotal"),t.k0s()()()(),t.DNE(197,Y,14,7,"div",91),t.j41(198,"div",92)(199,"h3",93),t.EFF(200),t.nI1(201,"currency"),t.k0s(),t.j41(202,"small",5),t.EFF(203,"Total"),t.k0s()(),t.j41(204,"div",71)(205,"label",72),t.EFF(206,"Observaciones"),t.k0s(),t.nrm(207,"textarea",94),t.k0s()()()()(),t.j41(208,"div",95)(209,"div",96)(210,"h6",68),t.EFF(211,"Productos de la Factura"),t.k0s(),t.j41(212,"button",97),t.bIt("click",function(){return a.agregarProducto()}),t.nrm(213,"i",7),t.EFF(214," Agregar Producto "),t.k0s()(),t.j41(215,"div",18)(216,"div",98)(217,"table",99)(218,"thead")(219,"tr")(220,"th"),t.EFF(221,"Producto"),t.k0s(),t.j41(222,"th"),t.EFF(223,"Cantidad"),t.k0s(),t.j41(224,"th"),t.EFF(225,"Precio Unit."),t.k0s(),t.j41(226,"th"),t.EFF(227,"Subtotal"),t.k0s(),t.j41(228,"th"),t.EFF(229,"IVA"),t.k0s(),t.j41(230,"th"),t.EFF(231,"Total"),t.k0s(),t.nrm(232,"th",100),t.k0s()(),t.j41(233,"tbody",101),t.DNE(234,z,25,20,"tr",102),t.k0s()()()()()()(),t.j41(235,"div",103)(236,"button",104),t.bIt("click",function(){return a.cerrarModal()}),t.EFF(237," Cancelar "),t.k0s(),t.j41(238,"button",56),t.bIt("click",function(){return a.guardarFactura()}),t.EFF(239),t.k0s()()()()()),2&o&&(t.R7$(17),t.SpI(" ",a.estadisticas.totalFacturas," "),t.R7$(7),t.SpI(" ",a.estadisticas.pagadas," "),t.R7$(7),t.SpI(" ",a.estadisticas.pendientes," "),t.R7$(7),t.SpI(" ",t.ii3(39,25,a.estadisticas.valorTotal,"EUR","symbol","1.2-2")," "),t.R7$(13),t.Y8G("ngModel",a.filtros.busqueda),t.R7$(2),t.Y8G("ngModel",a.filtros.estado),t.R7$(13),t.Y8G("ngIf",a.filtros.busqueda||a.filtros.estado),t.R7$(2),t.Y8G("ngForOf",a.facturasFiltradas),t.R7$(1),t.Y8G("ngIf",0===a.facturasFiltradas.length&&a.facturas.length>0),t.R7$(1),t.Y8G("ngIf",0===a.facturas.length),t.R7$(10),t.SpI("Factura ",null==a.facturaSeleccionada?null:a.facturaSeleccionada.numero,""),t.R7$(2),t.SpI(" ",null==a.facturaSeleccionada?null:a.facturaSeleccionada.clienteNombre," "),t.R7$(2),t.Y8G("ngClass",a.getEstadoBadgeClass((null==a.facturaSeleccionada?null:a.facturaSeleccionada.estado)||"")),t.R7$(1),t.SpI(" ",null==a.facturaSeleccionada?null:a.facturaSeleccionada.estado," "),t.R7$(2),t.Y8G("ngIf",a.facturaSeleccionada),t.R7$(8),t.Y8G("disabled","Pagada"===(null==a.facturaSeleccionada?null:a.facturaSeleccionada.estado)),t.R7$(3),t.Y8G("disabled","Pagada"===(null==a.facturaSeleccionada?null:a.facturaSeleccionada.estado)),t.R7$(8),t.SpI(" ",a.modoEdicion?"Editar":"Nueva"," Factura "),t.R7$(3),t.Y8G("formGroup",a.facturaForm),t.R7$(84),t.SpI(" ",t.ii3(194,30,a.subtotalFactura,"EUR","symbol","1.2-2")," "),t.R7$(4),t.Y8G("ngIf",a.ivaBreakdown.length>0),t.R7$(3),t.SpI(" ",t.ii3(201,35,a.totalFactura,"EUR","symbol","1.2-2")," "),t.R7$(34),t.Y8G("ngForOf",a.productosFormArray.controls),t.R7$(4),t.Y8G("disabled",!a.facturaForm.valid),t.R7$(1),t.SpI(" ",a.modoEdicion?"Actualizar":"Crear"," Factura "))},dependencies:[g.YU,g.Sq,g.bT,r.qT,r.xH,r.y7,r.me,r.Q0,r.wz,r.BC,r.cb,r.VZ,r.j4,r.JD,r.$R,r.v8,r.vS,g.oe,g.vh],styles:[".container-fluid[_ngcontent-%COMP%]{padding:20px}.container-fluid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.container-fluid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026!important}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]{max-height:120px;overflow-y:auto}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:2px}.container-fluid[_ngcontent-%COMP%]   .product-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:2px}.container-fluid[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}.container-fluid[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{border-radius:8px}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{margin-bottom:0}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bs-light);border-bottom:2px solid var(--bs-border-color);font-weight:600;font-size:.875rem;padding:12px 8px}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px;vertical-align:middle}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem}.container-fluid[_ngcontent-%COMP%]   .modal-xl[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}.container-fluid[_ngcontent-%COMP%]   .bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important}.container-fluid[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.container-fluid[_ngcontent-%COMP%]   .text-success[_ngcontent-%COMP%]{color:#198754!important}.container-fluid[_ngcontent-%COMP%]   .text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.container-fluid[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#0dcaf0!important}.container-fluid[_ngcontent-%COMP%]   .border-top[_ngcontent-%COMP%]{border-top:1px solid var(--bs-border-color)!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-secondary[_ngcontent-%COMP%]{background-color:#6c757d!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-info[_ngcontent-%COMP%]{background-color:#0dcaf0!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-success[_ngcontent-%COMP%]{background-color:#198754!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-danger[_ngcontent-%COMP%]{background-color:#dc3545!important}.container-fluid[_ngcontent-%COMP%]   .badge.bg-dark[_ngcontent-%COMP%]{background-color:#212529!important}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{transition:all .2s ease}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.container-fluid[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.container-fluid[_ngcontent-%COMP%]   .bg-info.bg-opacity-10[_ngcontent-%COMP%]{background-color:#0dcaf01a!important}.container-fluid[_ngcontent-%COMP%]   .bg-warning.bg-opacity-10[_ngcontent-%COMP%]{background-color:#ffc1071a!important}.container-fluid[_ngcontent-%COMP%]   .bg-danger.bg-opacity-10[_ngcontent-%COMP%]{background-color:#dc35451a!important}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:10px}.container-fluid[_ngcontent-%COMP%]   .col-12.col-lg-6[_ngcontent-%COMP%]{margin-bottom:1rem}.container-fluid[_ngcontent-%COMP%]   .d-flex.gap-2[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem!important}.container-fluid[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.2rem .4rem;font-size:.8rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{font-size:.8rem}.container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 4px}.container-fluid[_ngcontent-%COMP%]   .modal-xl[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{margin:.5rem;max-width:calc(100% - 1rem)}}@media (max-width: 576px){.container-fluid[_ngcontent-%COMP%]   .row.g-3[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:1rem}.container-fluid[_ngcontent-%COMP%]   .col-12.col-md-8[_ngcontent-%COMP%], .container-fluid[_ngcontent-%COMP%]   .col-12.col-md-4[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%}.container-fluid[_ngcontent-%COMP%]   .d-flex.justify-content-between[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.container-fluid[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}}.text-danger.fw-bold[_ngcontent-%COMP%]{font-weight:700!important}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:var(--bs-primary);box-shadow:0 0 0 .2rem #0d6efd40}.btn-group-sm[_ngcontent-%COMP%] > .btn[_ngcontent-%COMP%], .btn-sm[_ngcontent-%COMP%]{--bs-btn-padding-y: .25rem;--bs-btn-padding-x: .5rem;--bs-btn-font-size: .875rem;--bs-btn-border-radius: .375rem}"]})}}return n})()}];let L=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[k.iI.forChild(J),k.iI]})}}return n})(),q=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[L,j.PrivateModule,g.MD,r.X1,r.YN]})}}return n})()}}]);