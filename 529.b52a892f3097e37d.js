"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[529],{8529:(V,f,a)=>{a.r(f),a.d(f,{ProductosPageModule:()=>D});var m=a(177),s=a(9417),g=a(9012),b=a(467),d=a(2418),v=a(8032),u=a.n(v),k=a(8359),C=a(4572),p=a(9172),E=a(152),o=a(7705);function j(i,l){if(1&i&&(o.j41(0,"option",58),o.EFF(1),o.k0s()),2&i){const t=l.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function P(i,l){if(1&i&&(o.j41(0,"option",58),o.EFF(1),o.k0s()),2&i){const t=l.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function R(i,l){1&i&&(o.j41(0,"div",59)(1,"p",45),o.EFF(2,"No se encontraron productos con los filtros seleccionados."),o.k0s()())}function y(i,l){if(1&i){const t=o.RV6();o.j41(0,"div",60)(1,"div",61)(2,"div",62)(3,"div",63)(4,"div",64)(5,"h6",65),o.EFF(6),o.k0s(),o.j41(7,"p",66),o.EFF(8),o.k0s(),o.j41(9,"span",67),o.EFF(10),o.k0s()(),o.j41(11,"div",68)(12,"button",69),o.bIt("click",function(){const n=o.eBV(t).$implicit,c=o.XpG();return o.Njj(c.editarProducto(n))}),o.nrm(13,"i",70),o.k0s(),o.j41(14,"button",71),o.bIt("click",function(){const n=o.eBV(t).$implicit,c=o.XpG();return o.Njj(c.eliminarProducto(n.id))}),o.nrm(15,"i",72),o.k0s()()(),o.j41(16,"div",73)(17,"div",74)(18,"div",75),o.EFF(19,"Costo"),o.k0s(),o.j41(20,"div",76),o.EFF(21),o.nI1(22,"currency"),o.k0s()(),o.j41(23,"div",74)(24,"div",75),o.EFF(25,"Stock Actual"),o.k0s(),o.j41(26,"div",77),o.EFF(27),o.k0s()()()()()()}if(2&i){const t=l.$implicit,e=o.XpG();o.R7$(6),o.JRh(t.nombre),o.R7$(2),o.JRh(t.descripcion),o.R7$(1),o.Y8G("ngClass",e.getCategoryBadgeClass(t.categoriaId)),o.R7$(1),o.SpI(" ",e.getCategoryName(t.categoriaId)," "),o.R7$(11),o.SpI(" ",o.bMT(22,6,t.costo)," "),o.R7$(6),o.SpI(" ",t.stock," ")}}function $(i,l){if(1&i&&(o.j41(0,"option",58),o.EFF(1),o.k0s()),2&i){const t=l.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function I(i,l){if(1&i&&(o.j41(0,"option",58),o.EFF(1),o.k0s()),2&i){const t=l.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function N(i,l){1&i&&(o.j41(0,"div",52)(1,"label",32),o.EFF(2,"Stock Actual"),o.k0s(),o.nrm(3,"input",78),o.k0s())}function M(i,l){1&i&&(o.j41(0,"div",52)(1,"label",32),o.EFF(2,"Stock M\xednimo"),o.k0s(),o.nrm(3,"input",79),o.k0s())}function G(i,l){if(1&i&&(o.j41(0,"option",58),o.EFF(1),o.k0s()),2&i){const t=l.$implicit;o.Y8G("value",t),o.R7$(1),o.JRh(t)}}const x=[{path:"",component:(()=>{class i{constructor(t,e){this.fb=t,this.firestore=e,this.productos=[],this.filteredProducts=[],this.categorias=[],this.proveedores=[],this.unidadesDisponibles=[],this.totalProveedores=0,this.totalStockValue=0,this.productosBajosEnStock=0,this.subscriptions=new k.yU,this.productSearch=new s.MJ(""),this.categoryFilter=new s.MJ("all"),this.supplierFilter=new s.MJ("all"),this.productoForm=this.fb.group({id:[null],nombre:["",s.k0.required],descripcion:["",s.k0.required],costo:[0,[s.k0.required,s.k0.min(0)]],IVA:[0,[s.k0.required,s.k0.min(0)]],categoriaId:["",s.k0.required],proveedorId:[null],esCombinado:[!1],stock:[0,s.k0.min(0)],stockMinimo:[0,s.k0.min(0)],cantidad:[0,[s.k0.required,s.k0.min(0)]],unidadMedida:["",s.k0.required]})}ngOnInit(){this.cargarProductos(),this.cargarCategorias(),this.cargarProveedores();const t=document.getElementById("productModal");t&&(this.modal=new bootstrap.Modal(t)),this.subscriptions.add(this.productoForm.get("categoriaId")?.valueChanges.subscribe(e=>{this.onCategoriaChange(e)})),this.subscriptions.add(this.productoForm.get("esCombinado")?.valueChanges.subscribe(e=>{this.onEsCombinadoChange(e)})),this.subscriptions.add((0,C.z)([this.productSearch.valueChanges.pipe((0,p.Z)("")),this.categoryFilter.valueChanges.pipe((0,p.Z)("all")),this.supplierFilter.valueChanges.pipe((0,p.Z)("all"))]).pipe((0,E.B)(300)).subscribe(([e,r,n])=>{this.filterProducts(e||"",r||"all",n||"all")}))}ngOnDestroy(){this.subscriptions.unsubscribe()}cargarProductos(){const t=(0,d.rJ)(this.firestore,"productos");this.subscriptions.add((0,d.xs)(t,{idField:"id"}).subscribe(e=>{this.productos=e,this.filteredProducts=e,this.totalStockValue=e.reduce((r,n)=>r+(n.stock||0)*n.costo,0),this.productosBajosEnStock=e.filter(r=>!r.esCombinado&&(r.stock||0)<=(r.stockMinimo||0)).length}))}cargarCategorias(){const t=(0,d.rJ)(this.firestore,"categorias");this.subscriptions.add((0,d.xs)(t,{idField:"id"}).subscribe(e=>{this.categorias=e}))}cargarProveedores(){const t=(0,d.rJ)(this.firestore,"proveedores");this.subscriptions.add((0,d.xs)(t,{idField:"id"}).subscribe(e=>{this.proveedores=e,this.totalProveedores=e.length}))}filterProducts(t,e,r){let n=[...this.productos];t&&(n=n.filter(c=>c.nombre.toLowerCase().includes(t.toLowerCase()))),e&&"all"!==e&&(n=n.filter(c=>c.categoriaId===e)),r&&"all"!==r&&(n=n.filter(c=>c.proveedorId===r)),this.filteredProducts=n}onCategoriaChange(t){const e=this.categorias.find(r=>r.id===t);this.unidadesDisponibles=e?.unidadesDisponibles||[],this.unidadesDisponibles.length>0?this.productoForm.get("unidadMedida")?.setValue(this.unidadesDisponibles[0]):this.productoForm.get("unidadMedida")?.setValue("")}onEsCombinadoChange(t){const e=this.productoForm.get("stock"),r=this.productoForm.get("stockMinimo");t?(e?.setValue(null),e?.disable(),r?.setValue(null),r?.disable()):(e?.enable(),r?.enable())}guardarProducto(){var t=this;return(0,b.A)(function*(){if(t.productoForm.invalid)return void u().fire("Error","Por favor, complete todos los campos requeridos.","error");const e=t.productoForm.getRawValue();u().showLoading();try{if(e.id){const r=(0,d.H9)(t.firestore,"productos",e.id);yield(0,d.mZ)(r,e),u().fire("\xa1Actualizado!","El producto ha sido actualizado.","success")}else e.fechaCreacion=(0,d.O5)(),delete e.id,yield(0,d.gS)((0,d.rJ)(t.firestore,"productos"),e),u().fire("\xa1Creado!","El nuevo producto ha sido guardado.","success");t.modal.hide(),t.resetForm()}catch(r){console.error("Error al guardar el producto:",r),u().fire("Error","Hubo un problema al guardar el producto.","error")}})()}editarProducto(t){this.productoForm.patchValue(t),this.modal.show()}eliminarProducto(t){var e=this;return(0,b.A)(function*(){if((yield u().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield(0,d.kd)((0,d.H9)(e.firestore,"productos",t)),u().fire("\xa1Eliminado!","El producto ha sido eliminado.","success")}catch(n){console.error("Error al eliminar el producto:",n),u().fire("Error","No se pudo eliminar el producto.","error")}})()}abrirModalNuevo(){this.resetForm(),this.modal.show()}resetForm(){this.productoForm.reset({nombre:"",descripcion:"",costo:0,precioVenta:0,categoriaId:"",proveedorId:null,esCombinado:!1,stock:0,stockMinimo:0,cantidad:0,unidadMedida:""})}getCategoryName(t){const e=this.categorias.find(r=>r.id===t);return e?e.nombre:""}getCategoryBadgeClass(t){const e=this.categorias.find(c=>c.id===t);if(!e)return"bg-secondary";const r=["bg-primary","bg-success","bg-info","bg-warning","bg-danger"];return r[e.nombre.length%r.length]}getPrecioVenta(t){return t.costo*(1+(t.IVA||0)/100)}getStockClass(t){if(t.esCombinado)return"text-muted";const e=t.stock||0;return e<=0?"text-danger":e<=(t.stockMinimo||0)?"text-warning":"text-success"}getUnidadDisplay(t){return t.cantidad&&t.unidadMedida?`${t.unidadMedida}`:"unidades"}getMargenPorcentaje(t){const e=this.getPrecioVenta(t),r=t.costo;return 0===r?"0.0":((e-r)/r*100).toFixed(1)}static{this.\u0275fac=function(e){return new(e||i)(o.rXU(s.ok),o.rXU(d._7))}}static{this.\u0275cmp=o.VBU({type:i,selectors:[["app-productos-page"]],decls:126,vars:19,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-3"],[1,"col"],[1,"card"],[1,"card-body"],[1,"row","d-flex","align-items-center"],[1,"col-12","col-sm-4","mt-2"],["type","text","placeholder","Buscar productos...",1,"form-control",3,"formControl"],[1,"col-12","col-sm-3","mt-2"],[1,"form-select",3,"formControl"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-sm-2","mt-2"],[1,"bi","bi-box","text-primary"],[1,"bi","bi-exclamation-circle","text-danger"],[1,"row","mt-4"],["class","col-12 text-center",4,"ngIf"],["class","col-12 col-sm-3 mb-4",4,"ngFor","ngForOf"],["id","productModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","nombre","placeholder","Ej: Coca-Cola",1,"form-control"],["formControlName","descripcion","placeholder","Descripci\xf3n del producto",1,"form-control"],[1,"col-md-6","mb-3"],["type","number","formControlName","costo","placeholder","0.00",1,"form-control"],["formControlName","IVA",1,"form-control"],["selected","","disabled",""],["value","4"],["value","10"],["value","21"],["formControlName","categoriaId",1,"form-select"],["value","","disabled",""],[1,"text-muted"],["formControlName","proveedorId",1,"form-select"],[3,"ngValue"],[1,"form-check","mb-3"],["type","checkbox","formControlName","esCombinado","id","esCombinadoCheck",1,"form-check-input"],["for","esCombinadoCheck",1,"form-check-label"],["class","col-md-4 mb-3",4,"ngIf"],[1,"col-md-4","mb-3"],["type","number","formControlName","cantidad","placeholder","0",1,"form-control"],["formControlName","unidadMedida",1,"form-select"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-danger",3,"disabled"],[3,"value"],[1,"col-12","text-center"],[1,"col-12","col-sm-3","mb-4"],[1,"card","shadow-sm","border-0","h-100"],[1,"card-body","p-3"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"flex-grow-1"],[1,"mb-1","fw-bold","text-dark"],[1,"text-muted","small","mb-2"],[1,"badge","rounded-pill",2,"font-size","0.75rem",3,"ngClass"],[1,"d-flex","gap-1"],[1,"btn","btn-outline-primary","btn-sm",2,"width","32px","height","32px","padding","0",3,"click"],[1,"bi","bi-pencil-fill",2,"font-size","0.75rem"],[1,"btn","btn-outline-danger","btn-sm",2,"width","32px","height","32px","padding","0",3,"click"],[1,"bi","bi-trash3-fill",2,"font-size","0.75rem"],[1,"row","mb-3"],[1,"col-6"],[1,"text-muted","small"],[1,"fw-bold","text-danger",2,"font-size","1.1rem"],[1,"fw-bold"],["type","number","formControlName","stock","placeholder","0",1,"form-control"],["type","number","formControlName","stockMinimo","placeholder","0",1,"form-control"]],template:function(e,r){if(1&e&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),o.EFF(4,"Gesti\xf3n de Productos"),o.k0s(),o.j41(5,"span"),o.EFF(6,"Crea, edita y organiza todos tus productos."),o.k0s()(),o.j41(7,"div",3)(8,"button",4),o.bIt("click",function(){return r.abrirModalNuevo()}),o.nrm(9,"i",5),o.EFF(10," Nuevo Producto "),o.k0s()()(),o.j41(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11),o.nrm(17,"input",12),o.k0s(),o.j41(18,"div",13)(19,"select",14)(20,"option",15),o.EFF(21,"Todas las categor\xedas"),o.k0s(),o.DNE(22,j,2,2,"option",16),o.k0s()(),o.j41(23,"div",13)(24,"select",14)(25,"option",15),o.EFF(26,"Todos los proveedores"),o.k0s(),o.DNE(27,P,2,2,"option",16),o.k0s()(),o.j41(28,"div",17)(29,"span"),o.nrm(30,"i",18),o.EFF(31),o.k0s(),o.EFF(32,"\xa0\xa0 "),o.j41(33,"span"),o.nrm(34,"i",19),o.EFF(35),o.k0s()()()()()()(),o.j41(36,"div",20),o.DNE(37,R,3,0,"div",21),o.DNE(38,y,28,8,"div",22),o.k0s()(),o.j41(39,"div",23)(40,"div",24)(41,"div",25)(42,"form",26),o.bIt("ngSubmit",function(){return r.guardarProducto()}),o.j41(43,"div",27)(44,"h5",28),o.EFF(45),o.k0s(),o.nrm(46,"button",29),o.k0s(),o.j41(47,"div",30)(48,"div",31)(49,"label",32),o.EFF(50,"Nombre del Producto "),o.j41(51,"span",33),o.EFF(52,"*"),o.k0s()(),o.nrm(53,"input",34),o.k0s(),o.j41(54,"div",31)(55,"label",32),o.EFF(56,"Descripci\xf3n "),o.j41(57,"span",33),o.EFF(58,"*"),o.k0s()(),o.nrm(59,"textarea",35),o.k0s(),o.j41(60,"div",1)(61,"div",36)(62,"label",32),o.EFF(63,"Costo "),o.j41(64,"span",33),o.EFF(65,"*"),o.k0s()(),o.nrm(66,"input",37),o.k0s(),o.j41(67,"div",36)(68,"label",32),o.EFF(69,"IVA(%) "),o.j41(70,"span",33),o.EFF(71,"*"),o.k0s()(),o.j41(72,"select",38)(73,"option",39),o.EFF(74,"Selecciona un IVA"),o.k0s(),o.j41(75,"option",40),o.EFF(76,"4%"),o.k0s(),o.j41(77,"option",41),o.EFF(78,"10%"),o.k0s(),o.j41(79,"option",42),o.EFF(80,"21%"),o.k0s()()()(),o.j41(81,"div",31)(82,"label",32),o.EFF(83,"Categor\xeda "),o.j41(84,"span",33),o.EFF(85,"*"),o.k0s()(),o.j41(86,"select",43)(87,"option",44),o.EFF(88,"Selecciona una categor\xeda"),o.k0s(),o.DNE(89,$,2,2,"option",16),o.k0s()(),o.j41(90,"div",31)(91,"label",32),o.EFF(92,"Proveedor "),o.j41(93,"small",45),o.EFF(94,"(Opcional)"),o.k0s()(),o.j41(95,"select",46)(96,"option",47),o.EFF(97,"Ninguno"),o.k0s(),o.DNE(98,I,2,2,"option",16),o.k0s()(),o.j41(99,"div",48),o.nrm(100,"input",49),o.j41(101,"label",50),o.EFF(102," Es Receta/Combinado (sin control de stock) "),o.k0s()(),o.j41(103,"div",1),o.DNE(104,N,4,0,"div",51),o.DNE(105,M,4,0,"div",51),o.j41(106,"div",52)(107,"label",32),o.EFF(108,"Cantidad "),o.j41(109,"span",33),o.EFF(110,"*"),o.k0s()(),o.nrm(111,"input",53),o.k0s(),o.j41(112,"div",52)(113,"label",32),o.EFF(114,"Unidad de Medida "),o.j41(115,"span",33),o.EFF(116,"*"),o.k0s()(),o.j41(117,"select",54)(118,"option",44),o.EFF(119,"Selecciona una unidad"),o.k0s(),o.DNE(120,G,2,2,"option",16),o.k0s()()()(),o.j41(121,"div",55)(122,"button",56),o.EFF(123,"Cancelar"),o.k0s(),o.j41(124,"button",57),o.EFF(125),o.k0s()()()()()()),2&e){let n,c,h,F;o.R7$(17),o.Y8G("formControl",r.productSearch),o.R7$(2),o.Y8G("formControl",r.categoryFilter),o.R7$(3),o.Y8G("ngForOf",r.categorias),o.R7$(2),o.Y8G("formControl",r.supplierFilter),o.R7$(3),o.Y8G("ngForOf",r.proveedores),o.R7$(4),o.SpI("\xa0",r.filteredProducts.length,"\xa0Productos"),o.R7$(4),o.SpI("\xa0",r.productosBajosEnStock,"\xa0Stock"),o.R7$(2),o.Y8G("ngIf",0===r.filteredProducts.length),o.R7$(1),o.Y8G("ngForOf",r.filteredProducts),o.R7$(4),o.Y8G("formGroup",r.productoForm),o.R7$(3),o.JRh(null!=(n=r.productoForm.get("id"))&&n.value?"Editar Producto":"Nuevo Producto"),o.R7$(44),o.Y8G("ngForOf",r.categorias),o.R7$(7),o.Y8G("ngValue",null),o.R7$(2),o.Y8G("ngForOf",r.proveedores),o.R7$(6),o.Y8G("ngIf",!(null!=(c=r.productoForm.get("esCombinado"))&&c.value)),o.R7$(1),o.Y8G("ngIf",!(null!=(h=r.productoForm.get("esCombinado"))&&h.value)),o.R7$(15),o.Y8G("ngForOf",r.unidadesDisponibles),o.R7$(4),o.Y8G("disabled",r.productoForm.invalid),o.R7$(1),o.JRh(null!=(F=r.productoForm.get("id"))&&F.value?"Actualizar":"Crear")}},dependencies:[m.YU,m.Sq,m.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.l_,s.j4,s.JD,m.oe]})}}return i})()}];let S=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[g.iI.forChild(x),g.iI]})}}return i})(),D=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[m.MD,s.YN,s.X1,S]})}}return i})()}}]);