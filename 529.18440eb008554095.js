"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[529],{8529:(B,b,a)=>{a.r(b),a.d(b,{ProductosPageModule:()=>T});var m=a(177),s=a(9417),h=a(9012),F=a(467),c=a(2418),C=a(8032),u=a.n(C),P=a(8359),j=a(4572),f=a(7673),g=a(9172),v=a(152),R=a(5558),o=a(7705);function y(i,d){if(1&i&&(o.j41(0,"option",59),o.EFF(1),o.k0s()),2&i){const t=d.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function $(i,d){if(1&i&&(o.j41(0,"option",59),o.EFF(1),o.k0s()),2&i){const t=d.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function N(i,d){1&i&&(o.j41(0,"div",60)(1,"p",46),o.EFF(2,"No se encontraron productos con los filtros seleccionados."),o.k0s()())}function I(i,d){if(1&i){const t=o.RV6();o.j41(0,"div",61)(1,"div",62)(2,"div",63)(3,"div",64)(4,"div",65)(5,"h6",66),o.EFF(6),o.k0s(),o.j41(7,"p",67),o.EFF(8),o.k0s(),o.j41(9,"span",68),o.EFF(10),o.k0s()(),o.j41(11,"div",69)(12,"button",70),o.bIt("click",function(){const n=o.eBV(t).$implicit,l=o.XpG();return o.Njj(l.editarProducto(n))}),o.nrm(13,"i",71),o.k0s(),o.j41(14,"button",72),o.bIt("click",function(){const n=o.eBV(t).$implicit,l=o.XpG();return o.Njj(l.eliminarProducto(n.id))}),o.nrm(15,"i",73),o.k0s()()(),o.j41(16,"div",74)(17,"div",75)(18,"div",76),o.EFF(19,"Costo"),o.k0s(),o.j41(20,"div",77),o.EFF(21),o.nI1(22,"currency"),o.k0s()(),o.j41(23,"div",75)(24,"div",76),o.EFF(25,"Stock Actual"),o.k0s(),o.j41(26,"div",78),o.EFF(27),o.k0s()()()()()()}if(2&i){const t=d.$implicit,e=o.XpG();o.R7$(6),o.JRh(t.nombre),o.R7$(2),o.JRh(t.descripcion),o.R7$(1),o.Y8G("ngClass",e.getCategoryBadgeClass(t.categoriaId)),o.R7$(1),o.SpI(" ",e.getCategoryName(t.categoriaId)," "),o.R7$(11),o.SpI(" ",o.ii3(22,6,t.costo,"EUR","symbol","1.2-2")," "),o.R7$(6),o.SpI(" ",t.stock," ")}}function x(i,d){1&i&&(o.j41(0,"div",79),o.EFF(1," Este nombre de producto ya existe. "),o.k0s())}function G(i,d){if(1&i&&(o.j41(0,"option",59),o.EFF(1),o.k0s()),2&i){const t=d.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function M(i,d){if(1&i&&(o.j41(0,"option",59),o.EFF(1),o.k0s()),2&i){const t=d.$implicit;o.Y8G("value",t.id),o.R7$(1),o.JRh(t.nombre)}}function D(i,d){1&i&&(o.j41(0,"div",53)(1,"label",32),o.EFF(2,"Stock Actual"),o.k0s(),o.nrm(3,"input",80),o.k0s())}function S(i,d){1&i&&(o.j41(0,"div",53)(1,"label",32),o.EFF(2,"Stock M\xednimo"),o.k0s(),o.nrm(3,"input",81),o.k0s())}function V(i,d){if(1&i&&(o.j41(0,"option",59),o.EFF(1),o.k0s()),2&i){const t=d.$implicit;o.Y8G("value",t),o.R7$(1),o.JRh(t)}}const w=[{path:"",component:(()=>{class i{constructor(t,e){this.fb=t,this.firestore=e,this.productos=[],this.filteredProducts=[],this.categorias=[],this.proveedores=[],this.unidadesDisponibles=[],this.totalProveedores=0,this.totalStockValue=0,this.productosBajosEnStock=0,this.subscriptions=new P.yU,this.productSearch=new s.MJ(""),this.categoryFilter=new s.MJ("all"),this.supplierFilter=new s.MJ("all")}ngOnInit(){this.productoForm=this.fb.group({id:[null],nombre:["",{validators:[s.k0.required],asyncValidators:[this.productNameValidator()],updateOn:"blur"}],descripcion:["",s.k0.required],costo:[0,[s.k0.required,s.k0.min(0)]],IVA:[0,[s.k0.required,s.k0.min(0)]],categoriaId:["",s.k0.required],proveedorId:[null],esCombinado:[!1],stock:[0,s.k0.min(0)],stockMinimo:[0,s.k0.min(0)],cantidad:[0,[s.k0.required,s.k0.min(0)]],unidadMedida:["",s.k0.required]}),this.cargarProductos(),this.cargarCategorias(),this.cargarProveedores();const t=document.getElementById("productModal");t&&(this.modal=new bootstrap.Modal(t)),this.subscriptions.add(this.productoForm.get("categoriaId")?.valueChanges.subscribe(e=>{this.onCategoriaChange(e)})),this.subscriptions.add(this.productoForm.get("esCombinado")?.valueChanges.subscribe(e=>{this.onEsCombinadoChange(e)})),this.subscriptions.add((0,j.z)([this.productSearch.valueChanges.pipe((0,g.Z)("")),this.categoryFilter.valueChanges.pipe((0,g.Z)("all")),this.supplierFilter.valueChanges.pipe((0,g.Z)("all"))]).pipe((0,v.B)(300)).subscribe(([e,r,n])=>{this.filterProducts(e||"",r||"all",n||"all")}))}ngOnDestroy(){this.subscriptions.unsubscribe()}productNameValidator(){return t=>(0,f.of)(t.value).pipe((0,v.B)(500),(0,R.n)(e=>{if(!e)return(0,f.of)(null);const r=e.toLowerCase(),n=this.productoForm.get("id")?.value;return this.productos.some(p=>p.nombre.toLowerCase()===r&&p.id!==n)?(0,f.of)({productNameExists:!0}):(0,f.of)(null)}))}cargarProductos(){const t=(0,c.rJ)(this.firestore,"productos");this.subscriptions.add((0,c.xs)(t,{idField:"id"}).subscribe(e=>{this.productos=e,this.filteredProducts=e,this.totalStockValue=e.reduce((r,n)=>r+(n.stock||0)*n.costo,0),this.productosBajosEnStock=e.filter(r=>!r.esCombinado&&(r.stock||0)<=(r.stockMinimo||0)).length}))}cargarCategorias(){const t=(0,c.rJ)(this.firestore,"categorias");this.subscriptions.add((0,c.xs)(t,{idField:"id"}).subscribe(e=>{this.categorias=e}))}cargarProveedores(){const t=(0,c.rJ)(this.firestore,"proveedores");this.subscriptions.add((0,c.xs)(t,{idField:"id"}).subscribe(e=>{this.proveedores=e,this.totalProveedores=e.length}))}filterProducts(t,e,r){let n=[...this.productos];t&&(n=n.filter(l=>l.nombre.toLowerCase().includes(t.toLowerCase()))),e&&"all"!==e&&(n=n.filter(l=>l.categoriaId===e)),r&&"all"!==r&&(n=n.filter(l=>l.proveedorId===r)),this.filteredProducts=n}onCategoriaChange(t){const e=this.categorias.find(r=>r.id===t);this.unidadesDisponibles=e?.unidadesDisponibles||[],this.unidadesDisponibles.length>0?this.productoForm.get("unidadMedida")?.setValue(this.unidadesDisponibles[0]):this.productoForm.get("unidadMedida")?.setValue("")}onEsCombinadoChange(t){const e=this.productoForm.get("stock"),r=this.productoForm.get("stockMinimo");t?(e?.setValue(null),e?.disable(),r?.setValue(null),r?.disable()):(e?.enable(),r?.enable())}guardarProducto(){var t=this;return(0,F.A)(function*(){if(t.productoForm.invalid)return void u().fire("Error","Por favor, complete todos los campos requeridos.","error");const e=t.productoForm.getRawValue();u().showLoading();try{if(e.id){const r=(0,c.H9)(t.firestore,"productos",e.id);yield(0,c.mZ)(r,e),u().fire("\xa1Actualizado!","El producto ha sido actualizado.","success")}else e.fechaCreacion=(0,c.O5)(),delete e.id,yield(0,c.gS)((0,c.rJ)(t.firestore,"productos"),e),u().fire("\xa1Creado!","El nuevo producto ha sido guardado.","success");t.modal.hide(),t.resetForm()}catch(r){console.error("Error al guardar el producto:",r),u().fire("Error","Hubo un problema al guardar el producto.","error")}})()}editarProducto(t){this.productoForm.patchValue(t),this.modal.show()}eliminarProducto(t){var e=this;return(0,F.A)(function*(){if((yield u().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield(0,c.kd)((0,c.H9)(e.firestore,"productos",t)),u().fire("\xa1Eliminado!","El producto ha sido eliminado.","success")}catch(n){console.error("Error al eliminar el producto:",n),u().fire("Error","No se pudo eliminar el producto.","error")}})()}abrirModalNuevo(){this.resetForm(),this.modal.show()}resetForm(){this.productoForm.reset({nombre:"",descripcion:"",costo:0,precioVenta:0,categoriaId:"",proveedorId:null,esCombinado:!1,stock:0,stockMinimo:0,cantidad:0,unidadMedida:""})}getCategoryName(t){const e=this.categorias.find(r=>r.id===t);return e?e.nombre:""}getCategoryBadgeClass(t){const e=this.categorias.find(l=>l.id===t);if(!e)return"bg-secondary";const r=["bg-primary","bg-success","bg-info","bg-warning","bg-danger"];return r[e.nombre.length%r.length]}getPrecioVenta(t){return t.costo*(1+(t.IVA||0)/100)}getStockClass(t){if(t.esCombinado)return"text-muted";const e=t.stock||0;return e<=0?"text-danger":e<=(t.stockMinimo||0)?"text-warning":"text-success"}getUnidadDisplay(t){return t.cantidad&&t.unidadMedida?`${t.unidadMedida}`:"unidades"}getMargenPorcentaje(t){const e=this.getPrecioVenta(t),r=t.costo;return 0===r?"0.0":((e-r)/r*100).toFixed(1)}static{this.\u0275fac=function(e){return new(e||i)(o.rXU(s.ok),o.rXU(c._7))}}static{this.\u0275cmp=o.VBU({type:i,selectors:[["app-productos-page"]],decls:127,vars:20,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-3"],[1,"col"],[1,"card"],[1,"card-body"],[1,"row","d-flex","align-items-center"],[1,"col-12","col-sm-4","mt-2"],["type","text","placeholder","Buscar productos...",1,"form-control",3,"formControl"],[1,"col-12","col-sm-3","mt-2"],[1,"form-select",3,"formControl"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-sm-2","mt-2"],[1,"bi","bi-box","text-primary"],[1,"bi","bi-exclamation-circle","text-danger"],[1,"row","mt-4"],["class","col-12 text-center",4,"ngIf"],["class","col-12 col-sm-3 mb-4",4,"ngFor","ngForOf"],["id","productModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","nombre","placeholder","Ej: Coca-Cola",1,"form-control"],["class","text-danger mt-1",4,"ngIf"],["formControlName","descripcion","placeholder","Descripci\xf3n del producto",1,"form-control"],[1,"col-md-6","mb-3"],["type","number","formControlName","costo","placeholder","0.00",1,"form-control"],["formControlName","IVA",1,"form-control"],["selected","","disabled",""],["value","4"],["value","10"],["value","21"],["formControlName","categoriaId",1,"form-select"],["value","","disabled",""],[1,"text-muted"],["formControlName","proveedorId",1,"form-select"],[3,"ngValue"],[1,"form-check","mb-3"],["type","checkbox","formControlName","esCombinado","id","esCombinadoCheck",1,"form-check-input"],["for","esCombinadoCheck",1,"form-check-label"],["class","col-md-4 mb-3",4,"ngIf"],[1,"col-md-4","mb-3"],["type","number","formControlName","cantidad","placeholder","0",1,"form-control"],["formControlName","unidadMedida",1,"form-select"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-danger",3,"disabled"],[3,"value"],[1,"col-12","text-center"],[1,"col-12","col-sm-3","mb-4"],[1,"card","shadow-sm","border-0","h-100"],[1,"card-body","p-3"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"flex-grow-1"],[1,"mb-1","fw-bold","text-dark"],[1,"text-muted","small","mb-2"],[1,"badge","rounded-pill",2,"font-size","0.75rem",3,"ngClass"],[1,"d-flex","gap-1"],[1,"btn","btn-outline-primary","btn-sm",2,"width","32px","height","32px","padding","0",3,"click"],[1,"bi","bi-pencil-fill",2,"font-size","0.75rem"],[1,"btn","btn-outline-danger","btn-sm",2,"width","32px","height","32px","padding","0",3,"click"],[1,"bi","bi-trash3-fill",2,"font-size","0.75rem"],[1,"row","mb-3"],[1,"col-6"],[1,"text-muted","small"],[1,"fw-bold","text-danger",2,"font-size","1.1rem"],[1,"fw-bold"],[1,"text-danger","mt-1"],["type","number","formControlName","stock","placeholder","0",1,"form-control"],["type","number","formControlName","stockMinimo","placeholder","0",1,"form-control"]],template:function(e,r){if(1&e&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),o.EFF(4,"Gesti\xf3n de Productos"),o.k0s(),o.j41(5,"span"),o.EFF(6,"Crea, edita y organiza todos tus productos."),o.k0s()(),o.j41(7,"div",3)(8,"button",4),o.bIt("click",function(){return r.abrirModalNuevo()}),o.nrm(9,"i",5),o.EFF(10," Nuevo Producto "),o.k0s()()(),o.j41(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11),o.nrm(17,"input",12),o.k0s(),o.j41(18,"div",13)(19,"select",14)(20,"option",15),o.EFF(21,"Todas las categor\xedas"),o.k0s(),o.DNE(22,y,2,2,"option",16),o.k0s()(),o.j41(23,"div",13)(24,"select",14)(25,"option",15),o.EFF(26,"Todos los proveedores"),o.k0s(),o.DNE(27,$,2,2,"option",16),o.k0s()(),o.j41(28,"div",17)(29,"span"),o.nrm(30,"i",18),o.EFF(31),o.k0s(),o.EFF(32,"\xa0\xa0 "),o.j41(33,"span"),o.nrm(34,"i",19),o.EFF(35),o.k0s()()()()()()(),o.j41(36,"div",20),o.DNE(37,N,3,0,"div",21),o.DNE(38,I,28,11,"div",22),o.k0s()(),o.j41(39,"div",23)(40,"div",24)(41,"div",25)(42,"form",26),o.bIt("ngSubmit",function(){return r.guardarProducto()}),o.j41(43,"div",27)(44,"h5",28),o.EFF(45),o.k0s(),o.nrm(46,"button",29),o.k0s(),o.j41(47,"div",30)(48,"div",31)(49,"label",32),o.EFF(50,"Nombre del Producto "),o.j41(51,"span",33),o.EFF(52,"*"),o.k0s()(),o.nrm(53,"input",34),o.DNE(54,x,2,0,"div",35),o.k0s(),o.j41(55,"div",31)(56,"label",32),o.EFF(57,"Descripci\xf3n "),o.j41(58,"span",33),o.EFF(59,"*"),o.k0s()(),o.nrm(60,"textarea",36),o.k0s(),o.j41(61,"div",1)(62,"div",37)(63,"label",32),o.EFF(64,"Costo "),o.j41(65,"span",33),o.EFF(66,"*"),o.k0s()(),o.nrm(67,"input",38),o.k0s(),o.j41(68,"div",37)(69,"label",32),o.EFF(70,"IVA(%) "),o.j41(71,"span",33),o.EFF(72,"*"),o.k0s()(),o.j41(73,"select",39)(74,"option",40),o.EFF(75,"Selecciona un IVA"),o.k0s(),o.j41(76,"option",41),o.EFF(77,"4%"),o.k0s(),o.j41(78,"option",42),o.EFF(79,"10%"),o.k0s(),o.j41(80,"option",43),o.EFF(81,"21%"),o.k0s()()()(),o.j41(82,"div",31)(83,"label",32),o.EFF(84,"Categor\xeda "),o.j41(85,"span",33),o.EFF(86,"*"),o.k0s()(),o.j41(87,"select",44)(88,"option",45),o.EFF(89,"Selecciona una categor\xeda"),o.k0s(),o.DNE(90,G,2,2,"option",16),o.k0s()(),o.j41(91,"div",31)(92,"label",32),o.EFF(93,"Proveedor "),o.j41(94,"small",46),o.EFF(95,"(Opcional)"),o.k0s()(),o.j41(96,"select",47)(97,"option",48),o.EFF(98,"Ninguno"),o.k0s(),o.DNE(99,M,2,2,"option",16),o.k0s()(),o.j41(100,"div",49),o.nrm(101,"input",50),o.j41(102,"label",51),o.EFF(103," Es Receta/Combinado (sin control de stock) "),o.k0s()(),o.j41(104,"div",1),o.DNE(105,D,4,0,"div",52),o.DNE(106,S,4,0,"div",52),o.j41(107,"div",53)(108,"label",32),o.EFF(109,"Cantidad "),o.j41(110,"span",33),o.EFF(111,"*"),o.k0s()(),o.nrm(112,"input",54),o.k0s(),o.j41(113,"div",53)(114,"label",32),o.EFF(115,"Unidad de Medida "),o.j41(116,"span",33),o.EFF(117,"*"),o.k0s()(),o.j41(118,"select",55)(119,"option",45),o.EFF(120,"Selecciona una unidad"),o.k0s(),o.DNE(121,V,2,2,"option",16),o.k0s()()()(),o.j41(122,"div",56)(123,"button",57),o.EFF(124,"Cancelar"),o.k0s(),o.j41(125,"button",58),o.EFF(126),o.k0s()()()()()()),2&e){let n,l,p,k,E;o.R7$(17),o.Y8G("formControl",r.productSearch),o.R7$(2),o.Y8G("formControl",r.categoryFilter),o.R7$(3),o.Y8G("ngForOf",r.categorias),o.R7$(2),o.Y8G("formControl",r.supplierFilter),o.R7$(3),o.Y8G("ngForOf",r.proveedores),o.R7$(4),o.SpI("\xa0",r.filteredProducts.length,"\xa0Productos"),o.R7$(4),o.SpI("\xa0",r.productosBajosEnStock,"\xa0Stock"),o.R7$(2),o.Y8G("ngIf",0===r.filteredProducts.length),o.R7$(1),o.Y8G("ngForOf",r.filteredProducts),o.R7$(4),o.Y8G("formGroup",r.productoForm),o.R7$(3),o.JRh(null!=(n=r.productoForm.get("id"))&&n.value?"Editar Producto":"Nuevo Producto"),o.R7$(9),o.Y8G("ngIf",null==(l=r.productoForm.get("nombre"))?null:l.hasError("productNameExists")),o.R7$(36),o.Y8G("ngForOf",r.categorias),o.R7$(7),o.Y8G("ngValue",null),o.R7$(2),o.Y8G("ngForOf",r.proveedores),o.R7$(6),o.Y8G("ngIf",!(null!=(p=r.productoForm.get("esCombinado"))&&p.value)),o.R7$(1),o.Y8G("ngIf",!(null!=(k=r.productoForm.get("esCombinado"))&&k.value)),o.R7$(15),o.Y8G("ngForOf",r.unidadesDisponibles),o.R7$(4),o.Y8G("disabled",r.productoForm.invalid),o.R7$(1),o.JRh(null!=(E=r.productoForm.get("id"))&&E.value?"Actualizar":"Crear")}},dependencies:[m.YU,m.Sq,m.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.l_,s.j4,s.JD,m.oe]})}}return i})()}];let Y=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[h.iI.forChild(w),h.iI]})}}return i})(),T=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=o.$C({type:i})}static{this.\u0275inj=o.G2t({imports:[m.MD,s.YN,s.X1,Y]})}}return i})()}}]);