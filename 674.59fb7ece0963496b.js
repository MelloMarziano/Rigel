"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[674],{2674:(be,h,l)=>{l.r(h),l.d(h,{MermasPageModule:()=>ge});var I=l(7412),d=l(9417),u=l(177),f=l(5743),F=l(467),g=l(9173),y=l(8032),p=l.n(y),v=l(8359),e=l(7705),_=l(6239);function $(a,n){if(1&a&&(e.j41(0,"option",87),e.EFF(1),e.k0s()),2&a){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(1),e.SpI(" ",t.nombre," ")}}function x(a,n){if(1&a&&(e.j41(0,"div")(1,"small",42),e.nrm(2,"i",88),e.EFF(3),e.k0s()()),2&a){const t=e.XpG();e.R7$(3),e.Lme(" Mostrando ",t.mermasFiltradas.length," de ",t.mermas.length," mermas ")}}function T(a,n){1&a&&e.nrm(0,"i",89)}function S(a,n){1&a&&e.nrm(0,"i",90)}function w(a,n){1&a&&e.nrm(0,"i",89)}function D(a,n){1&a&&e.nrm(0,"i",91)}function G(a,n){1&a&&e.nrm(0,"i",92)}function O(a,n){1&a&&e.nrm(0,"i",91)}function N(a,n){1&a&&e.nrm(0,"i",93)}function Y(a,n){1&a&&e.nrm(0,"i",94)}function U(a,n){1&a&&e.nrm(0,"i",93)}function V(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",95),e.nrm(1,"i",96),e.j41(2,"h5",97),e.EFF(3,"No hay mermas registradas"),e.k0s(),e.j41(4,"p",42),e.EFF(5,"Crea tu primera merma para comenzar"),e.k0s(),e.j41(6,"button",6),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.abrirModalNuevo())}),e.nrm(7,"i",98),e.EFF(8," Nueva Merma "),e.k0s()()}}function A(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",95),e.nrm(1,"i",99),e.j41(2,"h5",97),e.EFF(3,"No se encontraron resultados"),e.k0s(),e.j41(4,"p",42),e.EFF(5,"Intenta ajustar los filtros de b\xfasqueda"),e.k0s(),e.j41(6,"button",100),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.limpiarFiltros())}),e.nrm(7,"i",28),e.EFF(8," Limpiar filtros "),e.k0s()()}}function L(a,n){if(1&a&&(e.j41(0,"div",73)(1,"div",117)(2,"small",42),e.nrm(3,"i",118),e.EFF(4," Porcentaje de Merma "),e.k0s(),e.j41(5,"h4",119),e.EFF(6),e.k0s()(),e.j41(7,"div",120),e.nrm(8,"div",121),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(6),e.SpI("",t.porcentajeMerma,"%"),e.R7$(2),e.xc7("width",t.porcentajeMerma,"%"),e.BMQ("aria-valuenow",t.porcentajeMerma)}}function J(a,n){if(1&a&&(e.j41(0,"div",73)(1,"div",122)(2,"div",123)(3,"small",124),e.EFF(4,"Cantidad Perdida"),e.k0s(),e.j41(5,"strong",75),e.EFF(6),e.k0s()(),e.j41(7,"div",123)(8,"small",124),e.EFF(9,"Costo P\xe9rdida"),e.k0s(),e.j41(10,"strong",75),e.EFF(11),e.nI1(12,"currency"),e.k0s()()(),e.j41(13,"small",125),e.nrm(14,"i",126),e.EFF(15),e.nI1(16,"date"),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(6),e.Lme("",t.cantidadPerdida," ",t.unidadMedida,""),e.R7$(5),e.JRh(e.ii3(12,4,t.costoPerdida,"EUR","symbol","1.2-2")),e.R7$(4),e.SpI(" ",e.i5U(16,9,t.fechaRegistro,"dd/MM/yyyy HH:mm")," ")}}function X(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",101)(1,"div",102),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.verDetalleMerma(i))}),e.j41(2,"div",103)(3,"div",104)(4,"div",105),e.nrm(5,"i",106),e.k0s(),e.j41(6,"div",107)(7,"div",108)(8,"h6",109),e.EFF(9),e.k0s(),e.j41(10,"span",110),e.EFF(11),e.k0s()(),e.j41(12,"p",111),e.EFF(13),e.k0s()()(),e.j41(14,"div",73)(15,"div",112),e.nrm(16,"i",113),e.j41(17,"small",42),e.EFF(18,"Producto:"),e.k0s(),e.j41(19,"strong",114),e.EFF(20),e.k0s()()(),e.DNE(21,L,9,4,"div",72),e.DNE(22,J,17,12,"div",72),e.j41(23,"div",115)(24,"small",42),e.EFF(25,"Estado"),e.k0s(),e.j41(26,"span",69),e.nrm(27,"i",116),e.EFF(28),e.k0s()()()()()}if(2&a){const t=n.$implicit,o=e.XpG();e.R7$(4),e.xc7("background-color","cocina"===t.tipo?"#ffc107":"#dc3545"),e.R7$(1),e.Y8G("ngClass","cocina"===t.tipo?"bi-scissors":"bi-exclamation-triangle-fill"),e.R7$(4),e.JRh(t.nombre),e.R7$(1),e.Y8G("ngClass","cocina"===t.tipo?"bg-warning text-dark":"bg-danger"),e.R7$(1),e.SpI(" ","cocina"===t.tipo?"\u{1f52a} Cocina":"\u{1f4e6} Producto"," "),e.R7$(2),e.JRh(t.descripcion||"Sin descripci\xf3n"),e.R7$(7),e.JRh(o.getProductoNombre(t.productoId)),e.R7$(1),e.Y8G("ngIf","cocina"===t.tipo),e.R7$(1),e.Y8G("ngIf","producto"===t.tipo),e.R7$(4),e.Y8G("ngClass",t.activo?"bg-success":"bg-secondary"),e.R7$(1),e.Y8G("ngClass",t.activo?"bi-check-circle":"bi-x-circle"),e.R7$(1),e.SpI(" ",t.activo?"Activo":"Inactivo"," ")}}function z(a,n){if(1&a&&(e.j41(0,"span",134),e.nrm(1,"i",116),e.EFF(2),e.k0s()),2&a){const t=e.XpG(2);e.Y8G("ngClass",t.mermaSeleccionada.activo?"bg-success":"bg-secondary"),e.R7$(1),e.Y8G("ngClass",t.mermaSeleccionada.activo?"bi-check-circle-fill":"bi-x-circle-fill"),e.R7$(1),e.SpI(" ",t.mermaSeleccionada.activo?"Activo":"Inactivo"," ")}}function B(a,n){if(1&a&&(e.j41(0,"div")(1,"div",135)(2,"div",40),e.nrm(3,"i",136),e.j41(4,"h1",119),e.EFF(5),e.k0s(),e.j41(6,"small",42),e.EFF(7,"Porcentaje de Merma en Cocina"),e.k0s(),e.j41(8,"div",137),e.nrm(9,"div",121),e.k0s()()(),e.j41(10,"div",138)(11,"div",11)(12,"h6",73),e.nrm(13,"i",139),e.EFF(14," Ejemplo de C\xe1lculo "),e.k0s(),e.j41(15,"div",140)(16,"strong"),e.EFF(17),e.k0s(),e.j41(18,"div",141)(19,"div",142)(20,"span"),e.EFF(21,"Cantidad comprada:"),e.k0s(),e.j41(22,"strong"),e.EFF(23),e.k0s()(),e.j41(24,"div",142)(25,"span"),e.EFF(26),e.k0s(),e.j41(27,"strong",143),e.EFF(28),e.nI1(29,"number"),e.k0s()(),e.nrm(30,"hr"),e.j41(31,"div",115)(32,"span")(33,"strong"),e.EFF(34,"Cantidad \xfatil:"),e.k0s()(),e.j41(35,"h5",144),e.EFF(36),e.nI1(37,"number"),e.k0s()()()()()()()),2&a){const t=e.XpG(2);e.R7$(5),e.SpI("",t.mermaSeleccionada.porcentajeMerma,"%"),e.R7$(4),e.xc7("width",t.mermaSeleccionada.porcentajeMerma,"%"),e.BMQ("aria-valuenow",t.mermaSeleccionada.porcentajeMerma),e.R7$(8),e.E5c("Si compras ",t.getProductoCantidad(t.mermaSeleccionada.productoId)," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId)," y la merma es del ",t.mermaSeleccionada.porcentajeMerma,"%, tendr\xe1s:"),e.R7$(6),e.Lme("",t.getProductoCantidad(t.mermaSeleccionada.productoId)," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),""),e.R7$(3),e.SpI("P\xe9rdida por merma (",t.mermaSeleccionada.porcentajeMerma,"%):"),e.R7$(2),e.Lme("",e.i5U(29,14,t.calcularPerdida(t.getProductoCantidad(t.mermaSeleccionada.productoId),t.mermaSeleccionada.porcentajeMerma),"1.1-1")," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),""),e.R7$(8),e.Lme("",e.i5U(37,17,t.calcularUnidadesUtiles(t.getProductoCantidad(t.mermaSeleccionada.productoId),t.mermaSeleccionada.porcentajeMerma),"1.1-1")," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),"")}}function q(a,n){if(1&a&&(e.j41(0,"div")(1,"div",145)(2,"div",146)(3,"div",147)(4,"div",40),e.nrm(5,"i",148),e.j41(6,"h3",149),e.EFF(7),e.k0s(),e.j41(8,"small",42),e.EFF(9),e.k0s()()()(),e.j41(10,"div",146)(11,"div",147)(12,"div",40),e.nrm(13,"i",150),e.j41(14,"h3",149),e.EFF(15),e.nI1(16,"currency"),e.k0s(),e.j41(17,"small",42),e.EFF(18,"Costo de la p\xe9rdida"),e.k0s()()()()(),e.j41(19,"div",131)(20,"div",11)(21,"h6",151),e.nrm(22,"i",152),e.EFF(23," Motivo de la P\xe9rdida "),e.k0s(),e.j41(24,"span",153),e.EFF(25),e.k0s()()(),e.j41(26,"div",138)(27,"div",11)(28,"h6",151),e.nrm(29,"i",154),e.EFF(30," Fecha de Registro "),e.k0s(),e.j41(31,"p",54),e.EFF(32),e.nI1(33,"date"),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(7),e.JRh(t.mermaSeleccionada.cantidadPerdida),e.R7$(2),e.SpI("",t.mermaSeleccionada.unidadMedida," perdidas"),e.R7$(6),e.JRh(e.ii3(16,5,t.mermaSeleccionada.costoPerdida,"EUR","symbol","1.2-2")),e.R7$(10),e.JRh(t.getMotivoTexto(t.mermaSeleccionada.motivo||"")),e.R7$(7),e.JRh(e.i5U(33,10,t.mermaSeleccionada.fechaRegistro,"dd/MM/yyyy HH:mm"))}}function H(a,n){if(1&a&&(e.j41(0,"div",127)(1,"div",128)(2,"span",129),e.nrm(3,"i",70),e.EFF(4),e.k0s(),e.DNE(5,z,3,3,"span",130),e.k0s(),e.j41(6,"div",131)(7,"div",11)(8,"h6",73),e.nrm(9,"i",113),e.EFF(10,"Producto Asociado"),e.k0s(),e.j41(11,"div",51),e.nrm(12,"i",132),e.j41(13,"div")(14,"strong",133),e.EFF(15),e.k0s(),e.j41(16,"small",42),e.EFF(17,"Producto afectado por esta merma"),e.k0s()()()()(),e.DNE(18,B,38,20,"div",30),e.DNE(19,q,34,13,"div",30),e.k0s()),2&a){const t=e.XpG();e.R7$(2),e.Y8G("ngClass","cocina"===t.mermaSeleccionada.tipo?"bg-warning text-dark":"bg-danger"),e.R7$(1),e.Y8G("ngClass","cocina"===t.mermaSeleccionada.tipo?"bi-scissors":"bi-exclamation-triangle"),e.R7$(1),e.SpI(" ","cocina"===t.mermaSeleccionada.tipo?"Merma de Cocina":"Merma de Producto"," "),e.R7$(1),e.Y8G("ngIf","cocina"===t.mermaSeleccionada.tipo),e.R7$(10),e.JRh(t.mermaSeleccionada.productoNombre),e.R7$(3),e.Y8G("ngIf","cocina"===t.mermaSeleccionada.tipo),e.R7$(1),e.Y8G("ngIf","producto"===t.mermaSeleccionada.tipo)}}function Q(a,n){if(1&a&&(e.j41(0,"div",73)(1,"label",74),e.EFF(2,"Tipo de Merma "),e.j41(3,"span",75),e.EFF(4,"*"),e.k0s()(),e.j41(5,"div",122)(6,"div",123)(7,"div",155),e.nrm(8,"input",156),e.j41(9,"label",157),e.nrm(10,"i",158),e.j41(11,"strong"),e.EFF(12,"Cocina"),e.k0s(),e.j41(13,"small",159),e.EFF(14,"P\xe9rdidas durante preparaci\xf3n"),e.k0s()()()(),e.j41(15,"div",123)(16,"div",155),e.nrm(17,"input",160),e.j41(18,"label",161),e.nrm(19,"i",162),e.j41(20,"strong"),e.EFF(21,"Producto"),e.k0s(),e.j41(22,"small",159),e.EFF(23,"Roturas, cancelaciones"),e.k0s()()()()()()),2&a){const t=e.XpG();let o,r;e.R7$(7),e.AVh("border-warning","cocina"===(null==(o=t.mermaForm.get("tipo"))?null:o.value)),e.R7$(9),e.AVh("border-danger","producto"===(null==(r=t.mermaForm.get("tipo"))?null:r.value))}}function W(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",165),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.seleccionarProducto(i))}),e.j41(1,"div",115)(2,"div")(3,"strong"),e.EFF(4),e.k0s(),e.nrm(5,"br"),e.j41(6,"small",42),e.EFF(7),e.k0s()(),e.j41(8,"span",166),e.EFF(9),e.nI1(10,"currency"),e.k0s()()()}if(2&a){const t=n.$implicit;e.R7$(4),e.JRh(t.nombre),e.R7$(3),e.Lme("",t.cantidad," ",t.unidadMedida,""),e.R7$(2),e.JRh(e.ii3(10,4,t.costo,"EUR","symbol","1.2-2"))}}function Z(a,n){if(1&a&&(e.j41(0,"div",163),e.DNE(1,W,11,9,"button",164),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.productosFiltrados)}}function K(a,n){1&a&&(e.j41(0,"div",167)(1,"small"),e.EFF(2,"No se encontraron productos"),e.k0s()())}function ee(a,n){if(1&a&&(e.j41(0,"div",171)(1,"h6",172),e.nrm(2,"i",173),e.EFF(3," Ejemplo de c\xe1lculo: "),e.k0s(),e.j41(4,"p",54),e.EFF(5," Si compras "),e.j41(6,"strong"),e.EFF(7,"100 unidades"),e.k0s(),e.EFF(8," y la merma es del "),e.j41(9,"strong"),e.EFF(10),e.k0s(),e.EFF(11,", tendr\xe1s "),e.j41(12,"strong",174),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.EFF(15,". "),e.k0s()()),2&a){const t=e.XpG(2);let o,r;e.R7$(10),e.SpI("",(null==(o=t.mermaForm.get("porcentajeMerma"))?null:o.value)||0,"%"),e.R7$(3),e.SpI("",e.i5U(14,2,t.calcularUnidadesUtiles(100,(null==(r=t.mermaForm.get("porcentajeMerma"))?null:r.value)||0),"1.1-1")," unidades \xfatiles")}}function te(a,n){if(1&a&&(e.j41(0,"div")(1,"div",73)(2,"label",74),e.EFF(3,"Porcentaje de Merma (%) "),e.j41(4,"span",75),e.EFF(5,"*"),e.k0s()(),e.j41(6,"div",14),e.nrm(7,"input",168),e.j41(8,"span",169),e.EFF(9,"%"),e.k0s()(),e.j41(10,"small",42),e.EFF(11,"Porcentaje estimado de p\xe9rdida durante el procesamiento"),e.k0s()(),e.DNE(12,ee,16,5,"div",170),e.k0s()),2&a){const t=e.XpG();let o;e.R7$(12),e.Y8G("ngIf",(null==(o=t.mermaForm.get("porcentajeMerma"))?null:o.value)>=0)}}function re(a,n){if(1&a&&(e.j41(0,"div",184)(1,"h6",172),e.nrm(2,"i",185),e.EFF(3," Costo de la P\xe9rdida: "),e.k0s(),e.j41(4,"h4",149),e.EFF(5),e.nI1(6,"currency"),e.k0s()()),2&a){const t=e.XpG(2);let o;e.R7$(5),e.SpI(" ",e.ii3(6,1,t.calcularCostoPerdida(null==(o=t.mermaForm.get("productoId"))?null:o.value,null==(o=t.mermaForm.get("cantidadPerdida"))?null:o.value),"EUR","symbol","1.2-2")," ")}}function oe(a,n){if(1&a&&(e.j41(0,"div")(1,"div",73)(2,"label",74),e.EFF(3,"Cantidad Perdida "),e.j41(4,"span",75),e.EFF(5,"*"),e.k0s()(),e.j41(6,"div",14),e.nrm(7,"input",175),e.j41(8,"span",169),e.EFF(9),e.k0s()(),e.j41(10,"small",42),e.EFF(11,"Cantidad exacta del producto perdido"),e.k0s()(),e.j41(12,"div",73)(13,"label",74),e.EFF(14,"Motivo "),e.j41(15,"span",75),e.EFF(16,"*"),e.k0s()(),e.j41(17,"select",176)(18,"option",25),e.EFF(19,"Seleccionar motivo"),e.k0s(),e.j41(20,"option",177),e.EFF(21,"Rotura/Ca\xedda"),e.k0s(),e.j41(22,"option",178),e.EFF(23,"Cancelaci\xf3n de pedido"),e.k0s(),e.j41(24,"option",179),e.EFF(25,"Vencimiento"),e.k0s(),e.j41(26,"option",180),e.EFF(27,"Deterioro/Mal estado"),e.k0s(),e.j41(28,"option",181),e.EFF(29,"Error de preparaci\xf3n"),e.k0s(),e.j41(30,"option",182),e.EFF(31,"Otro"),e.k0s()()(),e.DNE(32,re,7,6,"div",183),e.k0s()),2&a){const t=e.XpG();let o,r;e.R7$(9),e.JRh(t.getProductoUnidadMedida(null==(o=t.mermaForm.get("productoId"))?null:o.value)||"unidades"),e.R7$(23),e.Y8G("ngIf",(null==(r=t.mermaForm.get("cantidadPerdida"))?null:r.value)>0&&(null==(r=t.mermaForm.get("productoId"))?null:r.value))}}function ae(a,n){1&a&&(e.j41(0,"div",186),e.nrm(1,"input",187),e.j41(2,"label",188),e.EFF(3," Activo (usar en escandallos) "),e.k0s()())}const ie=function(){return{standalone:!0}};let ne=(()=>{class a{constructor(t,o,r){this.fb=t,this.firestore=o,this.mermasService=r,this.mermas=[],this.mermasFiltradas=[],this.productos=[],this.mermaSeleccionada=null,this.totalMermas=0,this.mermasActivas=0,this.promedioMerma=0,this.cantidadEjemplo=100,this.filtroTexto="",this.filtroEstado="todos",this.filtroTipo="todos",this.filtroProducto="",this.ordenarPor="nombre",this.ordenDireccion="asc",this.busquedaProducto="",this.productosFiltrados=[],this.mostrarListaProductos=!1,this.subscriptions=new v.yU,this.inicializarForm()}ngOnInit(){this.cargarMermas(),this.cargarProductos();const t=document.getElementById("mermaModal");t&&(this.modal=new bootstrap.Modal(t));const o=document.getElementById("detalleMermaModal");o&&(this.detalleModal=new bootstrap.Modal(o)),this.mermaForm.get("porcentajeMerma")?.valueChanges.subscribe(()=>{this.actualizarEjemplo()})}ngOnDestroy(){this.subscriptions.unsubscribe()}inicializarForm(){this.mermaForm=this.fb.group({id:[""],tipo:["cocina",d.k0.required],productoId:["",d.k0.required],nombre:[""],descripcion:[""],porcentajeMerma:[0],cantidadPerdida:[0],motivo:[""],activo:[!0]}),this.mermaForm.get("tipo")?.valueChanges.subscribe(t=>{this.actualizarValidacionesPorTipo(t)})}actualizarValidacionesPorTipo(t){const o=this.mermaForm.get("porcentajeMerma"),r=this.mermaForm.get("cantidadPerdida"),i=this.mermaForm.get("motivo");"cocina"===t?(o?.setValidators([d.k0.required,d.k0.min(0),d.k0.max(100)]),r?.clearValidators(),i?.clearValidators()):(o?.clearValidators(),r?.setValidators([d.k0.required,d.k0.min(0)]),i?.setValidators([d.k0.required])),o?.updateValueAndValidity(),r?.updateValueAndValidity(),i?.updateValueAndValidity()}cargarMermas(){this.subscriptions.add(this.mermasService.getMermas().subscribe(t=>{this.mermas=t,this.aplicarFiltros(),this.calcularEstadisticas()}))}cargarProductos(){const t=(0,g.collection)(this.firestore,"productos");this.subscriptions.add((0,g.collectionData)(t,{idField:"id"}).subscribe(o=>{this.productos=o.filter(r=>!r.esCombinado)}))}calcularEstadisticas(){if(this.totalMermas=this.mermas.length,this.mermasActivas=this.mermas.filter(t=>t.activo).length,this.mermas.length>0){const t=this.mermas.reduce((o,r)=>o+r.porcentajeMerma,0);this.promedioMerma=t/this.mermas.length}else this.promedioMerma=0}abrirModalNuevo(){this.mermaForm.reset({id:"",tipo:"cocina",productoId:"",nombre:"",descripcion:"",porcentajeMerma:0,cantidadPerdida:0,motivo:"",activo:!0}),this.busquedaProducto="",this.productosFiltrados=this.productos.slice(0,10),this.mostrarListaProductos=!1,this.actualizarValidacionesPorTipo("cocina"),this.modal.show()}verDetalleMerma(t){const o=this.productos.find(r=>r.id===t.productoId);this.mermaSeleccionada={...t,productoNombre:o?.nombre||"Producto no encontrado"},this.detalleModal.show()}editarMerma(t){this.mermaForm.patchValue(t);const o=this.productos.find(r=>r.id===t.productoId);this.busquedaProducto=o?.nombre||"",this.mostrarListaProductos=!1,this.modal.show()}editarDesdeDetalle(){this.mermaSeleccionada&&(this.detalleModal.hide(),this.editarMerma(this.mermaSeleccionada))}eliminarMerma(t){var o=this;return(0,F.A)(function*(){if((yield p().fire({title:"\xbfEliminar Merma?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield o.mermasService.eliminarMerma(t),p().fire("\xa1Eliminada!","La merma ha sido eliminada.","success")}catch(i){console.error("Error al eliminar merma:",i),p().fire("Error","No se pudo eliminar la merma.","error")}})()}eliminarDesdeDetalle(){var t=this;return(0,F.A)(function*(){t.mermaSeleccionada?.id&&(t.detalleModal.hide(),yield t.eliminarMerma(t.mermaSeleccionada.id),t.mermaSeleccionada=null)})()}guardarMerma(){var t=this;return(0,F.A)(function*(){if(t.mermaForm.invalid)return void p().fire("Error","Por favor completa todos los campos requeridos.","error");const o=t.mermaForm.value,r=o.tipo,i=t.productos.find(m=>m.id===o.productoId),s=o.nombre?.trim()||("cocina"===r?`Merma de ${i?.nombre}`:`P\xe9rdida de ${i?.nombre}`);let c={tipo:r,productoId:o.productoId,nombre:s,descripcion:o.descripcion||""};if("cocina"===r)c.porcentajeMerma=o.porcentajeMerma,c.activo=o.activo;else{const m=o.cantidadPerdida,b=i?i.costo/i.cantidad*m:0;c.cantidadPerdida=m,c.unidadMedida=i?.unidadMedida||"unidades",c.costoPerdida=b,c.motivo=o.motivo,c.fechaRegistro=new Date,c.activo=!1}try{if(o.id)yield t.mermasService.actualizarMerma(o.id,c),p().fire("\xa1Actualizada!","La merma ha sido actualizada.","success");else{yield t.mermasService.crearMerma(c);const m="cocina"===r?"La merma de cocina ha sido guardada.":"La merma de producto ha sido registrada.";p().fire("\xa1Registrada!",m,"success")}t.modal.hide(),t.mermaForm.reset()}catch(m){console.error("Error al guardar merma:",m),p().fire("Error","Hubo un problema al guardar la merma.","error")}})()}getProductoNombre(t){return this.productos.find(r=>r.id===t)?.nombre||"Producto no encontrado"}getProductoCategoria(t){return this.productos.find(r=>r.id===t)?.categoriaId||""}getProductoUnidadMedida(t){return this.productos.find(r=>r.id===t)?.unidadMedida||"unidades"}getProductoCantidad(t){return this.productos.find(r=>r.id===t)?.cantidad||1}calcularUnidadesUtiles(t,o){return this.mermasService.calcularCantidadUtil(t,o)}calcularPerdida(t,o){return this.mermasService.calcularPerdida(t,o)}actualizarEjemplo(){}aplicarFiltros(){let t=[...this.mermas];if(this.filtroTexto.trim()){const o=this.filtroTexto.toLowerCase();t=t.filter(r=>r.nombre.toLowerCase().includes(o)||r.descripcion.toLowerCase().includes(o)||this.getProductoNombre(r.productoId).toLowerCase().includes(o))}"todos"!==this.filtroTipo&&(t=t.filter(o=>o.tipo===this.filtroTipo)),"activo"===this.filtroEstado?t=t.filter(o=>o.activo):"inactivo"===this.filtroEstado&&(t=t.filter(o=>!o.activo)),this.filtroProducto&&(t=t.filter(o=>o.productoId===this.filtroProducto)),t=this.ordenarMermas(t),this.mermasFiltradas=t}ordenarMermas(t){return t.sort((o,r)=>{let i=0;switch(this.ordenarPor){case"nombre":i=o.nombre.localeCompare(r.nombre);break;case"porcentaje":i=o.porcentajeMerma-r.porcentajeMerma;break;case"fecha":const s=o.fechaCreacion?.toDate?.()||new Date(0),c=r.fechaCreacion?.toDate?.()||new Date(0);i=s.getTime()-c.getTime()}return"asc"===this.ordenDireccion?i:-i})}cambiarOrden(t){this.ordenarPor===t?this.ordenDireccion="asc"===this.ordenDireccion?"desc":"asc":(this.ordenarPor=t,this.ordenDireccion="asc"),this.aplicarFiltros()}limpiarFiltros(){this.filtroTexto="",this.filtroEstado="todos",this.filtroTipo="todos",this.filtroProducto="",this.aplicarFiltros()}calcularCostoPerdida(t,o){const r=this.productos.find(s=>s.id===t);return r&&o?r.costo/r.cantidad*o:0}getMotivoTexto(t){return{rotura:"Rotura/Ca\xedda",cancelacion:"Cancelaci\xf3n de pedido",vencimiento:"Vencimiento",deterioro:"Deterioro/Mal estado",error:"Error de preparaci\xf3n",otro:"Otro"}[t]||t}filtrarProductos(){if(!this.busquedaProducto.trim())return void(this.productosFiltrados=this.productos.slice(0,10));const t=this.busquedaProducto.toLowerCase();this.productosFiltrados=this.productos.filter(o=>o.nombre.toLowerCase().includes(t)).slice(0,10)}seleccionarProducto(t){this.mermaForm.patchValue({productoId:t.id}),this.busquedaProducto=t.nombre,this.mostrarListaProductos=!1}getMermaPorProducto(t){return this.mermas.find(o=>o.productoId===t&&o.activo)}calcularCantidadConMerma(t,o){const r=this.getMermaPorProducto(t);return r?this.mermasService.calcularCantidadUtil(o,r.porcentajeMerma):o}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(d.ok),e.rXU(g.Firestore),e.rXU(_.d))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-mermas-page"]],decls:165,vars:56,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],["routerLink","/private/mermas/reportes",1,"btn","btn-outline-primary","me-2"],[1,"bi","bi-graph-up","me-2"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-4"],[1,"col-12"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text","bg-white"],[1,"bi","bi-search"],["type","text","placeholder","Buscar por nombre, descripci\xf3n o producto...",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-md-2"],[1,"form-select",3,"ngModel","ngModelChange"],["value","todos"],["value","cocina"],["value","producto"],["value","activo"],["value","inactivo"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-outline-secondary","w-100",3,"disabled","click"],[1,"bi","bi-x-circle","me-1"],[1,"mt-3","d-flex","justify-content-between","align-items-center"],[4,"ngIf"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","bi bi-sort-alpha-down me-1",4,"ngIf"],["class","bi bi-sort-alpha-up me-1",4,"ngIf"],["class","bi bi-sort-numeric-down me-1",4,"ngIf"],["class","bi bi-sort-numeric-up me-1",4,"ngIf"],["class","bi bi-sort-down me-1",4,"ngIf"],["class","bi bi-sort-up me-1",4,"ngIf"],[1,"col-md-4","mb-3"],[1,"card-body","text-center"],[1,"text-primary","mb-0"],[1,"text-muted"],[1,"text-success","mb-0"],[1,"text-warning","mb-0"],["class","col-12 text-center py-5",4,"ngIf"],["class","col-12 col-md-6 col-lg-4 mb-4",4,"ngFor","ngForOf"],["id","detalleMermaModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header","border-0","pb-0"],[1,"d-flex","align-items-center"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"width","56px","height","56px"],[1,"text-white","fs-3",3,"ngClass"],[1,"mb-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body pt-3",4,"ngIf"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-lg","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-fill","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[1,"bi","bi-trash3-fill","me-2"],["id","mermaModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title","mb-1"],[1,"badge",3,"ngClass"],[3,"ngClass"],[1,"modal-body"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],[1,"position-relative"],["type","text","placeholder","Buscar producto...","autocomplete","off",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange","focus","input"],[1,"bi","bi-search","position-absolute","top-50","end-0","translate-middle-y","me-3","text-muted"],["class","list-group position-absolute w-100 shadow-lg","style","max-height: 300px; overflow-y: auto; z-index: 1000;",4,"ngIf"],["class","alert alert-info mt-2 py-2",4,"ngIf"],["type","hidden","formControlName","productoId"],["type","text","formControlName","nombre",1,"form-control",3,"placeholder"],["formControlName","descripcion","rows","2",1,"form-control",3,"placeholder"],["class","form-check",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"btn",3,"ngClass","disabled"],[3,"value"],[1,"bi","bi-funnel","me-1"],[1,"bi","bi-sort-alpha-down","me-1"],[1,"bi","bi-sort-alpha-up","me-1"],[1,"bi","bi-sort-numeric-down","me-1"],[1,"bi","bi-sort-numeric-up","me-1"],[1,"bi","bi-sort-down","me-1"],[1,"bi","bi-sort-up","me-1"],[1,"col-12","text-center","py-5"],[1,"bi","bi-inbox","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"bi","bi-plus","me-1"],[1,"bi","bi-search","fs-1","text-muted"],[1,"btn","btn-outline-secondary",3,"click"],[1,"col-12","col-md-6","col-lg-4","mb-4"],[1,"card","shadow-sm","border-0","h-100",2,"cursor","pointer",3,"click"],[1,"card-body","p-4"],[1,"d-flex","align-items-start","mb-3"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"width","48px","height","48px","min-width","48px"],[1,"text-white","fs-5",3,"ngClass"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2","mb-1"],[1,"mb-0","fw-bold"],[1,"badge","badge-sm",3,"ngClass"],[1,"text-muted","small","mb-2"],[1,"d-flex","align-items-center","p-2","bg-light","rounded"],[1,"bi","bi-box","me-2","text-primary"],[1,"ms-2","small"],[1,"d-flex","justify-content-between","align-items-center"],[1,"bi",3,"ngClass"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"bi","bi-percent","me-1"],[1,"mb-0","text-warning"],[1,"progress",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-warning"],[1,"row","g-2"],[1,"col-6"],[1,"text-muted","d-block"],[1,"text-muted","d-block","mt-2"],[1,"bi","bi-calendar3","me-1"],[1,"modal-body","pt-3"],[1,"mb-4"],[1,"badge","px-3","py-2","me-2",3,"ngClass"],["class","badge px-3 py-2",3,"ngClass",4,"ngIf"],[1,"card","border-0","bg-light","mb-3"],[1,"bi","bi-box-seam","fs-3","text-primary","me-3"],[1,"d-block"],[1,"badge","px-3","py-2",3,"ngClass"],[1,"card","border-0","bg-warning","bg-opacity-10","mb-3"],[1,"bi","bi-percent","text-warning","fs-1","d-block","mb-2"],[1,"progress","mt-3",2,"height","12px"],[1,"card","border-0","bg-light"],[1,"bi","bi-calculator","me-2","text-primary"],[1,"alert","alert-info","mb-0"],[1,"mt-3"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"text-warning"],[1,"mb-0","text-success"],[1,"row","g-3","mb-3"],[1,"col-md-6"],[1,"card","border-0","bg-danger","bg-opacity-10","h-100"],[1,"bi","bi-box-seam","text-danger","fs-2","d-block","mb-2"],[1,"mb-0","text-danger"],[1,"bi","bi-cash-coin","text-danger","fs-2","d-block","mb-2"],[1,"mb-2"],[1,"bi","bi-info-circle","me-2","text-primary"],[1,"badge","bg-danger","px-3","py-2"],[1,"bi","bi-calendar3","me-2","text-primary"],[1,"form-check","card","p-3"],["type","radio","formControlName","tipo","value","cocina","id","tipoCocina",1,"form-check-input"],["for","tipoCocina",1,"form-check-label"],[1,"bi","bi-scissors","text-warning","fs-4","d-block","mb-2"],[1,"d-block","text-muted"],["type","radio","formControlName","tipo","value","producto","id","tipoProducto",1,"form-check-input"],["for","tipoProducto",1,"form-check-label"],[1,"bi","bi-exclamation-triangle","text-danger","fs-4","d-block","mb-2"],[1,"list-group","position-absolute","w-100","shadow-lg",2,"max-height","300px","overflow-y","auto","z-index","1000"],["type","button","class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action",3,"click"],[1,"badge","bg-primary"],[1,"alert","alert-info","mt-2","py-2"],["type","number","formControlName","porcentajeMerma","placeholder","0","min","0","max","100","step","0.1",1,"form-control"],[1,"input-group-text"],["class","alert alert-warning",4,"ngIf"],[1,"alert","alert-warning"],[1,"alert-heading"],[1,"bi","bi-calculator","me-2"],[1,"text-success"],["type","number","formControlName","cantidadPerdida","placeholder","0","min","0","step","0.01",1,"form-control"],["formControlName","motivo",1,"form-select"],["value","rotura"],["value","cancelacion"],["value","vencimiento"],["value","deterioro"],["value","error"],["value","otro"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle","me-2"],[1,"form-check"],["type","checkbox","formControlName","activo","id","activoCheck",1,"form-check-input"],["for","activoCheck",1,"form-check-label"]],template:function(o,r){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),e.EFF(4,"Gesti\xf3n de Mermas"),e.k0s(),e.j41(5,"span"),e.EFF(6,"Controla las p\xe9rdidas de cocina y productos operacionales"),e.k0s()(),e.j41(7,"div",3)(8,"button",4),e.nrm(9,"i",5),e.EFF(10," Ver Reportes "),e.k0s(),e.j41(11,"button",6),e.bIt("click",function(){return r.abrirModalNuevo()}),e.nrm(12,"i",7),e.EFF(13," Nueva Merma "),e.k0s()()(),e.j41(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"div",13)(20,"div",14)(21,"span",15),e.nrm(22,"i",16),e.k0s(),e.j41(23,"input",17),e.bIt("ngModelChange",function(s){return r.filtroTexto=s})("ngModelChange",function(){return r.aplicarFiltros()}),e.k0s()()(),e.j41(24,"div",18)(25,"select",19),e.bIt("ngModelChange",function(s){return r.filtroTipo=s})("ngModelChange",function(){return r.aplicarFiltros()}),e.j41(26,"option",20),e.EFF(27,"Todos los tipos"),e.k0s(),e.j41(28,"option",21),e.EFF(29,"\u{1f52a} Cocina"),e.k0s(),e.j41(30,"option",22),e.EFF(31,"\u{1f4e6} Producto"),e.k0s()()(),e.j41(32,"div",18)(33,"select",19),e.bIt("ngModelChange",function(s){return r.filtroEstado=s})("ngModelChange",function(){return r.aplicarFiltros()}),e.j41(34,"option",20),e.EFF(35,"Todos los estados"),e.k0s(),e.j41(36,"option",23),e.EFF(37,"Activos"),e.k0s(),e.j41(38,"option",24),e.EFF(39,"Inactivos"),e.k0s()()(),e.j41(40,"div",18)(41,"select",19),e.bIt("ngModelChange",function(s){return r.filtroProducto=s})("ngModelChange",function(){return r.aplicarFiltros()}),e.j41(42,"option",25),e.EFF(43,"Todos los productos"),e.k0s(),e.DNE(44,$,2,2,"option",26),e.k0s()(),e.j41(45,"div",18)(46,"button",27),e.bIt("click",function(){return r.limpiarFiltros()}),e.nrm(47,"i",28),e.EFF(48," Limpiar "),e.k0s()()(),e.j41(49,"div",29),e.DNE(50,x,4,2,"div",30),e.j41(51,"div",31)(52,"button",32),e.bIt("click",function(){return r.cambiarOrden("nombre")}),e.DNE(53,T,1,0,"i",33),e.DNE(54,S,1,0,"i",34),e.DNE(55,w,1,0,"i",33),e.EFF(56," Nombre "),e.k0s(),e.j41(57,"button",32),e.bIt("click",function(){return r.cambiarOrden("porcentaje")}),e.DNE(58,D,1,0,"i",35),e.DNE(59,G,1,0,"i",36),e.DNE(60,O,1,0,"i",35),e.EFF(61," Porcentaje "),e.k0s(),e.j41(62,"button",32),e.bIt("click",function(){return r.cambiarOrden("fecha")}),e.DNE(63,N,1,0,"i",37),e.DNE(64,Y,1,0,"i",38),e.DNE(65,U,1,0,"i",37),e.EFF(66," Fecha "),e.k0s()()()()()()(),e.j41(67,"div",8)(68,"div",39)(69,"div",10)(70,"div",40)(71,"h2",41),e.EFF(72),e.k0s(),e.j41(73,"span",42),e.EFF(74,"Total Mermas"),e.k0s()()()(),e.j41(75,"div",39)(76,"div",10)(77,"div",40)(78,"h2",43),e.EFF(79),e.k0s(),e.j41(80,"span",42),e.EFF(81,"Activas"),e.k0s()()()(),e.j41(82,"div",39)(83,"div",10)(84,"div",40)(85,"h2",44),e.EFF(86),e.nI1(87,"number"),e.k0s(),e.j41(88,"span",42),e.EFF(89,"Promedio de Merma"),e.k0s()()()()(),e.j41(90,"div",8),e.DNE(91,V,9,0,"div",45),e.DNE(92,A,9,0,"div",45),e.DNE(93,X,29,13,"div",46),e.k0s()(),e.j41(94,"div",47)(95,"div",48)(96,"div",49)(97,"div",50)(98,"div",51)(99,"div",52),e.nrm(100,"i",53),e.k0s(),e.j41(101,"div")(102,"h4",54),e.EFF(103),e.k0s(),e.j41(104,"small",42),e.EFF(105),e.k0s()()(),e.nrm(106,"button",55),e.k0s(),e.DNE(107,H,20,7,"div",56),e.j41(108,"div",57)(109,"button",58),e.nrm(110,"i",59),e.EFF(111,"Cerrar "),e.k0s(),e.j41(112,"button",60),e.bIt("click",function(){return r.editarDesdeDetalle()}),e.nrm(113,"i",61),e.EFF(114,"Editar "),e.k0s(),e.j41(115,"button",62),e.bIt("click",function(){return r.eliminarDesdeDetalle()}),e.nrm(116,"i",63),e.EFF(117,"Eliminar "),e.k0s()()()()(),e.j41(118,"div",64)(119,"div",65)(120,"div",49)(121,"form",66),e.bIt("ngSubmit",function(){return r.guardarMerma()}),e.j41(122,"div",67)(123,"div")(124,"h5",68),e.EFF(125),e.k0s(),e.j41(126,"span",69),e.nrm(127,"i",70),e.EFF(128),e.k0s()(),e.nrm(129,"button",55),e.k0s(),e.j41(130,"div",71),e.DNE(131,Q,24,4,"div",72),e.j41(132,"div",73)(133,"label",74),e.EFF(134,"Producto "),e.j41(135,"span",75),e.EFF(136,"*"),e.k0s()(),e.j41(137,"div",76)(138,"input",77),e.bIt("ngModelChange",function(s){return r.busquedaProducto=s})("focus",function(){return r.mostrarListaProductos=!0})("input",function(){return r.filtrarProductos()}),e.k0s(),e.nrm(139,"i",78),e.DNE(140,Z,2,1,"div",79),e.DNE(141,K,3,0,"div",80),e.k0s(),e.nrm(142,"input",81),e.k0s(),e.j41(143,"div",73)(144,"label",74),e.EFF(145,"Nombre "),e.j41(146,"small",42),e.EFF(147,"(Opcional)"),e.k0s()(),e.nrm(148,"input",82),e.j41(149,"small",42),e.EFF(150,"Si no se especifica, se usar\xe1 el nombre del producto"),e.k0s()(),e.j41(151,"div",73)(152,"label",74),e.EFF(153,"Descripci\xf3n "),e.j41(154,"small",42),e.EFF(155,"(Opcional)"),e.k0s()(),e.nrm(156,"textarea",83),e.k0s(),e.DNE(157,te,13,1,"div",30),e.DNE(158,oe,33,2,"div",30),e.DNE(159,ae,4,0,"div",84),e.k0s(),e.j41(160,"div",85)(161,"button",58),e.EFF(162,"Cancelar"),e.k0s(),e.j41(163,"button",86),e.EFF(164),e.k0s()()()()()()),2&o){let i,s,c,m,b,M,E,j,k,P,C,R;e.R7$(23),e.Y8G("ngModel",r.filtroTexto),e.R7$(2),e.Y8G("ngModel",r.filtroTipo),e.R7$(8),e.Y8G("ngModel",r.filtroEstado),e.R7$(8),e.Y8G("ngModel",r.filtroProducto),e.R7$(3),e.Y8G("ngForOf",r.productos),e.R7$(2),e.Y8G("disabled",!r.filtroTexto&&"todos"===r.filtroEstado&&"todos"===r.filtroTipo&&!r.filtroProducto),e.R7$(4),e.Y8G("ngIf",r.filtroTexto||"todos"!==r.filtroEstado||"todos"!==r.filtroTipo||r.filtroProducto),e.R7$(2),e.AVh("active","nombre"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","nombre"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","nombre"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","nombre"!==r.ordenarPor),e.R7$(2),e.AVh("active","porcentaje"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","porcentaje"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","porcentaje"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","porcentaje"!==r.ordenarPor),e.R7$(2),e.AVh("active","fecha"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","fecha"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","fecha"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","fecha"!==r.ordenarPor),e.R7$(7),e.JRh(r.totalMermas),e.R7$(7),e.JRh(r.mermasActivas),e.R7$(7),e.SpI("",e.i5U(87,52,r.promedioMerma,"1.1-1"),"%"),e.R7$(5),e.Y8G("ngIf",0===r.mermasFiltradas.length&&0===r.mermas.length),e.R7$(1),e.Y8G("ngIf",0===r.mermasFiltradas.length&&r.mermas.length>0),e.R7$(1),e.Y8G("ngForOf",r.mermasFiltradas),e.R7$(6),e.xc7("background-color","cocina"===(null==r.mermaSeleccionada?null:r.mermaSeleccionada.tipo)?"#ffc107":"#dc3545"),e.R7$(1),e.Y8G("ngClass","cocina"===(null==r.mermaSeleccionada?null:r.mermaSeleccionada.tipo)?"bi-scissors":"bi-exclamation-triangle-fill"),e.R7$(3),e.JRh(null==r.mermaSeleccionada?null:r.mermaSeleccionada.nombre),e.R7$(2),e.JRh((null==r.mermaSeleccionada?null:r.mermaSeleccionada.descripcion)||"Sin descripci\xf3n"),e.R7$(2),e.Y8G("ngIf",r.mermaSeleccionada),e.R7$(14),e.Y8G("formGroup",r.mermaForm),e.R7$(4),e.JRh(null!=(i=r.mermaForm.get("id"))&&i.value?"Editar Merma":"Nueva Merma"),e.R7$(1),e.Y8G("ngClass","cocina"===(null==(s=r.mermaForm.get("tipo"))?null:s.value)?"bg-warning text-dark":"bg-danger"),e.R7$(1),e.Y8G("ngClass","cocina"===(null==(c=r.mermaForm.get("tipo"))?null:c.value)?"bi-scissors":"bi-exclamation-triangle"),e.R7$(1),e.SpI(" ","cocina"===(null==(m=r.mermaForm.get("tipo"))?null:m.value)?"Merma de Cocina":"Merma de Producto"," "),e.R7$(3),e.Y8G("ngIf",!(null!=(b=r.mermaForm.get("id"))&&b.value)),e.R7$(7),e.Y8G("ngModel",r.busquedaProducto)("ngModelOptions",e.lJ4(55,ie)),e.R7$(2),e.Y8G("ngIf",r.mostrarListaProductos&&r.productosFiltrados.length>0),e.R7$(1),e.Y8G("ngIf",r.mostrarListaProductos&&r.busquedaProducto&&0===r.productosFiltrados.length),e.R7$(7),e.Y8G("placeholder","cocina"===(null==(M=r.mermaForm.get("tipo"))?null:M.value)?"Ej: Merma de Papa al pelar":"Ej: Refresco ca\xeddo"),e.R7$(8),e.Y8G("placeholder","cocina"===(null==(E=r.mermaForm.get("tipo"))?null:E.value)?"Ej: P\xe9rdida durante pelado y limpieza":"Ej: Se cay\xf3 al suelo durante el servicio"),e.R7$(1),e.Y8G("ngIf","cocina"===(null==(j=r.mermaForm.get("tipo"))?null:j.value)),e.R7$(1),e.Y8G("ngIf","producto"===(null==(k=r.mermaForm.get("tipo"))?null:k.value)),e.R7$(1),e.Y8G("ngIf","cocina"===(null==(P=r.mermaForm.get("tipo"))?null:P.value)),e.R7$(4),e.Y8G("ngClass","cocina"===(null==(C=r.mermaForm.get("tipo"))?null:C.value)?"btn-warning":"btn-danger")("disabled",r.mermaForm.invalid),e.R7$(1),e.SpI(" ",null!=(R=r.mermaForm.get("id"))&&R.value?"Actualizar":"Registrar"," ")}},dependencies:[f.Wk,u.YU,u.Sq,u.bT,d.qT,d.xH,d.y7,d.me,d.Q0,d.Zm,d.wz,d.Fm,d.BC,d.cb,d.VZ,d.zX,d.j4,d.JD,d.vS,u.QX,u.oe,u.vh],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 .5rem 1rem #00000026!important}.progress[_ngcontent-%COMP%]{background-color:#0000001a}.badge[_ngcontent-%COMP%]{font-weight:500}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.input-group-text[_ngcontent-%COMP%]{border-right:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-left:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-left:0;box-shadow:none}.btn-group[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;border-color:var(--bs-primary)}.modal-content[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden}.modal-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:#fff}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:brightness(0) invert(1)}.modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#fff}.card-body[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700}.progress-bar[_ngcontent-%COMP%]{transition:width .6s ease}.alert[_ngcontent-%COMP%]{border-radius:8px;border:none}.alert.alert-warning[_ngcontent-%COMP%]{background-color:#ffc1071a;border-left:4px solid #ffc107}"]})}}return a})();var se=l(4572);function de(a,n){if(1&a&&(e.j41(0,"div",1)(1,"div",18)(2,"div",23)(3,"div",19)(4,"h6",20),e.nrm(5,"i",24),e.EFF(6," Producto con Mayor P\xe9rdida "),e.k0s(),e.j41(7,"div",25)(8,"div",26)(9,"h5",13),e.EFF(10),e.k0s(),e.j41(11,"small",5),e.EFF(12),e.k0s()(),e.j41(13,"div",27)(14,"div",28),e.EFF(15,"Merma"),e.k0s(),e.j41(16,"h4",29),e.EFF(17),e.k0s()(),e.j41(18,"div",30)(19,"div",28),e.EFF(20,"P\xe9rdida"),e.k0s(),e.j41(21,"h5",13),e.EFF(22),e.nI1(23,"number"),e.k0s()(),e.j41(24,"div",30)(25,"div",28),e.EFF(26,"Costo P\xe9rdida"),e.k0s(),e.j41(27,"h5",29),e.EFF(28),e.nI1(29,"number"),e.k0s()()()()()()()),2&a){const t=e.XpG();e.R7$(10),e.JRh(t.productoMayorMerma.producto.nombre),e.R7$(2),e.JRh(t.productoMayorMerma.merma.nombre),e.R7$(5),e.SpI("",t.productoMayorMerma.merma.porcentajeMerma,"%"),e.R7$(5),e.Lme("",e.i5U(23,6,t.productoMayorMerma.perdidaEstimada,"1.1-1")," ",t.productoMayorMerma.producto.unidadMedida,""),e.R7$(6),e.SpI("$",e.i5U(29,9,t.productoMayorMerma.costoPerdida,"1.2-2"),"")}}function ce(a,n){1&a&&(e.j41(0,"div",31),e.nrm(1,"i",32),e.j41(2,"h5",33),e.EFF(3,"No hay datos para mostrar"),e.k0s(),e.j41(4,"p",5),e.EFF(5,"Configura mermas para tus productos para ver el reporte"),e.k0s()())}function le(a,n){if(1&a&&(e.j41(0,"tr")(1,"td")(2,"strong"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.j41(5,"small",5),e.EFF(6),e.k0s()(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td",36)(10,"span",41),e.EFF(11),e.k0s()(),e.j41(12,"td",36),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.j41(15,"td",40)(16,"strong"),e.EFF(17),e.nI1(18,"number"),e.k0s(),e.EFF(19),e.k0s(),e.j41(20,"td",42)(21,"strong"),e.EFF(22),e.nI1(23,"number"),e.k0s(),e.EFF(24),e.k0s(),e.j41(25,"td",40)(26,"strong"),e.EFF(27),e.nI1(28,"number"),e.k0s()()()),2&a){const t=n.$implicit;e.R7$(3),e.JRh(t.producto.nombre),e.R7$(3),e.JRh(t.producto.categoriaId),e.R7$(2),e.JRh(t.merma.nombre),e.R7$(3),e.SpI(" ",t.merma.porcentajeMerma,"% "),e.R7$(2),e.Lme(" ",e.i5U(14,11,t.cantidadComprada,"1.1-1")," ",t.producto.unidadMedida," "),e.R7$(4),e.JRh(e.i5U(18,14,t.perdidaEstimada,"1.1-1")),e.R7$(2),e.SpI(" ",t.producto.unidadMedida," "),e.R7$(3),e.JRh(e.i5U(23,17,t.cantidadUtil,"1.1-1")),e.R7$(2),e.SpI(" ",t.producto.unidadMedida," "),e.R7$(3),e.SpI("$",e.i5U(28,20,t.costoPerdida,"1.2-2"),"")}}function me(a,n){if(1&a&&(e.j41(0,"div",34)(1,"table",35)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Producto"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Merma"),e.k0s(),e.j41(8,"th",36),e.EFF(9,"% Merma"),e.k0s(),e.j41(10,"th",36),e.EFF(11,"Cantidad Comprada"),e.k0s(),e.j41(12,"th",36),e.EFF(13,"P\xe9rdida"),e.k0s(),e.j41(14,"th",36),e.EFF(15,"Cantidad \xdatil"),e.k0s(),e.j41(16,"th",36),e.EFF(17,"Costo P\xe9rdida"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,le,29,23,"tr",37),e.k0s(),e.j41(20,"tfoot")(21,"tr",38)(22,"td",39)(23,"strong"),e.EFF(24,"TOTALES:"),e.k0s()(),e.j41(25,"td",40)(26,"strong"),e.EFF(27),e.nI1(28,"number"),e.k0s()(),e.nrm(29,"td"),e.j41(30,"td",40)(31,"strong"),e.EFF(32),e.nI1(33,"number"),e.k0s()()()()()()),2&a){const t=e.XpG();e.R7$(19),e.Y8G("ngForOf",t.reportes),e.R7$(8),e.JRh(e.i5U(28,3,t.totalPerdida,"1.1-1")),e.R7$(5),e.SpI("$",e.i5U(33,6,t.totalCostoPerdida,"1.2-2"),"")}}const ue=[{path:"",component:ne},{path:"reportes",component:(()=>{class a{constructor(t,o){this.mermasService=t,this.firestore=o,this.reportes=[],this.totalPerdida=0,this.totalCostoPerdida=0,this.productoMayorMerma=null,this.subscriptions=new v.yU}ngOnInit(){this.cargarReportes()}ngOnDestroy(){this.subscriptions.unsubscribe()}cargarReportes(){const t=(0,g.collection)(this.firestore,"productos"),o=(0,g.collectionData)(t,{idField:"id"}),r=this.mermasService.getMermasActivas();this.subscriptions.add((0,se.z)([o,r]).subscribe(([i,s])=>{this.generarReportes(i,s)}))}generarReportes(t,o){this.reportes=[],t.forEach(r=>{const i=o.find(s=>s.productoId===r.id);if(i&&r.cantidad>0){const s=this.mermasService.calcularPerdida(r.cantidad,i.porcentajeMerma),c=this.mermasService.calcularCantidadUtil(r.cantidad,i.porcentajeMerma);this.reportes.push({producto:r,merma:i,cantidadComprada:r.cantidad,perdidaEstimada:s,cantidadUtil:c,costoTotal:r.cantidad*(r.costo||0),costoPerdida:s*(r.costo||0)})}}),this.calcularTotales()}calcularTotales(){this.totalPerdida=this.reportes.reduce((t,o)=>t+o.perdidaEstimada,0),this.totalCostoPerdida=this.reportes.reduce((t,o)=>t+o.costoPerdida,0),this.reportes.length>0&&(this.productoMayorMerma=this.reportes.reduce((t,o)=>o.perdidaEstimada>t.perdidaEstimada?o:t))}exportarReporte(){console.log("Exportar reporte",this.reportes)}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(_.d),e.rXU(g.Firestore))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-reportes-mermas"]],decls:50,vars:12,consts:[[1,"container-fluid"],[1,"row","mb-4"],[1,"col-8"],["routerLink","/private/mermas",1,"btn","btn-link","text-decoration-none","ps-0","mb-2"],[1,"bi","bi-arrow-left","me-2"],[1,"text-muted"],[1,"col","text-end"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-download","me-2"],[1,"col-md-4","mb-3"],[1,"card","border-0","shadow-sm"],[1,"card-body","text-center"],[1,"bi","bi-box-seam","text-primary","fs-1","mb-2"],[1,"mb-0"],[1,"bi","bi-exclamation-triangle","text-warning","fs-1","mb-2"],[1,"bi","bi-currency-dollar","text-danger","fs-1","mb-2"],["class","row mb-4",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"card-body"],[1,"mb-3"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"card","border-0","shadow-sm","bg-danger","bg-opacity-10"],[1,"bi","bi-trophy","text-danger","me-2"],[1,"row","align-items-center"],[1,"col-md-4"],[1,"col-md-2","text-center"],[1,"text-muted","small"],[1,"mb-0","text-danger"],[1,"col-md-3","text-center"],[1,"text-center","py-5"],[1,"bi","bi-inbox","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"table-responsive"],[1,"table","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"table-secondary"],["colspan","4",1,"text-end"],[1,"text-end","text-danger"],[1,"badge","bg-warning","text-dark"],[1,"text-end","text-success"]],template:function(o,r){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.nrm(4,"i",4),e.EFF(5,"Volver a Mermas "),e.k0s(),e.j41(6,"h5"),e.EFF(7,"Reporte de Mermas"),e.k0s(),e.j41(8,"span",5),e.EFF(9,"An\xe1lisis del impacto de mermas en el inventario"),e.k0s()(),e.j41(10,"div",6)(11,"button",7),e.bIt("click",function(){return r.exportarReporte()}),e.nrm(12,"i",8),e.EFF(13," Exportar Reporte "),e.k0s()()(),e.j41(14,"div",1)(15,"div",9)(16,"div",10)(17,"div",11),e.nrm(18,"i",12),e.j41(19,"h3",13),e.EFF(20),e.k0s(),e.j41(21,"span",5),e.EFF(22,"Productos con Merma"),e.k0s()()()(),e.j41(23,"div",9)(24,"div",10)(25,"div",11),e.nrm(26,"i",14),e.j41(27,"h3",13),e.EFF(28),e.nI1(29,"number"),e.k0s(),e.j41(30,"span",5),e.EFF(31,"Total Unidades Perdidas"),e.k0s()()()(),e.j41(32,"div",9)(33,"div",10)(34,"div",11),e.nrm(35,"i",15),e.j41(36,"h3",13),e.EFF(37),e.nI1(38,"number"),e.k0s(),e.j41(39,"span",5),e.EFF(40,"Costo Total de P\xe9rdidas"),e.k0s()()()()(),e.DNE(41,de,30,12,"div",16),e.j41(42,"div",17)(43,"div",18)(44,"div",10)(45,"div",19)(46,"h6",20),e.EFF(47,"Detalle por Producto"),e.k0s(),e.DNE(48,ce,6,0,"div",21),e.DNE(49,me,34,9,"div",22),e.k0s()()()()()),2&o&&(e.R7$(20),e.JRh(r.reportes.length),e.R7$(8),e.JRh(e.i5U(29,6,r.totalPerdida,"1.1-1")),e.R7$(9),e.SpI("$",e.i5U(38,9,r.totalCostoPerdida,"1.2-2"),""),e.R7$(4),e.Y8G("ngIf",r.productoMayorMerma),e.R7$(7),e.Y8G("ngIf",0===r.reportes.length),e.R7$(1),e.Y8G("ngIf",r.reportes.length>0))},dependencies:[f.Wk,u.Sq,u.bT,u.QX],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;text-transform:uppercase;font-size:.75rem;letter-spacing:.5px;color:#6c757d;border-bottom:2px solid #dee2e6}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s ease}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#00000005}.table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-weight:600}.badge[_ngcontent-%COMP%]{font-weight:600;padding:.35em .65em}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}"]})}}return a})()}];let pe=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[f.iI.forChild(ue),f.iI]})}}return a})(),ge=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[pe,I.PrivateModule,u.MD,d.X1,d.YN]})}}return a})()}}]);