"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[765],{1765:(J,k,b)=>{b.r(k),b.d(k,{AlbaranesPageModule:()=>X});var x=b(7412),s=b(9417),h=b(177),y=b(5743),E=b(467),c=b(9173),A=b(8359),I=b(4572),j=b(8032),g=b.n(j),t=b(7705);function P(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",93)(1,"small",5),t.nrm(2,"i",94),t.EFF(3),t.j41(4,"button",95),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.limpiarFiltros())}),t.nrm(5,"i",96),t.EFF(6," Limpiar filtros "),t.k0s()()()}if(2&i){const e=t.XpG();t.R7$(3),t.Lme(" Mostrando ",e.albaranesFiltrados.length," de ",e.albaranes.length," albaranes ")}}function R(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",97)(1,"div",98),t.bIt("click",function(){const a=t.eBV(e).$implicit,n=t.XpG();return t.Njj(n.verDetalleAlbaran(a))}),t.j41(2,"div",18)(3,"div",99)(4,"div",100),t.nrm(5,"i",101),t.j41(6,"h5",66),t.EFF(7),t.k0s(),t.j41(8,"span",102),t.EFF(9),t.k0s()()(),t.j41(10,"div",69)(11,"strong"),t.EFF(12),t.k0s(),t.nrm(13,"br"),t.j41(14,"small",5),t.EFF(15),t.nI1(16,"date"),t.k0s()(),t.j41(17,"div",79)(18,"div",68)(19,"small",5),t.EFF(20,"Productos"),t.k0s(),t.j41(21,"div",103),t.EFF(22),t.k0s()(),t.j41(23,"div",68)(24,"small",5),t.EFF(25,"Total"),t.k0s(),t.j41(26,"div",104),t.EFF(27),t.nI1(28,"currency"),t.k0s()()()()()()}if(2&i){const e=l.$implicit,r=t.XpG();t.R7$(7),t.JRh(e.numero),t.R7$(1),t.HbH(r.getEstadoBadgeClass(e.estado)),t.R7$(1),t.SpI(" ",e.estado," "),t.R7$(3),t.JRh(e.proveedorNombre),t.R7$(3),t.JRh(t.i5U(16,8,e.fechaEmision,"dd/MM/yyyy")),t.R7$(7),t.JRh(e.productos.length),t.R7$(5),t.SpI(" ",t.ii3(28,11,e.total,"EUR","symbol","1.2-2")," ")}}function C(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",2)(1,"div",105),t.nrm(2,"i",106),t.j41(3,"h5",107),t.EFF(4,"No se encontraron albaranes"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Intenta ajustar los filtros de b\xfasqueda"),t.k0s(),t.j41(7,"button",108),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.limpiarFiltros())}),t.nrm(8,"i",109),t.EFF(9," Mostrar todos los albaranes "),t.k0s()()()}}function w(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",2)(1,"div",105),t.nrm(2,"i",110),t.j41(3,"h5",107),t.EFF(4,"No tienes albaranes creados"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Crea tu primer albar\xe1n para comenzar"),t.k0s(),t.j41(7,"button",6),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.abrirModalAlbaran())}),t.nrm(8,"i",111),t.EFF(9," Nuevo Albar\xe1n "),t.k0s()()()}}function S(i,l){if(1&i&&(t.j41(0,"div",5),t.nrm(1,"i",141),t.EFF(2),t.k0s()),2&i){const e=t.XpG(2);t.R7$(2),t.SpI(" CIF: ",e.albaranSeleccionado.proveedorCif," ")}}function D(i,l){if(1&i&&(t.j41(0,"tr")(1,"td")(2,"div",103),t.EFF(3),t.k0s(),t.j41(4,"small",5),t.EFF(5),t.k0s()(),t.j41(6,"td",136)(7,"span",142),t.EFF(8),t.k0s()(),t.j41(9,"td",43),t.EFF(10),t.nI1(11,"currency"),t.k0s(),t.j41(12,"td",143),t.EFF(13),t.nI1(14,"currency"),t.k0s()()),2&i){const e=l.$implicit,r=t.XpG(2);t.R7$(3),t.SpI(" ",r.getProductoNombre(e.productoId)," "),t.R7$(2),t.JRh(r.getProductoDescripcion(e.productoId)),t.R7$(3),t.Lme("",e.cantidad," ",r.getProductoUnidad(e.productoId),""),t.R7$(2),t.SpI(" ",t.ii3(11,6,e.precioUnitario,"EUR","symbol","1.2-2")," "),t.R7$(3),t.SpI(" ",t.ii3(14,11,e.cantidad*e.precioUnitario,"EUR","symbol","1.2-2")," ")}}function T(i,l){if(1&i&&(t.j41(0,"div",144)(1,"div",18)(2,"h6",129),t.nrm(3,"i",145),t.EFF(4,"Observaciones "),t.k0s(),t.j41(5,"p",66),t.EFF(6),t.k0s()()()),2&i){const e=t.XpG(2);t.R7$(6),t.JRh(e.albaranSeleccionado.observaciones)}}function N(i,l){if(1&i&&(t.j41(0,"div",112)(1,"div",113)(2,"div",114)(3,"div",115)(4,"div",11),t.nrm(5,"i",116),t.j41(6,"h5",117),t.EFF(7),t.k0s(),t.j41(8,"small",5),t.EFF(9,"N\xfamero"),t.k0s()()()(),t.j41(10,"div",114)(11,"div",118)(12,"div",11),t.nrm(13,"i",119),t.j41(14,"h5",120),t.EFF(15),t.nI1(16,"date"),t.k0s(),t.j41(17,"small",5),t.EFF(18,"Fecha"),t.k0s()()()(),t.j41(19,"div",114)(20,"div",121)(21,"div",11),t.nrm(22,"i",122),t.j41(23,"h5",123),t.EFF(24),t.k0s(),t.j41(25,"small",5),t.EFF(26,"Productos"),t.k0s()()()(),t.j41(27,"div",114)(28,"div",124)(29,"div",11),t.nrm(30,"i",125),t.j41(31,"h5",126),t.EFF(32),t.nI1(33,"currency"),t.k0s(),t.j41(34,"small",5),t.EFF(35,"Total"),t.k0s()()()()(),t.j41(36,"div",64)(37,"div",18)(38,"h6",69),t.nrm(39,"i",127),t.EFF(40,"Informaci\xf3n del Proveedor "),t.k0s(),t.j41(41,"div",1)(42,"div",128)(43,"div",129)(44,"strong"),t.EFF(45),t.k0s()(),t.DNE(46,S,3,1,"div",130),t.k0s(),t.j41(47,"div",128)(48,"div",5),t.nrm(49,"i",131),t.EFF(50),t.nI1(51,"date"),t.k0s()()()()(),t.j41(52,"div",85)(53,"div",18)(54,"h6",69),t.nrm(55,"i",132),t.EFF(56,"Productos del Albar\xe1n "),t.k0s(),t.j41(57,"div",133)(58,"table",134)(59,"thead",135)(60,"tr")(61,"th"),t.EFF(62,"Producto"),t.k0s(),t.j41(63,"th",136),t.EFF(64,"Cantidad"),t.k0s(),t.j41(65,"th",43),t.EFF(66,"Precio Unit."),t.k0s(),t.j41(67,"th",43),t.EFF(68,"Subtotal"),t.k0s()()(),t.j41(69,"tbody"),t.DNE(70,D,15,16,"tr",137),t.k0s(),t.j41(71,"tfoot",135)(72,"tr")(73,"td",138),t.EFF(74,"Total:"),t.k0s(),t.j41(75,"td",139),t.EFF(76),t.nI1(77,"currency"),t.k0s()()()()()()(),t.DNE(78,T,7,1,"div",140),t.k0s()),2&i){const e=t.XpG();t.R7$(7),t.SpI(" ",e.albaranSeleccionado.numero," "),t.R7$(8),t.SpI(" ",t.i5U(16,10,e.albaranSeleccionado.fechaEmision,"dd/MM")," "),t.R7$(9),t.SpI(" ",e.albaranSeleccionado.productos.length||0," "),t.R7$(8),t.SpI(" ",t.ii3(33,13,e.albaranSeleccionado.total,"EUR","symbol","1.0-0")," "),t.R7$(13),t.JRh(e.albaranSeleccionado.proveedorNombre||"Proveedor no encontrado"),t.R7$(1),t.Y8G("ngIf",e.albaranSeleccionado.proveedorCif),t.R7$(4),t.SpI(" Entrega: ",t.i5U(51,18,e.albaranSeleccionado.fechaEntrega,"dd/MM/yyyy")," "),t.R7$(20),t.Y8G("ngForOf",e.albaranSeleccionado.productos),t.R7$(6),t.SpI(" ",t.ii3(77,21,e.albaranSeleccionado.total,"EUR","symbol","1.2-2")," "),t.R7$(2),t.Y8G("ngIf",e.albaranSeleccionado.observaciones)}}function M(i,l){if(1&i&&(t.j41(0,"option",146),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function O(i,l){if(1&i&&(t.j41(0,"div",1)(1,"div",151)(2,"small",5),t.EFF(3),t.k0s()(),t.j41(4,"div",68)(5,"small",103),t.EFF(6),t.nI1(7,"currency"),t.k0s()()()),2&i){const e=l.$implicit;t.R7$(3),t.SpI("IVA ",e.porcentaje,"%:"),t.R7$(3),t.JRh(t.ii3(7,2,e.importe,"EUR","symbol","1.2-2"))}}function G(i,l){if(1&i&&(t.j41(0,"div",69)(1,"div",147)(2,"h6",148),t.EFF(3,"Desglose de IVA"),t.k0s(),t.DNE(4,O,8,7,"div",149),t.nrm(5,"hr",150),t.j41(6,"div",1)(7,"div",151)(8,"strong"),t.EFF(9,"Total IVA:"),t.k0s()(),t.j41(10,"div",68)(11,"strong"),t.EFF(12),t.nI1(13,"currency"),t.k0s()()()()()),2&i){const e=t.XpG();t.R7$(4),t.Y8G("ngForOf",e.ivaBreakdown),t.R7$(8),t.JRh(t.ii3(13,2,e.ivaAlbaran,"EUR","symbol","1.2-2"))}}function U(i,l){1&i&&(t.j41(0,"div",152),t.nrm(1,"i",153),t.j41(2,"p",154),t.EFF(3," Selecciona un proveedor para agregar productos "),t.k0s()())}function B(i,l){if(1&i&&(t.j41(0,"option",146),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function V(i,l){if(1&i){const e=t.RV6();t.j41(0,"tr",159)(1,"td")(2,"select",160),t.bIt("change",function(){const a=t.eBV(e).index,n=t.XpG(2);return t.Njj(n.onProductoChange(a))}),t.j41(3,"option",27),t.EFF(4,"Seleccionar producto"),t.k0s(),t.DNE(5,B,2,2,"option",74),t.k0s()(),t.j41(6,"td")(7,"input",161),t.bIt("input",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.calcularTotales())}),t.k0s()(),t.j41(8,"td")(9,"input",162),t.bIt("input",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.calcularTotales())}),t.k0s()(),t.j41(10,"td")(11,"span",103),t.EFF(12),t.nI1(13,"currency"),t.k0s()(),t.j41(14,"td")(15,"span",163),t.EFF(16),t.nI1(17,"currency"),t.k0s()(),t.j41(18,"td")(19,"span",164),t.EFF(20),t.nI1(21,"currency"),t.k0s()(),t.j41(22,"td")(23,"button",165),t.bIt("click",function(){const a=t.eBV(e).index,n=t.XpG(2);return t.Njj(n.eliminarProducto(a))}),t.nrm(24,"i",166),t.k0s()()()}if(2&i){const e=l.index,r=t.XpG(2);t.Y8G("formGroupName",e),t.R7$(5),t.Y8G("ngForOf",r.productosProveedor),t.R7$(7),t.JRh(t.ii3(13,5,r.getProductoSubtotal(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(17,10,r.getProductoIvaImporte(e),"EUR","symbol","1.2-2")),t.R7$(4),t.JRh(t.ii3(21,15,r.getProductoTotal(e),"EUR","symbol","1.2-2"))}}function z(i,l){if(1&i&&(t.j41(0,"div",133)(1,"table",155)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"Producto"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Cantidad"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Precio Unit."),t.k0s(),t.j41(10,"th"),t.EFF(11,"Subtotal"),t.k0s(),t.j41(12,"th"),t.EFF(13,"IVA"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Total"),t.k0s(),t.nrm(16,"th",156),t.k0s()(),t.j41(17,"tbody",157),t.DNE(18,V,25,20,"tr",158),t.k0s()()()),2&i){const e=t.XpG();t.R7$(18),t.Y8G("ngForOf",e.productosFormArray.controls)}}const Y=[{path:"",component:(()=>{class i{constructor(e,r){this.fb=e,this.firestore=r,this.albaranes=[],this.albaranesFiltrados=[],this.albaranSeleccionado=null,this.productos=[],this.productosProveedor=[],this.proveedores=[],this.configuracionEmpresa=null,this.estadisticas={totalAlbaranes:0,recibidos:0,pendientes:0,valorTotal:0},this.filtros={busqueda:"",estado:""},this.modoEdicion=!1,this.albaranEditando=null,this.subtotalAlbaran=0,this.ivaAlbaran=0,this.totalAlbaran=0,this.ivaBreakdown=[],this.subscriptions=new A.yU,this.inicializarForm()}ngOnInit(){this.cargarDatos(),this.cargarConfiguracionEmpresa()}ngOnDestroy(){this.subscriptions.unsubscribe()}inicializarForm(){this.albaranForm=this.fb.group({numero:["",[s.k0.required]],proveedorId:["",[s.k0.required]],estado:["Pendiente",[s.k0.required]],fechaEmision:[this.formatDateForInput(new Date),[s.k0.required]],fechaEntrega:[this.formatDateForInput(new Date),[s.k0.required]],recibidoPor:[""],observaciones:[""],productos:this.fb.array([])})}get productosFormArray(){return this.albaranForm.get("productos")}formatDateForInput(e){return e.toISOString().split("T")[0]}cargarDatos(){const e=(0,c.collection)(this.firestore,"albaranes"),r=(0,c.collection)(this.firestore,"productos"),o=(0,c.collection)(this.firestore,"proveedores");this.subscriptions.add((0,I.z)([(0,c.collectionData)(e,{idField:"id"}),(0,c.collectionData)(r,{idField:"id"}),(0,c.collectionData)(o,{idField:"id"})]).subscribe(([a,n,p])=>{this.albaranes=a.map(d=>({...d,fechaEmision:d.fechaEmision?.toDate?d.fechaEmision.toDate():new Date(d.fechaEmision),fechaEntrega:d.fechaEntrega?.toDate?d.fechaEntrega.toDate():new Date(d.fechaEntrega)})),this.productos=n.filter(d=>!d.esCombinado),this.proveedores=p,this.actualizarNombresProveedores(),this.actualizarNombresProductos(),this.calcularEstadisticas(),this.aplicarFiltros()}))}cargarConfiguracionEmpresa(){const e=(0,c.collection)(this.firestore,"configuracion"),r=(0,c.query)(e,(0,c.limit)(1));this.subscriptions.add((0,c.collectionData)(r,{idField:"id"}).subscribe(o=>{o.length>0&&(this.configuracionEmpresa=o[0])}))}actualizarNombresProveedores(){this.albaranes.forEach(e=>{const r=this.proveedores.find(o=>o.id===e.proveedorId);r&&(e.proveedorNombre=r.nombre,e.proveedorCif=r.cif)})}actualizarNombresProductos(){this.albaranes.forEach(e=>{e.productos&&e.productos.forEach(r=>{const o=this.productos.find(a=>a.id===r.productoId);o&&(r.productoNombre=o.nombre,r.IVA=o.IVA)})})}calcularEstadisticas(){this.estadisticas={totalAlbaranes:this.albaranes.length,recibidos:this.albaranes.filter(e=>"Recibido"===e.estado).length,pendientes:this.albaranes.filter(e=>"Pendiente"===e.estado).length,valorTotal:this.albaranes.reduce((e,r)=>e+(r.total||0),0)}}aplicarFiltros(){let e=[...this.albaranes];if(this.filtros.busqueda.trim()){const r=this.filtros.busqueda.toLowerCase().trim();e=e.filter(o=>o.numero.toLowerCase().includes(r)||(o.proveedorNombre||"").toLowerCase().includes(r)||(o.proveedorCif||"").toLowerCase().includes(r))}this.filtros.estado&&(e=e.filter(r=>r.estado===this.filtros.estado)),this.albaranesFiltrados=e}limpiarFiltros(){this.filtros={busqueda:"",estado:""},this.aplicarFiltros()}getEstadoBadgeClass(e){switch(e){case"Recibido":return"bg-success";case"Parcial":return"bg-warning text-dark";default:return"bg-secondary"}}getIvaBreakdown(e){const r=new Map;return e.productos&&e.productos.forEach(o=>{const n=this.productos.find(u=>u.id===o.productoId)?.IVA||o.IVA||0,d=o.cantidad*o.precioUnitario*(n/100),f=r.get(n)||0;r.set(n,f+d)}),Array.from(r.entries()).map(([o,a])=>({porcentaje:o,importe:a})).sort((o,a)=>o.porcentaje-a.porcentaje)}abrirModalAlbaran(){this.modoEdicion=!1,this.albaranEditando=null,this.albaranForm.reset(),this.productosFormArray.clear(),this.productosProveedor=[],this.subtotalAlbaran=0,this.ivaAlbaran=0,this.totalAlbaran=0,this.ivaBreakdown=[];const e=this.generarNumeroAlbaran();this.albaranForm.patchValue({numero:e,estado:"Pendiente",fechaEmision:this.formatDateForInput(new Date),fechaEntrega:this.formatDateForInput(new Date)}),$("#modalAlbaran").modal("show")}generarNumeroAlbaran(){return`ALB-${(new Date).getFullYear()}-${(this.albaranes.length+1).toString().padStart(3,"0")}`}editarAlbaran(e){this.modoEdicion=!0,this.albaranEditando=e,this.albaranForm.patchValue({numero:e.numero,proveedorId:e.proveedorId,estado:e.estado,fechaEmision:this.formatDateForInput(e.fechaEmision),fechaEntrega:this.formatDateForInput(e.fechaEntrega),recibidoPor:e.recibidoPor||"",observaciones:e.observaciones||""}),this.onProveedorChange(),this.productosFormArray.clear(),e.productos&&e.productos.forEach(r=>{this.productosFormArray.push(this.fb.group({productoId:[r.productoId,s.k0.required],cantidad:[r.cantidad,[s.k0.required,s.k0.min(1)]],precioUnitario:[r.precioUnitario,[s.k0.required,s.k0.min(0)]]}))}),this.calcularTotales(),$("#modalAlbaran").modal("show")}verAlbaran(e){g().fire({title:"Opciones del Albar\xe1n",html:`\n        <div class="text-start">\n          <p class="mb-3">\xbfQu\xe9 deseas hacer con el albar\xe1n <strong>"${e.numero}"</strong>?</p>\n        </div>\n      `,showCancelButton:!0,showDenyButton:!0,confirmButtonText:'<i class="bi bi-printer me-1"></i> Imprimir',denyButtonText:'<i class="bi bi-eye me-1"></i> Ver Detalles',cancelButtonText:"Cancelar",confirmButtonColor:"#0d6efd",denyButtonColor:"#6c757d"}).then(r=>{r.isConfirmed?this.imprimirAlbaran(e):r.isDenied&&this.mostrarDetallesAlbaran(e)})}mostrarDetallesAlbaran(e){const r=e.productos?.map(o=>`<li>${o.productoNombre}: ${o.cantidad} unidades - ${o.precioUnitario.toFixed(2)}\u20ac/u</li>`).join("")||"";g().fire({title:e.numero,html:`\n        <div class="text-start">\n          <p><strong>Proveedor:</strong> ${e.proveedorNombre}</p>\n          <p><strong>CIF:</strong> ${e.proveedorCif}</p>\n          <p><strong>Estado:</strong> <span class="badge ${this.getEstadoBadgeClass(e.estado)}">${e.estado}</span></p>\n          <p><strong>Fecha Emisi\xf3n:</strong> ${e.fechaEmision.toLocaleDateString()}</p>\n          <p><strong>Fecha Entrega:</strong> ${e.fechaEntrega.toLocaleDateString()}</p>\n          <p><strong>Total:</strong> ${e.total.toFixed(2)}\u20ac</p>\n          ${e.recibidoPor?`<p><strong>Recibido por:</strong> ${e.recibidoPor}</p>`:""}\n          ${e.observaciones?`<p><strong>Observaciones:</strong> ${e.observaciones}</p>`:""}\n          <p><strong>Productos:</strong></p>\n          <ul>${r}</ul>\n        </div>\n      `,width:600,confirmButtonText:"Cerrar"})}imprimirAlbaran(e){const r=this.proveedores.find(m=>m.id===e.proveedorId),o=(new Date).toLocaleDateString("es-ES"),a=e.productos?.map((m,q)=>`\n      <tr>\n        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">${q+1}</td>\n        <td style="padding: 8px; border-bottom: 1px solid #ddd;">${m.productoNombre}</td>\n        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">${m.cantidad.toFixed(2)}</td>\n        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${m.precioUnitario.toFixed(2)}\u20ac</td>\n        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${(m.cantidad*m.precioUnitario).toFixed(2)}\u20ac</td>\n      </tr>\n    `).join("")||"",n=this.configuracionEmpresa?.nombreRestaurante||"Tu Empresa S.L.",p=this.configuracionEmpresa?.direccion||"Direcci\xf3n de tu empresa",d=`${this.configuracionEmpresa?.ciudad||"Ciudad"}, ${this.configuracionEmpresa?.codigoPostal||"CP"} - ${this.configuracionEmpresa?.provincia||"Provincia"}`,f=this.configuracionEmpresa?.cif||"B12345678",u=this.configuracionEmpresa?.telefono||"123 456 789",_=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <title>Albar\xe1n ${e.numero}</title>\n        <style>\n          @media print {\n            body { margin: 0; }\n            .no-print { display: none; }\n          }\n          body {\n            font-family: Arial, sans-serif;\n            font-size: 12px;\n            line-height: 1.4;\n            color: #333;\n            max-width: 210mm;\n            margin: 0 auto;\n            padding: 20px;\n          }\n          .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 30px;\n            border-bottom: 2px solid #333;\n            padding-bottom: 20px;\n          }\n          .company-info {\n            flex: 1;\n          }\n          .company-name {\n            font-size: 18px;\n            font-weight: bold;\n            color: #2c5aa0;\n            margin-bottom: 5px;\n          }\n          .company-details {\n            font-size: 11px;\n            color: #666;\n            line-height: 1.3;\n          }\n          .document-info {\n            text-align: right;\n            flex: 1;\n          }\n          .document-title {\n            font-size: 24px;\n            font-weight: bold;\n            color: #333;\n            margin-bottom: 10px;\n          }\n          .document-number {\n            font-size: 14px;\n            font-weight: bold;\n            background: #f0f0f0;\n            padding: 5px 10px;\n            border: 1px solid #ddd;\n          }\n          .parties {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 30px;\n          }\n          .party {\n            flex: 1;\n            margin-right: 20px;\n          }\n          .party:last-child {\n            margin-right: 0;\n          }\n          .party-title {\n            font-weight: bold;\n            font-size: 13px;\n            margin-bottom: 8px;\n            color: #2c5aa0;\n            border-bottom: 1px solid #ddd;\n            padding-bottom: 3px;\n          }\n          .party-details {\n            font-size: 11px;\n            line-height: 1.4;\n          }\n          .dates-info {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 20px;\n            background: #f8f9fa;\n            padding: 15px;\n            border: 1px solid #ddd;\n          }\n          .date-item {\n            text-align: center;\n          }\n          .date-label {\n            font-size: 10px;\n            color: #666;\n            margin-bottom: 3px;\n          }\n          .date-value {\n            font-weight: bold;\n            font-size: 12px;\n          }\n          .products-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n          }\n          .products-table th {\n            background: #2c5aa0;\n            color: white;\n            padding: 10px 8px;\n            text-align: left;\n            font-size: 11px;\n            font-weight: bold;\n          }\n          .products-table th:nth-child(1) { text-align: center; width: 5%; }\n          .products-table th:nth-child(2) { width: 50%; }\n          .products-table th:nth-child(3) { text-align: center; width: 15%; }\n          .products-table th:nth-child(4) { text-align: right; width: 15%; }\n          .products-table th:nth-child(5) { text-align: right; width: 15%; }\n          .products-table td {\n            padding: 8px;\n            border-bottom: 1px solid #ddd;\n            font-size: 11px;\n          }\n          .totals {\n            float: right;\n            width: 300px;\n            margin-bottom: 30px;\n          }\n          .totals table {\n            width: 100%;\n            border-collapse: collapse;\n          }\n          .totals td {\n            padding: 8px 12px;\n            border: 1px solid #ddd;\n            font-size: 12px;\n          }\n          .totals .label {\n            background: #f8f9fa;\n            font-weight: bold;\n            text-align: right;\n            width: 60%;\n          }\n          .totals .value {\n            text-align: right;\n            width: 40%;\n          }\n          .totals .total-row {\n            background: #2c5aa0;\n            color: white;\n            font-weight: bold;\n            font-size: 14px;\n          }\n          .signature-section {\n            clear: both;\n            margin-top: 50px;\n            border-top: 1px solid #ddd;\n            padding-top: 30px;\n          }\n          .signature-boxes {\n            display: flex;\n            justify-content: space-between;\n            margin-top: 30px;\n          }\n          .signature-box {\n            width: 45%;\n            text-align: center;\n          }\n          .signature-line {\n            border-bottom: 1px solid #333;\n            height: 60px;\n            margin-bottom: 10px;\n          }\n          .signature-label {\n            font-size: 11px;\n            font-weight: bold;\n          }\n          .observations {\n            margin: 20px 0;\n            padding: 15px;\n            background: #f8f9fa;\n            border-left: 4px solid #2c5aa0;\n          }\n          .observations-title {\n            font-weight: bold;\n            margin-bottom: 8px;\n            color: #2c5aa0;\n          }\n          .print-button {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #2c5aa0;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 14px;\n          }\n          .print-button:hover {\n            background: #1e3d6f;\n          }\n        </style>\n      </head>\n      <body>\n        <button class="print-button no-print" onclick="window.print()">\n          \u{1f5a8}\ufe0f Imprimir\n        </button>\n\n        <div class="header">\n          <div class="company-info">\n            <div class="company-name">${n}</div>\n            <div class="company-details">\n              ${p}<br>\n              ${d}<br>\n              CIF: ${f}<br>\n              Tel: ${u}<br>\n              Email: ${this.configuracionEmpresa?.email||"info@tuempresa.com"}\n            </div>\n          </div>\n          <div class="document-info">\n            <div class="document-title">ALBAR\xc1N</div>\n            <div class="document-number">${e.numero}</div>\n          </div>\n        </div>\n\n        <div class="parties">\n          <div class="party">\n            <div class="party-title">PROVEEDOR</div>\n            <div class="party-details">\n              <strong>${r?.nombre||e.proveedorNombre}</strong><br>\n              ${r?.razonSocial?`${r.razonSocial}<br>`:""}\n              ${r?.direccion?.calle||"Direcci\xf3n no disponible"}<br>\n              ${r?.direccion?.codigoPostal||""} ${r?.direccion?.ciudad||""}<br>\n              ${r?.direccion?.provincia?`${r.direccion.provincia}<br>`:""}\n              CIF: ${r?.cif||e.proveedorCif}<br>\n              ${r?.contacto?.telefono?`Tel: ${r.contacto.telefono}<br>`:""}\n              ${r?.contacto?.email?`Email: ${r.contacto.email}<br>`:""}\n              ${r?.contacto?.nombre?`Contacto: ${r.contacto.nombre}`:""}\n            </div>\n          </div>\n          <div class="party">\n            <div class="party-title">DESTINATARIO</div>\n            <div class="party-details">\n              <strong>${n}</strong><br>\n              ${p}<br>\n              ${d}<br>\n              CIF: ${f}<br>\n              Tel: ${u}\n            </div>\n          </div>\n        </div>\n\n        <div class="dates-info">\n          <div class="date-item">\n            <div class="date-label">FECHA EMISI\xd3N</div>\n            <div class="date-value">${e.fechaEmision.toLocaleDateString("es-ES")}</div>\n          </div>\n          <div class="date-item">\n            <div class="date-label">FECHA ENTREGA</div>\n            <div class="date-value">${e.fechaEntrega.toLocaleDateString("es-ES")}</div>\n          </div>\n          <div class="date-item">\n            <div class="date-label">ESTADO</div>\n            <div class="date-value">${e.estado}</div>\n          </div>\n          <div class="date-item">\n            <div class="date-label">FECHA IMPRESI\xd3N</div>\n            <div class="date-value">${o}</div>\n          </div>\n        </div>\n\n        <table class="products-table">\n          <thead>\n            <tr>\n              <th>#</th>\n              <th>DESCRIPCI\xd3N</th>\n              <th>CANTIDAD</th>\n              <th>PRECIO UNIT.</th>\n              <th>TOTAL</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${a}\n          </tbody>\n        </table>\n\n        <div class="totals">\n          <table>\n            <tr>\n              <td class="label">Subtotal:</td>\n              <td class="value">${e.subtotal.toFixed(2)}\u20ac</td>\n            </tr>\n            ${this.getIvaBreakdown(e).map(m=>`\n            <tr>\n              <td class="label">IVA ${m.porcentaje}%:</td>\n              <td class="value">${m.importe.toFixed(2)}\u20ac</td>\n            </tr>\n            `).join("")}\n            <tr class="total-row">\n              <td class="value">TOTAL:</td>\n              <td class="value">${e.total.toFixed(2)}\u20ac</td>\n            </tr>\n          </table>\n        </div>\n\n        ${e.observaciones?`\n        <div class="observations">\n          <div class="observations-title">OBSERVACIONES</div>\n          <div>${e.observaciones}</div>\n        </div>\n        `:""}\n\n        <div class="signature-section">\n          <div style="margin-bottom: 20px;">\n            <strong>Condiciones de entrega:</strong> Los productos han sido entregados en perfecto estado y seg\xfan las especificaciones acordadas.\n          </div>\n\n          <div class="signature-boxes">\n            <div class="signature-box">\n              <div class="signature-line"></div>\n              <div class="signature-label">FIRMA DEL PROVEEDOR</div>\n              <div style="font-size: 10px; margin-top: 5px;">\n                ${r?.nombre||e.proveedorNombre}<br>\n                Fecha: _______________\n              </div>\n            </div>\n            <div class="signature-box">\n              <div class="signature-line"></div>\n              <div class="signature-label">FIRMA DEL RECEPTOR</div>\n              <div style="font-size: 10px; margin-top: 5px;">\n                ${e.recibidoPor||"Nombre: _______________"}<br>\n                Fecha: _______________\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div style="margin-top: 30px; font-size: 10px; color: #666; text-align: center; border-top: 1px solid #ddd; padding-top: 15px;">\n          Este documento certifica la recepci\xf3n de los productos detallados en las condiciones especificadas.\n        </div>\n      </body>\n      </html>\n    `,F=window.open("","_blank");F&&(F.document.write(_),F.document.close(),F.focus())}eliminarAlbaran(e){var r=this;return(0,E.A)(function*(){if((yield g().fire({title:"\xbfEliminar albar\xe1n?",html:`\n        <div class="text-start">\n          <p>\xbfEst\xe1s seguro de que quieres eliminar el albar\xe1n <strong>"${e.numero}"</strong>?</p>\n          <div class="alert alert-warning">\n            <i class="bi bi-exclamation-triangle me-2"></i>\n            Esta acci\xf3n no se puede deshacer.\n          </div>\n        </div>\n      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed&&e.id)try{const a=(0,c.doc)(r.firestore,"albaranes",e.id);yield(0,c.deleteDoc)(a),g().fire({title:"\xa1Eliminado!",text:"El albar\xe1n ha sido eliminado correctamente.",icon:"success",timer:2e3,showConfirmButton:!1})}catch(a){console.error("Error al eliminar albar\xe1n:",a),g().fire("Error","No se pudo eliminar el albar\xe1n","error")}})()}onProveedorChange(){const e=this.albaranForm.get("proveedorId")?.value;this.productosProveedor=e?this.productos.filter(r=>r.proveedorId===e):[],this.modoEdicion||this.productosFormArray.clear()}agregarProducto(){const e=this.fb.group({productoId:["",s.k0.required],cantidad:[1,[s.k0.required,s.k0.min(1)]],precioUnitario:[0,[s.k0.required,s.k0.min(0)]]});this.productosFormArray.push(e)}eliminarProducto(e){this.productosFormArray.removeAt(e),this.calcularTotales()}onProductoChange(e){const r=this.productosFormArray.at(e).get("productoId")?.value,o=this.productos.find(a=>a.id===r);o&&(this.productosFormArray.at(e).patchValue({precioUnitario:o.costo}),this.calcularTotales())}getProductoSubtotal(e){const r=this.productosFormArray.at(e);return(r.get("cantidad")?.value||0)*(r.get("precioUnitario")?.value||0)}getProductoIvaImporte(e){const r=this.productosFormArray.at(e),o=r.get("productoId")?.value;return(r.get("cantidad")?.value||0)*(r.get("precioUnitario")?.value||0)*((this.productos.find(u=>u.id===o)?.IVA||0)/100)}getProductoTotal(e){return this.getProductoSubtotal(e)+this.getProductoIvaImporte(e)}getProductoIva(e){const r=this.productosFormArray.at(e).get("productoId")?.value;return this.productos.find(a=>a.id===r)?.IVA||0}calcularTotales(){this.subtotalAlbaran=0;let e=0;const r=new Map;for(let o=0;o<this.productosFormArray.length;o++){const a=this.productosFormArray.at(o),n=a.get("productoId")?.value,p=a.get("cantidad")?.value||0,d=a.get("precioUnitario")?.value||0,u=this.productos.find(m=>m.id===n)?.IVA||0,v=p*d,_=v*(u/100);this.subtotalAlbaran+=v,e+=_;const F=r.get(u)||0;r.set(u,F+_)}this.ivaAlbaran=e,this.totalAlbaran=this.subtotalAlbaran+this.ivaAlbaran,this.ivaBreakdown=Array.from(r.entries()).map(([o,a])=>({porcentaje:o,importe:a})).sort((o,a)=>o.porcentaje-a.porcentaje)}guardarAlbaran(){var e=this;return(0,E.A)(function*(){if(!e.albaranForm.valid)return void g().fire("Error","Por favor completa todos los campos requeridos","error");if(0===e.productosFormArray.length)return void g().fire("Error","Debes agregar al menos un producto","error");const r=e.albaranForm.value,o=r.productos.map(n=>{const d=e.productos.find(v=>v.id===n.productoId)?.IVA||0,f=n.cantidad*n.precioUnitario;return{productoId:n.productoId,cantidad:n.cantidad,precioUnitario:n.precioUnitario,total:f+f*(d/100),IVA:d}}),a={numero:r.numero,proveedorId:r.proveedorId,estado:r.estado,fechaEmision:new Date(r.fechaEmision),fechaEntrega:new Date(r.fechaEntrega),recibidoPor:r.recibidoPor,observaciones:r.observaciones,productos:o,subtotal:e.subtotalAlbaran,iva:e.ivaAlbaran,total:e.totalAlbaran,fechaActualizacion:new Date};try{if(e.modoEdicion&&e.albaranEditando?.id){const n=(0,c.doc)(e.firestore,"albaranes",e.albaranEditando.id);yield(0,c.updateDoc)(n,e.cleanObjectForFirebase(a)),g().fire("\xa1\xc9xito!","Albar\xe1n actualizado correctamente","success")}else{a.fechaCreacion=new Date;const n=(0,c.collection)(e.firestore,"albaranes");yield(0,c.addDoc)(n,e.cleanObjectForFirebase(a)),g().fire("\xa1\xc9xito!","Albar\xe1n creado correctamente","success")}e.cerrarModal()}catch(n){console.error("Error al guardar albar\xe1n:",n),g().fire("Error","No se pudo guardar el albar\xe1n","error")}})()}cerrarModal(){$("#modalAlbaran").modal("hide"),this.albaranForm.reset(),this.productosFormArray.clear(),this.modoEdicion=!1,this.albaranEditando=null,this.productosProveedor=[],this.ivaBreakdown=[]}cleanObjectForFirebase(e){const r={};for(const o in e)null!=e[o]&&(r[o]=e[o]instanceof Date||"object"!=typeof e[o]||Array.isArray(e[o])?e[o]:this.cleanObjectForFirebase(e[o]));return r}verDetalleAlbaran(e){this.albaranSeleccionado=e,$("#detalleAlbaranModal").modal("show")}editarDesdeDetalle(){this.albaranSeleccionado&&($("#detalleAlbaranModal").modal("hide"),setTimeout(()=>{this.editarAlbaran(this.albaranSeleccionado)},300))}eliminarDesdeDetalle(){var e=this;return(0,E.A)(function*(){e.albaranSeleccionado&&($("#detalleAlbaranModal").modal("hide"),setTimeout((0,E.A)(function*(){yield e.eliminarAlbaran(e.albaranSeleccionado)}),300))})()}imprimirDesdeDetalle(){this.albaranSeleccionado&&this.imprimirAlbaran(this.albaranSeleccionado)}getProductoNombre(e){return this.productos.find(o=>o.id===e)?.nombre||"Producto no encontrado"}getProductoDescripcion(e){return this.productos.find(o=>o.id===e)?.descripcion||""}getProductoUnidad(e){return this.productos.find(o=>o.id===e)?.unidadMedida||""}getProveedorCompleto(e){return this.proveedores.find(r=>r.id===e)}static{this.\u0275fac=function(r){return new(r||i)(t.rXU(s.ok),t.rXU(c.Firestore))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-albaranes-page"]],decls:195,vars:45,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus"],[1,"row","mt-4"],[1,"col-12","col-md-6","col-xl-3","mb-4"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-body","text-center"],[1,"text-primary","fw-bold","mb-1"],[1,"text-muted","mb-0"],[1,"text-success","fw-bold","mb-1"],[1,"text-warning","fw-bold","mb-1"],[1,"text-info","fw-bold","mb-1"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-body"],[1,"row","g-3"],[1,"col-12","col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Buscar albaranes...",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"col-12","col-md-4"],[1,"form-select",3,"ngModel","ngModelChange","change"],["value",""],["value","Pendiente"],["value","Parcial"],["value","Recibido"],["class","mt-3",4,"ngIf"],["class","col-12 col-lg-3 mb-4",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],["id","detalleAlbaranModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-xl"],[1,"modal-content"],[1,"modal-header","border-0","pb-0"],[1,"d-flex","align-items-center","w-100"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center","bg-primary","bg-opacity-10",2,"width","56px","height","56px"],[1,"bi","bi-file-earmark-text","text-primary","fs-3"],[1,"flex-grow-1"],[1,"text-muted","mb-0","small"],[1,"text-end"],[1,"badge","fs-6","px-3","py-2",3,"ngClass"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body pt-3",4,"ngIf"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-lg","me-2"],["type","button",1,"btn","btn-info",3,"click"],[1,"bi","bi-printer","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-fill","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[1,"bi","bi-trash3-fill","me-2"],["id","modalAlbaran","tabindex","-1","data-bs-backdrop","static",1,"modal","fade"],[1,"modal-dialog","modal-xl"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"col-12","col-lg-6"],[1,"card","border-0","bg-light","mb-4"],[1,"card-header","bg-transparent","border-0"],[1,"mb-0"],[1,"bi","bi-info-circle","me-2"],[1,"col-6"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","numero","placeholder","ALB-2025-001",1,"form-control"],["formControlName","estado",1,"form-select"],["formControlName","proveedorId",1,"form-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],["type","date","formControlName","fechaEmision",1,"form-control"],["type","date","formControlName","fechaEntrega",1,"form-control"],["type","text","formControlName","recibidoPor","placeholder","Nombre del receptor",1,"form-control"],[1,"bi","bi-calculator","me-2"],[1,"row","mb-3"],[1,"text-center","p-3","bg-warning","bg-opacity-10","rounded","mb-3"],["class","mb-3",4,"ngIf"],[1,"text-center","p-3","bg-danger","bg-opacity-10","rounded","mb-3"],[1,"mb-1","text-danger"],["rows","3","formControlName","observaciones","placeholder","Observaciones del albar\xe1n...",1,"form-control"],[1,"card","border-0","bg-light"],[1,"card-header","bg-transparent","border-0","d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-sm","btn-info",3,"disabled","click"],["class","text-center py-4 text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"mt-3"],[1,"bi","bi-funnel","me-1"],[1,"btn","btn-sm","btn-link","p-0","ms-2",3,"click"],[1,"bi","bi-x-circle"],[1,"col-12","col-lg-3","mb-4"],[1,"card","border-0","shadow-sm","h-100",2,"cursor","pointer",3,"click"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"d-flex","align-items-center"],[1,"bi","bi-file-earmark-text","text-muted","me-2"],[1,"badge","ms-2"],[1,"fw-bold"],[1,"fw-bold","text-danger"],[1,"text-center","py-5"],[1,"bi","bi-search","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-arrow-clockwise","me-1"],[1,"bi","bi-file-earmark-text","fs-1","text-muted"],[1,"bi","bi-plus","me-1"],[1,"modal-body","pt-3"],[1,"row","g-3","mb-4"],[1,"col-md-3"],[1,"card","border-0","bg-primary","bg-opacity-10","h-100"],[1,"bi","bi-hash","text-primary","fs-2","d-block","mb-2"],[1,"mb-0","text-primary"],[1,"card","border-0","bg-info","bg-opacity-10","h-100"],[1,"bi","bi-calendar","text-info","fs-2","d-block","mb-2"],[1,"mb-0","text-info"],[1,"card","border-0","bg-success","bg-opacity-10","h-100"],[1,"bi","bi-box-seam","text-success","fs-2","d-block","mb-2"],[1,"mb-0","text-success"],[1,"card","border-0","bg-warning","bg-opacity-10","h-100"],[1,"bi","bi-cash-coin","text-warning","fs-2","d-block","mb-2"],[1,"mb-0","text-warning"],[1,"bi","bi-building","me-2","text-primary"],[1,"col-md-6"],[1,"mb-2"],["class","text-muted",4,"ngIf"],[1,"bi","bi-calendar","me-1"],[1,"bi","bi-list-ul","me-2","text-primary"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],["colspan","3",1,"text-end","fw-bold"],[1,"text-end","fw-bold","fs-5","text-success"],["class","card border-0 bg-light mt-3",4,"ngIf"],[1,"bi","bi-card-text","me-1"],[1,"badge","bg-secondary"],[1,"text-end","fw-bold"],[1,"card","border-0","bg-light","mt-3"],[1,"bi","bi-chat-text","me-2","text-primary"],[3,"value"],[1,"p-3","bg-info","bg-opacity-10","rounded"],[1,"text-center","mb-2"],["class","row",4,"ngFor","ngForOf"],[1,"my-2"],[1,"col-6","text-end"],[1,"text-center","py-4","text-muted"],[1,"bi","bi-info-circle","fs-3"],[1,"mt-2"],[1,"table","table-borderless"],["width","50"],["formArrayName","productos"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["formControlName","productoId",1,"form-select",3,"change"],["type","number","formControlName","cantidad","min","0","step","1",1,"form-control",3,"input"],["type","number","formControlName","precioUnitario","min","0","step","0.01",1,"form-control",3,"input"],[1,"fw-bold","text-info"],[1,"fw-bold","text-success"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"]],template:function(r,o){if(1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h3",4),t.EFF(6,"Gesti\xf3n de Albaranes"),t.k0s(),t.j41(7,"span",5),t.EFF(8,"Administra los albaranes de entrega de proveedores"),t.k0s()(),t.j41(9,"button",6),t.bIt("click",function(){return o.abrirModalAlbaran()}),t.nrm(10,"i",7),t.EFF(11," Nuevo Albar\xe1n "),t.k0s()()()(),t.j41(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"h2",12),t.EFF(17),t.k0s(),t.j41(18,"p",13),t.EFF(19,"Total Albaranes"),t.k0s()()()(),t.j41(20,"div",9)(21,"div",10)(22,"div",11)(23,"h2",14),t.EFF(24),t.k0s(),t.j41(25,"p",13),t.EFF(26,"Recibidos"),t.k0s()()()(),t.j41(27,"div",9)(28,"div",10)(29,"div",11)(30,"h2",15),t.EFF(31),t.k0s(),t.j41(32,"p",13),t.EFF(33,"Pendientes"),t.k0s()()()(),t.j41(34,"div",9)(35,"div",10)(36,"div",11)(37,"h2",16),t.EFF(38),t.nI1(39,"currency"),t.k0s(),t.j41(40,"p",13),t.EFF(41,"Valor Total"),t.k0s()()()()(),t.j41(42,"div",8)(43,"div",2)(44,"div",17)(45,"div",18)(46,"div",19)(47,"div",20)(48,"div",21)(49,"span",22),t.nrm(50,"i",23),t.k0s(),t.j41(51,"input",24),t.bIt("ngModelChange",function(n){return o.filtros.busqueda=n})("input",function(){return o.aplicarFiltros()}),t.k0s()()(),t.j41(52,"div",25)(53,"select",26),t.bIt("ngModelChange",function(n){return o.filtros.estado=n})("change",function(){return o.aplicarFiltros()}),t.j41(54,"option",27),t.EFF(55,"Todos los estados"),t.k0s(),t.j41(56,"option",28),t.EFF(57,"Pendiente"),t.k0s(),t.j41(58,"option",29),t.EFF(59,"Parcial"),t.k0s(),t.j41(60,"option",30),t.EFF(61,"Recibido"),t.k0s()()()(),t.DNE(62,P,7,2,"div",31),t.k0s()()()(),t.j41(63,"div",1),t.DNE(64,R,29,16,"div",32),t.DNE(65,C,10,0,"div",33),t.DNE(66,w,10,0,"div",33),t.k0s()(),t.j41(67,"div",34)(68,"div",35)(69,"div",36)(70,"div",37)(71,"div",38)(72,"div",39),t.nrm(73,"i",40),t.k0s(),t.j41(74,"div",41)(75,"h4",4),t.EFF(76),t.k0s(),t.j41(77,"p",42),t.EFF(78),t.nI1(79,"date"),t.k0s()(),t.j41(80,"div",43)(81,"span",44),t.EFF(82),t.k0s()()(),t.nrm(83,"button",45),t.k0s(),t.DNE(84,N,79,26,"div",46),t.j41(85,"div",47)(86,"button",48),t.nrm(87,"i",49),t.EFF(88,"Cerrar "),t.k0s(),t.j41(89,"button",50),t.bIt("click",function(){return o.imprimirDesdeDetalle()}),t.nrm(90,"i",51),t.EFF(91,"Imprimir "),t.k0s(),t.j41(92,"button",52),t.bIt("click",function(){return o.editarDesdeDetalle()}),t.nrm(93,"i",53),t.EFF(94,"Editar "),t.k0s(),t.j41(95,"button",54),t.bIt("click",function(){return o.eliminarDesdeDetalle()}),t.nrm(96,"i",55),t.EFF(97,"Eliminar "),t.k0s()()()()(),t.j41(98,"div",56)(99,"div",57)(100,"div",36)(101,"div",58)(102,"h5",59),t.EFF(103),t.k0s(),t.j41(104,"button",60),t.bIt("click",function(){return o.cerrarModal()}),t.k0s()(),t.j41(105,"div",61)(106,"form",62),t.bIt("ngSubmit",function(){return o.guardarAlbaran()}),t.j41(107,"div",1)(108,"div",63)(109,"div",64)(110,"div",65)(111,"h6",66),t.nrm(112,"i",67),t.EFF(113," Informaci\xf3n del Albar\xe1n "),t.k0s()(),t.j41(114,"div",18)(115,"div",1)(116,"div",68)(117,"div",69)(118,"label",70),t.EFF(119,"N\xfamero de Albar\xe1n *"),t.k0s(),t.nrm(120,"input",71),t.k0s()(),t.j41(121,"div",68)(122,"div",69)(123,"label",70),t.EFF(124,"Estado"),t.k0s(),t.j41(125,"select",72)(126,"option",28),t.EFF(127,"Pendiente"),t.k0s(),t.j41(128,"option",29),t.EFF(129,"Parcial"),t.k0s(),t.j41(130,"option",30),t.EFF(131,"Recibido"),t.k0s()()()()(),t.j41(132,"div",69)(133,"label",70),t.EFF(134,"Proveedor *"),t.k0s(),t.j41(135,"select",73),t.bIt("change",function(){return o.onProveedorChange()}),t.j41(136,"option",27),t.EFF(137,"Seleccionar proveedor"),t.k0s(),t.DNE(138,M,2,2,"option",74),t.k0s()(),t.j41(139,"div",1)(140,"div",68)(141,"div",69)(142,"label",70),t.EFF(143,"Fecha de Emisi\xf3n *"),t.k0s(),t.nrm(144,"input",75),t.k0s()(),t.j41(145,"div",68)(146,"div",69)(147,"label",70),t.EFF(148,"Fecha de Entrega *"),t.k0s(),t.nrm(149,"input",76),t.k0s()()(),t.j41(150,"div",69)(151,"label",70),t.EFF(152,"Recibido por"),t.k0s(),t.nrm(153,"input",77),t.k0s()()()(),t.j41(154,"div",63)(155,"div",64)(156,"div",65)(157,"h6",66),t.nrm(158,"i",78),t.EFF(159," Resumen del Albar\xe1n "),t.k0s()(),t.j41(160,"div",18)(161,"div",79)(162,"div",2)(163,"div",80)(164,"h4",4),t.EFF(165),t.nI1(166,"currency"),t.k0s(),t.j41(167,"small",5),t.EFF(168,"Subtotal"),t.k0s()()()(),t.DNE(169,G,14,7,"div",81),t.j41(170,"div",82)(171,"h3",83),t.EFF(172),t.nI1(173,"currency"),t.k0s(),t.j41(174,"small",5),t.EFF(175,"Total"),t.k0s()(),t.j41(176,"div",69)(177,"label",70),t.EFF(178,"Observaciones"),t.k0s(),t.nrm(179,"textarea",84),t.k0s()()()()(),t.j41(180,"div",85)(181,"div",86)(182,"h6",66),t.EFF(183,"Productos del Albar\xe1n"),t.k0s(),t.j41(184,"button",87),t.bIt("click",function(){return o.agregarProducto()}),t.nrm(185,"i",7),t.EFF(186," Agregar Producto "),t.k0s()(),t.j41(187,"div",18),t.DNE(188,U,4,0,"div",88),t.DNE(189,z,19,1,"div",89),t.k0s()()()(),t.j41(190,"div",90)(191,"button",91),t.bIt("click",function(){return o.cerrarModal()}),t.EFF(192," Cancelar "),t.k0s(),t.j41(193,"button",92),t.bIt("click",function(){return o.guardarAlbaran()}),t.EFF(194),t.k0s()()()()()),2&r){let a,n,p;t.R7$(17),t.SpI(" ",o.estadisticas.totalAlbaranes," "),t.R7$(7),t.SpI(" ",o.estadisticas.recibidos," "),t.R7$(7),t.SpI(" ",o.estadisticas.pendientes," "),t.R7$(7),t.SpI(" ",t.ii3(39,27,o.estadisticas.valorTotal,"EUR","symbol","1.2-2")," "),t.R7$(13),t.Y8G("ngModel",o.filtros.busqueda),t.R7$(2),t.Y8G("ngModel",o.filtros.estado),t.R7$(9),t.Y8G("ngIf",o.filtros.busqueda||o.filtros.estado),t.R7$(2),t.Y8G("ngForOf",o.albaranesFiltrados),t.R7$(1),t.Y8G("ngIf",0===o.albaranesFiltrados.length&&o.albaranes.length>0),t.R7$(1),t.Y8G("ngIf",0===o.albaranes.length),t.R7$(10),t.SpI("Albar\xe1n ",null==o.albaranSeleccionado?null:o.albaranSeleccionado.numero,""),t.R7$(2),t.Lme(" ",t.i5U(79,32,null==o.albaranSeleccionado?null:o.albaranSeleccionado.fechaEmision,"dd/MM/yyyy")," - ",null==o.albaranSeleccionado?null:o.albaranSeleccionado.proveedorNombre," "),t.R7$(3),t.Y8G("ngClass",o.getEstadoBadgeClass((null==o.albaranSeleccionado?null:o.albaranSeleccionado.estado)||"")),t.R7$(1),t.SpI(" ",null==o.albaranSeleccionado?null:o.albaranSeleccionado.estado," "),t.R7$(2),t.Y8G("ngIf",o.albaranSeleccionado),t.R7$(19),t.SpI(" ",o.modoEdicion?"Editar":"Nuevo"," Albar\xe1n "),t.R7$(3),t.Y8G("formGroup",o.albaranForm),t.R7$(32),t.Y8G("ngForOf",o.proveedores),t.R7$(27),t.SpI(" ",t.ii3(166,35,o.subtotalAlbaran,"EUR","symbol","1.2-2")," "),t.R7$(4),t.Y8G("ngIf",o.ivaBreakdown.length>0),t.R7$(3),t.SpI(" ",t.ii3(173,40,o.totalAlbaran,"EUR","symbol","1.2-2")," "),t.R7$(12),t.Y8G("disabled",!(null!=(a=o.albaranForm.get("proveedorId"))&&a.value)),t.R7$(4),t.Y8G("ngIf",!(null!=(n=o.albaranForm.get("proveedorId"))&&n.value)),t.R7$(1),t.Y8G("ngIf",null==(p=o.albaranForm.get("proveedorId"))?null:p.value),t.R7$(4),t.Y8G("disabled",!o.albaranForm.valid),t.R7$(1),t.SpI(" ",o.modoEdicion?"Actualizar":"Crear"," Albar\xe1n ")}},dependencies:[h.YU,h.Sq,h.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.wz,s.BC,s.cb,s.VZ,s.j4,s.JD,s.$R,s.v8,s.vS,h.oe,h.vh],styles:[".product-list[_ngcontent-%COMP%]{max-height:120px;overflow-y:auto}.card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.modal-xl[_ngcontent-%COMP%]{max-width:1200px}.table-responsive[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.badge[_ngcontent-%COMP%]{font-size:.75em}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}.bg-opacity-10[_ngcontent-%COMP%]{background-color:rgba(var(--bs-success-rgb),.1)!important}.bg-warning.bg-opacity-10[_ngcontent-%COMP%]{background-color:rgba(var(--bs-warning-rgb),.1)!important}.bg-info.bg-opacity-10[_ngcontent-%COMP%]{background-color:rgba(var(--bs-info-rgb),.1)!important}.bg-danger.bg-opacity-10[_ngcontent-%COMP%]{background-color:rgba(var(--bs-danger-rgb),.1)!important}.albaran-card[_ngcontent-%COMP%]{border-left:4px solid #007bff;transition:all .3s ease}.albaran-card[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026!important}.albaran-pendiente[_ngcontent-%COMP%]{border-left-color:#6c757d}.albaran-parcial[_ngcontent-%COMP%]{border-left-color:#ffc107}.albaran-recibido[_ngcontent-%COMP%]{border-left-color:#198754}.summary-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);border-radius:.5rem;padding:1rem}.product-row[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:.5rem 0}.product-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.estado-badge[_ngcontent-%COMP%]{font-size:.8em;padding:.25em .6em}.total-highlight[_ngcontent-%COMP%]{font-size:1.1em;font-weight:700}.form-floating[_ngcontent-%COMP%]{position:relative}.input-group-text[_ngcontent-%COMP%]{background-color:#f8f9fa;border-color:#dee2e6}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:2px solid #dee2e6;font-weight:600;font-size:.875rem}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.alert-info[_ngcontent-%COMP%]{background-color:#d1ecf1;border-color:#bee5eb;color:#0c5460}.text-truncate-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}"]})}}return i})()}];let L=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[y.iI.forChild(Y),y.iI]})}}return i})(),X=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[L,x.PrivateModule,h.MD,s.X1,s.YN]})}}return i})()}}]);