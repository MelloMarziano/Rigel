"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[674],{2674:(H,h,c)=>{c.r(h),c.d(h,{MermasPageModule:()=>V});var v=c(7412),s=c(9417),m=c(177),b=c(5743),g=c(467),u=c(9173),M=c(8032),l=c.n(M),f=c(8359),e=c(7705),F=c(6239);function j(o,n){if(1&o&&(e.j41(0,"option",83),e.EFF(1),e.k0s()),2&o){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(1),e.SpI(" ",t.nombre," ")}}function E(o,n){if(1&o&&(e.j41(0,"div")(1,"small",41),e.nrm(2,"i",84),e.EFF(3),e.k0s()()),2&o){const t=e.XpG();e.R7$(3),e.Lme(" Mostrando ",t.mermasFiltradas.length," de ",t.mermas.length," mermas ")}}function k(o,n){1&o&&e.nrm(0,"i",85)}function _(o,n){1&o&&e.nrm(0,"i",86)}function P(o,n){1&o&&e.nrm(0,"i",85)}function C(o,n){1&o&&e.nrm(0,"i",87)}function R(o,n){1&o&&e.nrm(0,"i",88)}function I(o,n){1&o&&e.nrm(0,"i",87)}function y(o,n){1&o&&e.nrm(0,"i",89)}function $(o,n){1&o&&e.nrm(0,"i",90)}function x(o,n){1&o&&e.nrm(0,"i",89)}function S(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",91),e.nrm(1,"i",92),e.j41(2,"h5",93),e.EFF(3,"No hay mermas registradas"),e.k0s(),e.j41(4,"p",41),e.EFF(5,"Crea tu primera merma para comenzar"),e.k0s(),e.j41(6,"button",6),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.abrirModalNuevo())}),e.nrm(7,"i",94),e.EFF(8," Nueva Merma "),e.k0s()()}}function w(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",91),e.nrm(1,"i",95),e.j41(2,"h5",93),e.EFF(3,"No se encontraron resultados"),e.k0s(),e.j41(4,"p",41),e.EFF(5,"Intenta ajustar los filtros de b\xfasqueda"),e.k0s(),e.j41(6,"button",96),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.limpiarFiltros())}),e.nrm(7,"i",27),e.EFF(8," Limpiar filtros "),e.k0s()()}}function T(o,n){if(1&o){const t=e.RV6();e.j41(0,"div",97)(1,"div",98),e.bIt("click",function(){const i=e.eBV(t).$implicit,d=e.XpG();return e.Njj(d.verDetalleMerma(i))}),e.j41(2,"div",99)(3,"div",100)(4,"div",101),e.nrm(5,"i",102),e.k0s(),e.j41(6,"div",103)(7,"h6",104),e.EFF(8),e.k0s(),e.j41(9,"p",105),e.EFF(10),e.k0s()()(),e.j41(11,"div",69)(12,"div",106),e.nrm(13,"i",107),e.j41(14,"small",41),e.EFF(15,"Producto:"),e.k0s(),e.j41(16,"strong",108),e.EFF(17),e.k0s()()(),e.j41(18,"div",69)(19,"div",109)(20,"small",41),e.nrm(21,"i",110),e.EFF(22," Porcentaje de Merma "),e.k0s(),e.j41(23,"h4",111),e.EFF(24),e.k0s()(),e.j41(25,"div",112),e.nrm(26,"div",113),e.k0s()(),e.j41(27,"div",114)(28,"small",41),e.EFF(29,"Estado"),e.k0s(),e.j41(30,"span",115),e.nrm(31,"i",116),e.EFF(32),e.k0s()()()()()}if(2&o){const t=n.$implicit,a=e.XpG();e.R7$(8),e.JRh(t.nombre),e.R7$(2),e.JRh(t.descripcion||"Sin descripci\xf3n"),e.R7$(7),e.JRh(a.getProductoNombre(t.productoId)),e.R7$(7),e.SpI("",t.porcentajeMerma,"%"),e.R7$(2),e.xc7("width",t.porcentajeMerma,"%"),e.BMQ("aria-valuenow",t.porcentajeMerma),e.R7$(4),e.Y8G("ngClass",t.activo?"bg-success":"bg-secondary"),e.R7$(1),e.Y8G("ngClass",t.activo?"bi-check-circle":"bi-x-circle"),e.R7$(1),e.SpI(" ",t.activo?"Activo":"Inactivo"," ")}}function O(o,n){if(1&o&&(e.j41(0,"div",117)(1,"div",118)(2,"span",119),e.nrm(3,"i",116),e.EFF(4),e.k0s()(),e.j41(5,"div",120)(6,"div",11)(7,"h6",69),e.nrm(8,"i",107),e.EFF(9,"Producto Asociado"),e.k0s(),e.j41(10,"div",50),e.nrm(11,"i",121),e.j41(12,"div")(13,"strong",122),e.EFF(14),e.k0s(),e.j41(15,"small",41),e.EFF(16,"Producto afectado por esta merma"),e.k0s()()()()(),e.j41(17,"div",123)(18,"div",39),e.nrm(19,"i",124),e.j41(20,"h1",111),e.EFF(21),e.k0s(),e.j41(22,"small",41),e.EFF(23,"Porcentaje de Merma"),e.k0s(),e.j41(24,"div",125),e.nrm(25,"div",113),e.k0s()()(),e.j41(26,"div",126)(27,"div",11)(28,"h6",69),e.nrm(29,"i",127),e.EFF(30," Ejemplo de C\xe1lculo "),e.k0s(),e.j41(31,"div",128)(32,"strong"),e.EFF(33),e.k0s(),e.j41(34,"div",129)(35,"div",130)(36,"span"),e.EFF(37,"Cantidad comprada:"),e.k0s(),e.j41(38,"strong"),e.EFF(39),e.k0s()(),e.j41(40,"div",130)(41,"span"),e.EFF(42),e.k0s(),e.j41(43,"strong",71),e.EFF(44),e.nI1(45,"number"),e.k0s()(),e.nrm(46,"hr"),e.j41(47,"div",114)(48,"span")(49,"strong"),e.EFF(50,"Cantidad \xfatil:"),e.k0s()(),e.j41(51,"h5",131),e.EFF(52),e.nI1(53,"number"),e.k0s()()()()()()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("ngClass",t.mermaSeleccionada.activo?"bg-success":"bg-secondary"),e.R7$(1),e.Y8G("ngClass",t.mermaSeleccionada.activo?"bi-check-circle-fill":"bi-x-circle-fill"),e.R7$(1),e.SpI(" ",t.mermaSeleccionada.activo?"Activo":"Inactivo"," "),e.R7$(10),e.JRh(t.mermaSeleccionada.productoNombre),e.R7$(7),e.SpI("",t.mermaSeleccionada.porcentajeMerma,"%"),e.R7$(4),e.xc7("width",t.mermaSeleccionada.porcentajeMerma,"%"),e.BMQ("aria-valuenow",t.mermaSeleccionada.porcentajeMerma),e.R7$(8),e.E5c("Si compras ",t.getProductoCantidad(t.mermaSeleccionada.productoId)," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId)," y la merma es del ",t.mermaSeleccionada.porcentajeMerma,"%, tendr\xe1s:"),e.R7$(6),e.Lme("",t.getProductoCantidad(t.mermaSeleccionada.productoId)," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),""),e.R7$(3),e.SpI("P\xe9rdida por merma (",t.mermaSeleccionada.porcentajeMerma,"%):"),e.R7$(2),e.Lme("",e.i5U(45,18,t.calcularPerdida(t.getProductoCantidad(t.mermaSeleccionada.productoId),t.mermaSeleccionada.porcentajeMerma),"1.1-1")," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),""),e.R7$(8),e.Lme("",e.i5U(53,21,t.calcularUnidadesUtiles(t.getProductoCantidad(t.mermaSeleccionada.productoId),t.mermaSeleccionada.porcentajeMerma),"1.1-1")," ",t.getProductoUnidadMedida(t.mermaSeleccionada.productoId),"")}}function D(o,n){if(1&o&&(e.j41(0,"option",83),e.EFF(1),e.k0s()),2&o){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(1),e.SpI(" ",t.nombre," ")}}function G(o,n){if(1&o&&(e.j41(0,"div",132)(1,"h6",133),e.nrm(2,"i",134),e.EFF(3," Ejemplo de c\xe1lculo: "),e.k0s(),e.j41(4,"p",53),e.EFF(5," Si compras "),e.j41(6,"strong"),e.EFF(7,"100 unidades"),e.k0s(),e.EFF(8," y la merma es del "),e.j41(9,"strong"),e.EFF(10),e.k0s(),e.EFF(11,", tendr\xe1s "),e.j41(12,"strong",135),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.EFF(15,". "),e.k0s()()),2&o){const t=e.XpG();let a,r;e.R7$(10),e.SpI("",(null==(a=t.mermaForm.get("porcentajeMerma"))?null:a.value)||0,"%"),e.R7$(3),e.SpI("",e.i5U(14,2,t.calcularUnidadesUtiles(100,(null==(r=t.mermaForm.get("porcentajeMerma"))?null:r.value)||0),"1.1-1")," unidades \xfatiles")}}let N=(()=>{class o{constructor(t,a,r){this.fb=t,this.firestore=a,this.mermasService=r,this.mermas=[],this.mermasFiltradas=[],this.productos=[],this.mermaSeleccionada=null,this.totalMermas=0,this.mermasActivas=0,this.promedioMerma=0,this.cantidadEjemplo=100,this.filtroTexto="",this.filtroEstado="todos",this.filtroProducto="",this.ordenarPor="nombre",this.ordenDireccion="asc",this.subscriptions=new f.yU,this.inicializarForm()}ngOnInit(){this.cargarMermas(),this.cargarProductos();const t=document.getElementById("mermaModal");t&&(this.modal=new bootstrap.Modal(t));const a=document.getElementById("detalleMermaModal");a&&(this.detalleModal=new bootstrap.Modal(a)),this.mermaForm.get("porcentajeMerma")?.valueChanges.subscribe(()=>{this.actualizarEjemplo()})}ngOnDestroy(){this.subscriptions.unsubscribe()}inicializarForm(){this.mermaForm=this.fb.group({id:[""],productoId:["",s.k0.required],nombre:["",s.k0.required],descripcion:[""],porcentajeMerma:[0,[s.k0.required,s.k0.min(0),s.k0.max(100)]],activo:[!0]})}cargarMermas(){this.subscriptions.add(this.mermasService.getMermas().subscribe(t=>{this.mermas=t,this.aplicarFiltros(),this.calcularEstadisticas()}))}cargarProductos(){const t=(0,u.collection)(this.firestore,"productos");this.subscriptions.add((0,u.collectionData)(t,{idField:"id"}).subscribe(a=>{this.productos=a.filter(r=>!r.esCombinado)}))}calcularEstadisticas(){if(this.totalMermas=this.mermas.length,this.mermasActivas=this.mermas.filter(t=>t.activo).length,this.mermas.length>0){const t=this.mermas.reduce((a,r)=>a+r.porcentajeMerma,0);this.promedioMerma=t/this.mermas.length}else this.promedioMerma=0}abrirModalNuevo(){this.mermaForm.reset({id:"",productoId:"",nombre:"",descripcion:"",porcentajeMerma:0,activo:!0}),this.modal.show()}verDetalleMerma(t){const a=this.productos.find(r=>r.id===t.productoId);this.mermaSeleccionada={...t,productoNombre:a?.nombre||"Producto no encontrado"},this.detalleModal.show()}editarMerma(t){this.mermaForm.patchValue(t),this.modal.show()}editarDesdeDetalle(){this.mermaSeleccionada&&(this.detalleModal.hide(),this.editarMerma(this.mermaSeleccionada))}eliminarMerma(t){var a=this;return(0,g.A)(function*(){if((yield l().fire({title:"\xbfEliminar Merma?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield a.mermasService.eliminarMerma(t),l().fire("\xa1Eliminada!","La merma ha sido eliminada.","success")}catch(i){console.error("Error al eliminar merma:",i),l().fire("Error","No se pudo eliminar la merma.","error")}})()}eliminarDesdeDetalle(){var t=this;return(0,g.A)(function*(){t.mermaSeleccionada?.id&&(t.detalleModal.hide(),yield t.eliminarMerma(t.mermaSeleccionada.id),t.mermaSeleccionada=null)})()}guardarMerma(){var t=this;return(0,g.A)(function*(){if(t.mermaForm.invalid)return void l().fire("Error","Por favor completa todos los campos requeridos.","error");const a=t.mermaForm.value,r={productoId:a.productoId,nombre:a.nombre,descripcion:a.descripcion||"",porcentajeMerma:a.porcentajeMerma,activo:a.activo};try{a.id?(yield t.mermasService.actualizarMerma(a.id,r),l().fire("\xa1Actualizada!","La merma ha sido actualizada.","success")):(yield t.mermasService.crearMerma(r),l().fire("\xa1Creada!","La nueva merma ha sido guardada.","success")),t.modal.hide(),t.mermaForm.reset()}catch(i){console.error("Error al guardar merma:",i),l().fire("Error","Hubo un problema al guardar la merma.","error")}})()}getProductoNombre(t){return this.productos.find(r=>r.id===t)?.nombre||"Producto no encontrado"}getProductoCategoria(t){return this.productos.find(r=>r.id===t)?.categoriaId||""}getProductoUnidadMedida(t){return this.productos.find(r=>r.id===t)?.unidadMedida||"unidades"}getProductoCantidad(t){return this.productos.find(r=>r.id===t)?.cantidad||1}calcularUnidadesUtiles(t,a){return this.mermasService.calcularCantidadUtil(t,a)}calcularPerdida(t,a){return this.mermasService.calcularPerdida(t,a)}actualizarEjemplo(){}aplicarFiltros(){let t=[...this.mermas];if(this.filtroTexto.trim()){const a=this.filtroTexto.toLowerCase();t=t.filter(r=>r.nombre.toLowerCase().includes(a)||r.descripcion.toLowerCase().includes(a)||this.getProductoNombre(r.productoId).toLowerCase().includes(a))}"activo"===this.filtroEstado?t=t.filter(a=>a.activo):"inactivo"===this.filtroEstado&&(t=t.filter(a=>!a.activo)),this.filtroProducto&&(t=t.filter(a=>a.productoId===this.filtroProducto)),t=this.ordenarMermas(t),this.mermasFiltradas=t}ordenarMermas(t){return t.sort((a,r)=>{let i=0;switch(this.ordenarPor){case"nombre":i=a.nombre.localeCompare(r.nombre);break;case"porcentaje":i=a.porcentajeMerma-r.porcentajeMerma;break;case"fecha":const d=a.fechaCreacion?.toDate?.()||new Date(0),p=r.fechaCreacion?.toDate?.()||new Date(0);i=d.getTime()-p.getTime()}return"asc"===this.ordenDireccion?i:-i})}cambiarOrden(t){this.ordenarPor===t?this.ordenDireccion="asc"===this.ordenDireccion?"desc":"asc":(this.ordenarPor=t,this.ordenDireccion="asc"),this.aplicarFiltros()}limpiarFiltros(){this.filtroTexto="",this.filtroEstado="todos",this.filtroProducto="",this.aplicarFiltros()}getMermaPorProducto(t){return this.mermas.find(a=>a.productoId===t&&a.activo)}calcularCantidadConMerma(t,a){const r=this.getMermaPorProducto(t);return r?this.mermasService.calcularCantidadUtil(a,r.porcentajeMerma):a}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(s.ok),e.rXU(u.Firestore),e.rXU(F.d))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-mermas-page"]],decls:159,vars:39,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],["routerLink","/private/mermas/reportes",1,"btn","btn-outline-primary","me-2"],[1,"bi","bi-graph-up","me-2"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-4"],[1,"col-12"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text","bg-white"],[1,"bi","bi-search"],["type","text","placeholder","Buscar por nombre, descripci\xf3n o producto...",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-md-3"],[1,"form-select",3,"ngModel","ngModelChange"],["value","todos"],["value","activo"],["value","inactivo"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-2"],[1,"btn","btn-outline-secondary","w-100",3,"disabled","click"],[1,"bi","bi-x-circle","me-1"],[1,"mt-3","d-flex","justify-content-between","align-items-center"],[4,"ngIf"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","bi bi-sort-alpha-down me-1",4,"ngIf"],["class","bi bi-sort-alpha-up me-1",4,"ngIf"],["class","bi bi-sort-numeric-down me-1",4,"ngIf"],["class","bi bi-sort-numeric-up me-1",4,"ngIf"],["class","bi bi-sort-down me-1",4,"ngIf"],["class","bi bi-sort-up me-1",4,"ngIf"],[1,"col-md-4","mb-3"],[1,"card-body","text-center"],[1,"text-primary","mb-0"],[1,"text-muted"],[1,"text-success","mb-0"],[1,"text-warning","mb-0"],["class","col-12 text-center py-5",4,"ngIf"],["class","col-12 col-md-6 col-lg-4 mb-4",4,"ngFor","ngForOf"],["id","detalleMermaModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header","border-0","pb-0"],[1,"d-flex","align-items-center"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"background-color","#dc3545","width","56px","height","56px"],[1,"bi","bi-exclamation-triangle-fill","text-white","fs-3"],[1,"mb-0"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["class","modal-body pt-3",4,"ngIf"],[1,"modal-footer","border-0"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"bi","bi-x-lg","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-fill","me-2"],["type","button",1,"btn","btn-danger",3,"click"],[1,"bi","bi-trash3-fill","me-2"],["id","mermaModal","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],[1,"text-danger"],["formControlName","productoId",1,"form-select"],["type","text","formControlName","nombre","placeholder","Ej: Merma de Papa",1,"form-control"],["formControlName","descripcion","rows","2","placeholder","Ej: P\xe9rdida durante pelado y limpieza",1,"form-control"],["type","number","formControlName","porcentajeMerma","placeholder","0","min","0","max","100","step","0.1",1,"form-control"],[1,"input-group-text"],["class","alert alert-warning",4,"ngIf"],[1,"form-check"],["type","checkbox","formControlName","activo","id","activoCheck",1,"form-check-input"],["for","activoCheck",1,"form-check-label"],[1,"modal-footer"],["type","submit",1,"btn","btn-danger",3,"disabled"],[3,"value"],[1,"bi","bi-funnel","me-1"],[1,"bi","bi-sort-alpha-down","me-1"],[1,"bi","bi-sort-alpha-up","me-1"],[1,"bi","bi-sort-numeric-down","me-1"],[1,"bi","bi-sort-numeric-up","me-1"],[1,"bi","bi-sort-down","me-1"],[1,"bi","bi-sort-up","me-1"],[1,"col-12","text-center","py-5"],[1,"bi","bi-inbox","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"bi","bi-plus","me-1"],[1,"bi","bi-search","fs-1","text-muted"],[1,"btn","btn-outline-secondary",3,"click"],[1,"col-12","col-md-6","col-lg-4","mb-4"],[1,"card","shadow-sm","border-0","h-100",2,"cursor","pointer",3,"click"],[1,"card-body","p-4"],[1,"d-flex","align-items-start","mb-3"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"background-color","#dc3545","width","48px","height","48px","min-width","48px"],[1,"bi","bi-exclamation-triangle-fill","text-white","fs-5"],[1,"flex-grow-1"],[1,"mb-1","fw-bold"],[1,"text-muted","small","mb-2"],[1,"d-flex","align-items-center","p-2","bg-light","rounded"],[1,"bi","bi-box","me-2","text-primary"],[1,"ms-2","small"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"bi","bi-percent","me-1"],[1,"mb-0","text-danger"],[1,"progress",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-danger"],[1,"d-flex","justify-content-between","align-items-center"],[1,"badge",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"modal-body","pt-3"],[1,"mb-4"],[1,"badge","px-3","py-2",3,"ngClass"],[1,"card","border-0","bg-light","mb-3"],[1,"bi","bi-box-seam","fs-3","text-primary","me-3"],[1,"d-block"],[1,"card","border-0","bg-danger","bg-opacity-10","mb-3"],[1,"bi","bi-percent","text-danger","fs-1","d-block","mb-2"],[1,"progress","mt-3",2,"height","12px"],[1,"card","border-0","bg-warning","bg-opacity-10"],[1,"bi","bi-calculator","me-2","text-warning"],[1,"alert","alert-warning","mb-0"],[1,"mt-3"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"mb-0","text-success"],[1,"alert","alert-warning"],[1,"alert-heading"],[1,"bi","bi-calculator","me-2"],[1,"text-success"]],template:function(a,r){if(1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5"),e.EFF(4,"Gesti\xf3n de Mermas"),e.k0s(),e.j41(5,"span"),e.EFF(6,"Controla las p\xe9rdidas y desperdicios de productos"),e.k0s()(),e.j41(7,"div",3)(8,"button",4),e.nrm(9,"i",5),e.EFF(10," Ver Reportes "),e.k0s(),e.j41(11,"button",6),e.bIt("click",function(){return r.abrirModalNuevo()}),e.nrm(12,"i",7),e.EFF(13," Nueva Merma "),e.k0s()()(),e.j41(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"div",13)(20,"div",14)(21,"span",15),e.nrm(22,"i",16),e.k0s(),e.j41(23,"input",17),e.bIt("ngModelChange",function(d){return r.filtroTexto=d})("ngModelChange",function(){return r.aplicarFiltros()}),e.k0s()()(),e.j41(24,"div",18)(25,"select",19),e.bIt("ngModelChange",function(d){return r.filtroEstado=d})("ngModelChange",function(){return r.aplicarFiltros()}),e.j41(26,"option",20),e.EFF(27,"Todos los estados"),e.k0s(),e.j41(28,"option",21),e.EFF(29,"Activos"),e.k0s(),e.j41(30,"option",22),e.EFF(31,"Inactivos"),e.k0s()()(),e.j41(32,"div",18)(33,"select",19),e.bIt("ngModelChange",function(d){return r.filtroProducto=d})("ngModelChange",function(){return r.aplicarFiltros()}),e.j41(34,"option",23),e.EFF(35,"Todos los productos"),e.k0s(),e.DNE(36,j,2,2,"option",24),e.k0s()(),e.j41(37,"div",25)(38,"button",26),e.bIt("click",function(){return r.limpiarFiltros()}),e.nrm(39,"i",27),e.EFF(40," Limpiar "),e.k0s()()(),e.j41(41,"div",28),e.DNE(42,E,4,2,"div",29),e.j41(43,"div",30)(44,"button",31),e.bIt("click",function(){return r.cambiarOrden("nombre")}),e.DNE(45,k,1,0,"i",32),e.DNE(46,_,1,0,"i",33),e.DNE(47,P,1,0,"i",32),e.EFF(48," Nombre "),e.k0s(),e.j41(49,"button",31),e.bIt("click",function(){return r.cambiarOrden("porcentaje")}),e.DNE(50,C,1,0,"i",34),e.DNE(51,R,1,0,"i",35),e.DNE(52,I,1,0,"i",34),e.EFF(53," Porcentaje "),e.k0s(),e.j41(54,"button",31),e.bIt("click",function(){return r.cambiarOrden("fecha")}),e.DNE(55,y,1,0,"i",36),e.DNE(56,$,1,0,"i",37),e.DNE(57,x,1,0,"i",36),e.EFF(58," Fecha "),e.k0s()()()()()()(),e.j41(59,"div",8)(60,"div",38)(61,"div",10)(62,"div",39)(63,"h2",40),e.EFF(64),e.k0s(),e.j41(65,"span",41),e.EFF(66,"Total Mermas"),e.k0s()()()(),e.j41(67,"div",38)(68,"div",10)(69,"div",39)(70,"h2",42),e.EFF(71),e.k0s(),e.j41(72,"span",41),e.EFF(73,"Activas"),e.k0s()()()(),e.j41(74,"div",38)(75,"div",10)(76,"div",39)(77,"h2",43),e.EFF(78),e.nI1(79,"number"),e.k0s(),e.j41(80,"span",41),e.EFF(81,"Promedio de Merma"),e.k0s()()()()(),e.j41(82,"div",8),e.DNE(83,S,9,0,"div",44),e.DNE(84,w,9,0,"div",44),e.DNE(85,T,33,10,"div",45),e.k0s()(),e.j41(86,"div",46)(87,"div",47)(88,"div",48)(89,"div",49)(90,"div",50)(91,"div",51),e.nrm(92,"i",52),e.k0s(),e.j41(93,"div")(94,"h4",53),e.EFF(95),e.k0s(),e.j41(96,"small",41),e.EFF(97),e.k0s()()(),e.nrm(98,"button",54),e.k0s(),e.DNE(99,O,54,24,"div",55),e.j41(100,"div",56)(101,"button",57),e.nrm(102,"i",58),e.EFF(103,"Cerrar "),e.k0s(),e.j41(104,"button",59),e.bIt("click",function(){return r.editarDesdeDetalle()}),e.nrm(105,"i",60),e.EFF(106,"Editar "),e.k0s(),e.j41(107,"button",61),e.bIt("click",function(){return r.eliminarDesdeDetalle()}),e.nrm(108,"i",62),e.EFF(109,"Eliminar "),e.k0s()()()()(),e.j41(110,"div",63)(111,"div",64)(112,"div",48)(113,"form",65),e.bIt("ngSubmit",function(){return r.guardarMerma()}),e.j41(114,"div",66)(115,"h5",67),e.EFF(116),e.k0s(),e.nrm(117,"button",54),e.k0s(),e.j41(118,"div",68)(119,"div",69)(120,"label",70),e.EFF(121,"Producto "),e.j41(122,"span",71),e.EFF(123,"*"),e.k0s()(),e.j41(124,"select",72)(125,"option",23),e.EFF(126,"Seleccionar producto"),e.k0s(),e.DNE(127,D,2,2,"option",24),e.k0s()(),e.j41(128,"div",69)(129,"label",70),e.EFF(130,"Nombre "),e.j41(131,"span",71),e.EFF(132,"*"),e.k0s()(),e.nrm(133,"input",73),e.k0s(),e.j41(134,"div",69)(135,"label",70),e.EFF(136,"Descripci\xf3n"),e.k0s(),e.nrm(137,"textarea",74),e.k0s(),e.j41(138,"div",69)(139,"label",70),e.EFF(140,"Porcentaje de Merma (%) "),e.j41(141,"span",71),e.EFF(142,"*"),e.k0s()(),e.j41(143,"div",14),e.nrm(144,"input",75),e.j41(145,"span",76),e.EFF(146,"%"),e.k0s()(),e.j41(147,"small",41),e.EFF(148,"Porcentaje estimado de p\xe9rdida del producto durante su procesamiento"),e.k0s()(),e.DNE(149,G,16,5,"div",77),e.j41(150,"div",78),e.nrm(151,"input",79),e.j41(152,"label",80),e.EFF(153," Activo "),e.k0s()()(),e.j41(154,"div",81)(155,"button",57),e.EFF(156,"Cancelar"),e.k0s(),e.j41(157,"button",82),e.EFF(158),e.k0s()()()()()()),2&a){let i,d,p;e.R7$(23),e.Y8G("ngModel",r.filtroTexto),e.R7$(2),e.Y8G("ngModel",r.filtroEstado),e.R7$(8),e.Y8G("ngModel",r.filtroProducto),e.R7$(3),e.Y8G("ngForOf",r.productos),e.R7$(2),e.Y8G("disabled",!r.filtroTexto&&"todos"===r.filtroEstado&&!r.filtroProducto),e.R7$(4),e.Y8G("ngIf",r.filtroTexto||"todos"!==r.filtroEstado||r.filtroProducto),e.R7$(2),e.AVh("active","nombre"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","nombre"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","nombre"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","nombre"!==r.ordenarPor),e.R7$(2),e.AVh("active","porcentaje"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","porcentaje"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","porcentaje"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","porcentaje"!==r.ordenarPor),e.R7$(2),e.AVh("active","fecha"===r.ordenarPor),e.R7$(1),e.Y8G("ngIf","fecha"===r.ordenarPor&&"asc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","fecha"===r.ordenarPor&&"desc"===r.ordenDireccion),e.R7$(1),e.Y8G("ngIf","fecha"!==r.ordenarPor),e.R7$(7),e.JRh(r.totalMermas),e.R7$(7),e.JRh(r.mermasActivas),e.R7$(7),e.SpI("",e.i5U(79,36,r.promedioMerma,"1.1-1"),"%"),e.R7$(5),e.Y8G("ngIf",0===r.mermasFiltradas.length&&0===r.mermas.length),e.R7$(1),e.Y8G("ngIf",0===r.mermasFiltradas.length&&r.mermas.length>0),e.R7$(1),e.Y8G("ngForOf",r.mermasFiltradas),e.R7$(10),e.JRh(null==r.mermaSeleccionada?null:r.mermaSeleccionada.nombre),e.R7$(2),e.JRh((null==r.mermaSeleccionada?null:r.mermaSeleccionada.descripcion)||"Sin descripci\xf3n"),e.R7$(2),e.Y8G("ngIf",r.mermaSeleccionada),e.R7$(14),e.Y8G("formGroup",r.mermaForm),e.R7$(3),e.JRh(null!=(i=r.mermaForm.get("id"))&&i.value?"Editar Merma":"Nueva Merma"),e.R7$(11),e.Y8G("ngForOf",r.productos),e.R7$(22),e.Y8G("ngIf",(null==(d=r.mermaForm.get("porcentajeMerma"))?null:d.value)>=0),e.R7$(8),e.Y8G("disabled",r.mermaForm.invalid),e.R7$(1),e.SpI(" ",null!=(p=r.mermaForm.get("id"))&&p.value?"Actualizar":"Guardar"," ")}},dependencies:[b.Wk,m.YU,m.Sq,m.bT,s.qT,s.xH,s.y7,s.me,s.Q0,s.Zm,s.wz,s.BC,s.cb,s.VZ,s.zX,s.j4,s.JD,s.vS,m.QX],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 .5rem 1rem #00000026!important}.progress[_ngcontent-%COMP%]{background-color:#0000001a}.badge[_ngcontent-%COMP%]{font-weight:500}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.input-group-text[_ngcontent-%COMP%]{border-right:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-left:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-left:0;box-shadow:none}.btn-group[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;border-color:var(--bs-primary)}.modal-content[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden}.modal-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc3545 0%,#c82333 100%);color:#fff}.modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:brightness(0) invert(1)}.modal-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .modal-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#fff}.card-body[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700}.progress-bar[_ngcontent-%COMP%]{transition:width .6s ease}.alert[_ngcontent-%COMP%]{border-radius:8px;border:none}.alert.alert-warning[_ngcontent-%COMP%]{background-color:#ffc1071a;border-left:4px solid #ffc107}"]})}}return o})();var U=c(4572);function Y(o,n){if(1&o&&(e.j41(0,"div",1)(1,"div",18)(2,"div",23)(3,"div",19)(4,"h6",20),e.nrm(5,"i",24),e.EFF(6," Producto con Mayor P\xe9rdida "),e.k0s(),e.j41(7,"div",25)(8,"div",26)(9,"h5",13),e.EFF(10),e.k0s(),e.j41(11,"small",5),e.EFF(12),e.k0s()(),e.j41(13,"div",27)(14,"div",28),e.EFF(15,"Merma"),e.k0s(),e.j41(16,"h4",29),e.EFF(17),e.k0s()(),e.j41(18,"div",30)(19,"div",28),e.EFF(20,"P\xe9rdida"),e.k0s(),e.j41(21,"h5",13),e.EFF(22),e.nI1(23,"number"),e.k0s()(),e.j41(24,"div",30)(25,"div",28),e.EFF(26,"Costo P\xe9rdida"),e.k0s(),e.j41(27,"h5",29),e.EFF(28),e.nI1(29,"number"),e.k0s()()()()()()()),2&o){const t=e.XpG();e.R7$(10),e.JRh(t.productoMayorMerma.producto.nombre),e.R7$(2),e.JRh(t.productoMayorMerma.merma.nombre),e.R7$(5),e.SpI("",t.productoMayorMerma.merma.porcentajeMerma,"%"),e.R7$(5),e.Lme("",e.i5U(23,6,t.productoMayorMerma.perdidaEstimada,"1.1-1")," ",t.productoMayorMerma.producto.unidadMedida,""),e.R7$(6),e.SpI("$",e.i5U(29,9,t.productoMayorMerma.costoPerdida,"1.2-2"),"")}}function A(o,n){1&o&&(e.j41(0,"div",31),e.nrm(1,"i",32),e.j41(2,"h5",33),e.EFF(3,"No hay datos para mostrar"),e.k0s(),e.j41(4,"p",5),e.EFF(5,"Configura mermas para tus productos para ver el reporte"),e.k0s()())}function J(o,n){if(1&o&&(e.j41(0,"tr")(1,"td")(2,"strong"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.j41(5,"small",5),e.EFF(6),e.k0s()(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td",36)(10,"span",41),e.EFF(11),e.k0s()(),e.j41(12,"td",36),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.j41(15,"td",40)(16,"strong"),e.EFF(17),e.nI1(18,"number"),e.k0s(),e.EFF(19),e.k0s(),e.j41(20,"td",42)(21,"strong"),e.EFF(22),e.nI1(23,"number"),e.k0s(),e.EFF(24),e.k0s(),e.j41(25,"td",40)(26,"strong"),e.EFF(27),e.nI1(28,"number"),e.k0s()()()),2&o){const t=n.$implicit;e.R7$(3),e.JRh(t.producto.nombre),e.R7$(3),e.JRh(t.producto.categoriaId),e.R7$(2),e.JRh(t.merma.nombre),e.R7$(3),e.SpI(" ",t.merma.porcentajeMerma,"% "),e.R7$(2),e.Lme(" ",e.i5U(14,11,t.cantidadComprada,"1.1-1")," ",t.producto.unidadMedida," "),e.R7$(4),e.JRh(e.i5U(18,14,t.perdidaEstimada,"1.1-1")),e.R7$(2),e.SpI(" ",t.producto.unidadMedida," "),e.R7$(3),e.JRh(e.i5U(23,17,t.cantidadUtil,"1.1-1")),e.R7$(2),e.SpI(" ",t.producto.unidadMedida," "),e.R7$(3),e.SpI("$",e.i5U(28,20,t.costoPerdida,"1.2-2"),"")}}function L(o,n){if(1&o&&(e.j41(0,"div",34)(1,"table",35)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Producto"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Merma"),e.k0s(),e.j41(8,"th",36),e.EFF(9,"% Merma"),e.k0s(),e.j41(10,"th",36),e.EFF(11,"Cantidad Comprada"),e.k0s(),e.j41(12,"th",36),e.EFF(13,"P\xe9rdida"),e.k0s(),e.j41(14,"th",36),e.EFF(15,"Cantidad \xdatil"),e.k0s(),e.j41(16,"th",36),e.EFF(17,"Costo P\xe9rdida"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,J,29,23,"tr",37),e.k0s(),e.j41(20,"tfoot")(21,"tr",38)(22,"td",39)(23,"strong"),e.EFF(24,"TOTALES:"),e.k0s()(),e.j41(25,"td",40)(26,"strong"),e.EFF(27),e.nI1(28,"number"),e.k0s()(),e.nrm(29,"td"),e.j41(30,"td",40)(31,"strong"),e.EFF(32),e.nI1(33,"number"),e.k0s()()()()()()),2&o){const t=e.XpG();e.R7$(19),e.Y8G("ngForOf",t.reportes),e.R7$(8),e.JRh(e.i5U(28,3,t.totalPerdida,"1.1-1")),e.R7$(5),e.SpI("$",e.i5U(33,6,t.totalCostoPerdida,"1.2-2"),"")}}const X=[{path:"",component:N},{path:"reportes",component:(()=>{class o{constructor(t,a){this.mermasService=t,this.firestore=a,this.reportes=[],this.totalPerdida=0,this.totalCostoPerdida=0,this.productoMayorMerma=null,this.subscriptions=new f.yU}ngOnInit(){this.cargarReportes()}ngOnDestroy(){this.subscriptions.unsubscribe()}cargarReportes(){const t=(0,u.collection)(this.firestore,"productos"),a=(0,u.collectionData)(t,{idField:"id"}),r=this.mermasService.getMermasActivas();this.subscriptions.add((0,U.z)([a,r]).subscribe(([i,d])=>{this.generarReportes(i,d)}))}generarReportes(t,a){this.reportes=[],t.forEach(r=>{const i=a.find(d=>d.productoId===r.id);if(i&&r.cantidad>0){const d=this.mermasService.calcularPerdida(r.cantidad,i.porcentajeMerma),p=this.mermasService.calcularCantidadUtil(r.cantidad,i.porcentajeMerma);this.reportes.push({producto:r,merma:i,cantidadComprada:r.cantidad,perdidaEstimada:d,cantidadUtil:p,costoTotal:r.cantidad*(r.costo||0),costoPerdida:d*(r.costo||0)})}}),this.calcularTotales()}calcularTotales(){this.totalPerdida=this.reportes.reduce((t,a)=>t+a.perdidaEstimada,0),this.totalCostoPerdida=this.reportes.reduce((t,a)=>t+a.costoPerdida,0),this.reportes.length>0&&(this.productoMayorMerma=this.reportes.reduce((t,a)=>a.perdidaEstimada>t.perdidaEstimada?a:t))}exportarReporte(){console.log("Exportar reporte",this.reportes)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(F.d),e.rXU(u.Firestore))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-reportes-mermas"]],decls:50,vars:12,consts:[[1,"container-fluid"],[1,"row","mb-4"],[1,"col-8"],["routerLink","/private/mermas",1,"btn","btn-link","text-decoration-none","ps-0","mb-2"],[1,"bi","bi-arrow-left","me-2"],[1,"text-muted"],[1,"col","text-end"],[1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-download","me-2"],[1,"col-md-4","mb-3"],[1,"card","border-0","shadow-sm"],[1,"card-body","text-center"],[1,"bi","bi-box-seam","text-primary","fs-1","mb-2"],[1,"mb-0"],[1,"bi","bi-exclamation-triangle","text-warning","fs-1","mb-2"],[1,"bi","bi-currency-dollar","text-danger","fs-1","mb-2"],["class","row mb-4",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"card-body"],[1,"mb-3"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"card","border-0","shadow-sm","bg-danger","bg-opacity-10"],[1,"bi","bi-trophy","text-danger","me-2"],[1,"row","align-items-center"],[1,"col-md-4"],[1,"col-md-2","text-center"],[1,"text-muted","small"],[1,"mb-0","text-danger"],[1,"col-md-3","text-center"],[1,"text-center","py-5"],[1,"bi","bi-inbox","fs-1","text-muted"],[1,"mt-3","text-muted"],[1,"table-responsive"],[1,"table","table-hover"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"table-secondary"],["colspan","4",1,"text-end"],[1,"text-end","text-danger"],[1,"badge","bg-warning","text-dark"],[1,"text-end","text-success"]],template:function(a,r){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.nrm(4,"i",4),e.EFF(5,"Volver a Mermas "),e.k0s(),e.j41(6,"h5"),e.EFF(7,"Reporte de Mermas"),e.k0s(),e.j41(8,"span",5),e.EFF(9,"An\xe1lisis del impacto de mermas en el inventario"),e.k0s()(),e.j41(10,"div",6)(11,"button",7),e.bIt("click",function(){return r.exportarReporte()}),e.nrm(12,"i",8),e.EFF(13," Exportar Reporte "),e.k0s()()(),e.j41(14,"div",1)(15,"div",9)(16,"div",10)(17,"div",11),e.nrm(18,"i",12),e.j41(19,"h3",13),e.EFF(20),e.k0s(),e.j41(21,"span",5),e.EFF(22,"Productos con Merma"),e.k0s()()()(),e.j41(23,"div",9)(24,"div",10)(25,"div",11),e.nrm(26,"i",14),e.j41(27,"h3",13),e.EFF(28),e.nI1(29,"number"),e.k0s(),e.j41(30,"span",5),e.EFF(31,"Total Unidades Perdidas"),e.k0s()()()(),e.j41(32,"div",9)(33,"div",10)(34,"div",11),e.nrm(35,"i",15),e.j41(36,"h3",13),e.EFF(37),e.nI1(38,"number"),e.k0s(),e.j41(39,"span",5),e.EFF(40,"Costo Total de P\xe9rdidas"),e.k0s()()()()(),e.DNE(41,Y,30,12,"div",16),e.j41(42,"div",17)(43,"div",18)(44,"div",10)(45,"div",19)(46,"h6",20),e.EFF(47,"Detalle por Producto"),e.k0s(),e.DNE(48,A,6,0,"div",21),e.DNE(49,L,34,9,"div",22),e.k0s()()()()()),2&a&&(e.R7$(20),e.JRh(r.reportes.length),e.R7$(8),e.JRh(e.i5U(29,6,r.totalPerdida,"1.1-1")),e.R7$(9),e.SpI("$",e.i5U(38,9,r.totalCostoPerdida,"1.2-2"),""),e.R7$(4),e.Y8G("ngIf",r.productoMayorMerma),e.R7$(7),e.Y8G("ngIf",0===r.reportes.length),e.R7$(1),e.Y8G("ngIf",r.reportes.length>0))},dependencies:[b.Wk,m.Sq,m.bT,m.QX],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;text-transform:uppercase;font-size:.75rem;letter-spacing:.5px;color:#6c757d;border-bottom:2px solid #dee2e6}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s ease}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#00000005}.table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{font-weight:600}.badge[_ngcontent-%COMP%]{font-weight:600;padding:.35em .65em}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}"]})}}return o})()}];let B=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[b.iI.forChild(X),b.iI]})}}return o})(),V=(()=>{class o{static{this.\u0275fac=function(a){return new(a||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[B,v.PrivateModule,m.MD,s.X1,s.YN]})}}return o})()}}]);