"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[656],{9656:(G,v,n)=>{n.r(v),n.d(v,{ProveedoresPageModule:()=>A});var h=n(7412),i=n(9417),u=n(177),f=n(8498),b=n(467),l=n(2418),g=n(8032),m=n.n(g),k=n(8359),E=n(4572),F=n(9172),P=n(152),o=n(7705);function j(s,c){if(1&s&&(o.j41(0,"option",67),o.EFF(1),o.k0s()),2&s){const e=c.$implicit;o.Y8G("value",e.id),o.R7$(1),o.JRh(e.nombre)}}function y(s,c){1&s&&(o.j41(0,"div",68)(1,"p",10),o.EFF(2,"No se encontraron proveedores con los filtros seleccionados."),o.k0s()())}function C(s,c){if(1&s&&(o.j41(0,"span",96),o.EFF(1),o.k0s()),2&s){const e=c.$implicit,r=o.XpG(2);o.R7$(1),o.SpI(" ",r.getProductName(e)," ")}}const x=function(s,c){return{"bg-info bg-opacity-10 text-primary":s,"bg-warning bg-opacity-10 text-danger":c}};function R(s,c){if(1&s&&(o.j41(0,"div",97)(1,"small"),o.EFF(2),o.k0s()()),2&s){const e=o.XpG().$implicit;o.Y8G("ngClass",o.l_i(2,x,"SEPA"===e.metodoPago,"TRANSFERENCIA"===e.metodoPago)),o.R7$(2),o.SpI("M\xe9todo de Pago: ",e.metodoPago,"")}}function N(s,c){if(1&s){const e=o.RV6();o.j41(0,"div",69)(1,"div",70)(2,"div",71)(3,"div",72)(4,"div",73)(5,"div",74),o.nrm(6,"i",75),o.k0s(),o.j41(7,"div")(8,"h6",76),o.EFF(9),o.k0s(),o.j41(10,"small",10),o.EFF(11),o.k0s()()(),o.j41(12,"div")(13,"button",77),o.bIt("click",function(){const a=o.eBV(e).$implicit,d=o.XpG();return o.Njj(d.editarProveedor(a))}),o.nrm(14,"i",78),o.k0s(),o.j41(15,"button",79),o.bIt("click",function(){const a=o.eBV(e).$implicit,d=o.XpG();return o.Njj(d.eliminarProveedor(a.id))}),o.nrm(16,"i",80),o.k0s()()(),o.j41(17,"div",81)(18,"div",82),o.nrm(19,"i",83),o.j41(20,"span"),o.EFF(21),o.k0s()(),o.j41(22,"div",82),o.nrm(23,"i",84),o.j41(24,"span"),o.EFF(25),o.k0s()(),o.j41(26,"div",82),o.nrm(27,"i",85),o.j41(28,"span"),o.EFF(29),o.k0s()(),o.j41(30,"div",73),o.nrm(31,"i",86),o.j41(32,"span"),o.EFF(33),o.k0s()()(),o.j41(34,"div",87)(35,"div",88)(36,"div",73),o.nrm(37,"i",89),o.j41(38,"div")(39,"small",90),o.EFF(40,"Pago: "),o.j41(41,"span"),o.EFF(42),o.k0s()()()()(),o.j41(43,"div",88)(44,"div",73),o.nrm(45,"i",91),o.j41(46,"div")(47,"small",90),o.EFF(48,"Productos:"),o.k0s(),o.j41(49,"div",92),o.DNE(50,C,2,1,"span",93),o.k0s()()()()(),o.j41(51,"div",94)(52,"small"),o.EFF(53),o.k0s()(),o.DNE(54,R,3,5,"div",95),o.k0s()()()}if(2&s){const e=c.$implicit;o.R7$(9),o.JRh(e.nombre),o.R7$(2),o.SpI("CIF: ",e.cif,""),o.R7$(10),o.SpI("Contacto: ",e.contacto.nombre,""),o.R7$(4),o.JRh(e.contacto.email),o.R7$(4),o.JRh(e.contacto.telefono),o.R7$(4),o.Lme("",e.direccion.calle,", ",e.direccion.ciudad,""),o.R7$(9),o.SpI("",e.plazoPago," d\xedas"),o.R7$(8),o.Y8G("ngForOf",e.productos),o.R7$(3),o.SpI("Descuento: ",e.descuento,"%"),o.R7$(1),o.Y8G("ngIf",e.metodoPago)}}function S(s,c){if(1&s&&(o.j41(0,"label",98),o.nrm(1,"input",99),o.EFF(2),o.k0s()),2&s){const e=c.index,r=o.XpG();o.Y8G("hidden",!r.shouldShowProduct(e)),o.R7$(1),o.Y8G("formControlName",e),o.R7$(1),o.SpI(" ",(null==r.productos[e]?null:r.productos[e].nombre)||"Producto sin nombre"," ")}}const $=[{path:"",component:(()=>{class s{constructor(e,r,t){this.fb=e,this.firestore=r,this.cdr=t,this.proveedores=[],this.filteredProveedores=[],this.productos=[],this.categorias=[],this.totalProductos=0,this.productosBajosEnStock=0,this.subscriptions=new k.yU,this.productSearch=new i.MJ(""),this.proveedorSearch=new i.MJ(""),this.categoryFilter=new i.MJ("all"),this.proveedorForm=this.fb.group({id:[null],nombre:["",i.k0.required],cif:["",i.k0.required],razonSocial:["",i.k0.required],contacto:this.fb.group({nombre:["",i.k0.required],telefono:["",i.k0.required],email:["",[i.k0.required,i.k0.email]]}),direccion:this.fb.group({calle:["",i.k0.required],codigoPostal:["",i.k0.required],ciudad:["",i.k0.required],provincia:["",i.k0.required]}),iban:[""],plazoPago:[30,i.k0.min(0)],descuento:[0,[i.k0.min(0),i.k0.max(100)]],activo:[!0],metodoPago:["",i.k0.required],productos:this.fb.array([])})}ngOnInit(){this.cargarProveedores(),this.cargarProductos(),this.cargarCategorias();const e=document.getElementById("staticBackdrop");e&&(this.modal=new bootstrap.Modal(e)),this.subscriptions.add(this.productSearch.valueChanges.subscribe(()=>{this.cdr.detectChanges()})),this.subscriptions.add((0,E.z)([this.proveedorSearch.valueChanges.pipe((0,F.Z)("")),this.categoryFilter.valueChanges.pipe((0,F.Z)("all"))]).pipe((0,P.B)(300)).subscribe(([r,t])=>{this.filterProveedores(r||"",t||"all")}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get productosFormArray(){return this.proveedorForm.get("productos")}cargarProveedores(){const e=(0,l.rJ)(this.firestore,"proveedores");this.subscriptions.add((0,l.xs)(e,{idField:"id"}).subscribe(r=>{this.proveedores=r,this.filteredProveedores=r}))}cargarProductos(){const e=(0,l.rJ)(this.firestore,"productos");this.subscriptions.add((0,l.xs)(e,{idField:"id"}).subscribe(r=>{this.productos=r,this.totalProductos=r.length,this.productosBajosEnStock=r.filter(t=>!t.esCombinado&&void 0!==t.stock&&void 0!==t.stockMinimo&&t.stock<=t.stockMinimo).length,this.buildProductsFormArray()}))}cargarCategorias(){const e=(0,l.rJ)(this.firestore,"categorias");this.subscriptions.add((0,l.xs)(e,{idField:"id"}).subscribe(r=>{this.categorias=r}))}filterProveedores(e,r){let t=[...this.proveedores];if(e&&(t=t.filter(a=>a.nombre.toLowerCase().includes(e.toLowerCase()))),r&&"all"!==r){const a=this.productos.filter(d=>d.categoriaId===r).map(d=>d.id);t=t.filter(d=>d.productos.some(p=>a.includes(p)))}this.filteredProveedores=t}buildProductsFormArray(){this.productosFormArray.clear(),this.productos.forEach(()=>{this.productosFormArray.push(new i.MJ(!1))})}shouldShowProduct(e){const r=this.productSearch.value?.toLowerCase()||"";return!r||this.productos[e].nombre.toLowerCase().includes(r)}guardarProveedor(){var e=this;return(0,b.A)(function*(){if(e.proveedorForm.invalid)return void m().fire("Error","Por favor, complete todos los campos requeridos.","error");const r=e.proveedorForm.value,t=e.productos.filter((d,p)=>e.productosFormArray.at(p).value).map(d=>d.id),a={...r,productos:t};m().showLoading();try{if(r.id){const d=(0,l.H9)(e.firestore,"proveedores",r.id);yield(0,l.mZ)(d,a),m().fire("\xa1Actualizado!","El proveedor ha sido actualizado.","success")}else a.fechaCreacion=(0,l.O5)(),delete a.id,yield(0,l.gS)((0,l.rJ)(e.firestore,"proveedores"),a),m().fire("\xa1Creado!","El nuevo proveedor ha sido guardado.","success");e.modal.hide(),e.resetForm()}catch(d){console.error("Error al guardar el proveedor:",d),m().fire("Error","Hubo un problema al guardar el proveedor.","error")}})()}editarProveedor(e){this.proveedorForm.reset(),this.proveedorForm.patchValue(e),this.productosFormArray.controls.forEach((r,t)=>{e.productos&&this.productos[t]&&e.productos.includes(this.productos[t].id)?r.setValue(!0):r.setValue(!1)}),this.modal.show()}eliminarProveedor(e){var r=this;return(0,b.A)(function*(){if((yield m().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{yield(0,l.kd)((0,l.H9)(r.firestore,"proveedores",e)),m().fire("\xa1Eliminado!","El proveedor ha sido eliminado.","success")}catch(a){console.error("Error al eliminar el proveedor:",a),m().fire("Error","No se pudo eliminar el proveedor.","error")}})()}abrirModalNuevo(){this.resetForm(),this.modal.show()}resetForm(){this.proveedorForm.reset({nombre:"",cif:"",razonSocial:"",contacto:{nombre:"",telefono:"",email:""},direccion:{calle:"",codigoPostal:"",ciudad:"",provincia:""},iban:"",plazoPago:30,descuento:0,activo:!0,metodoPago:""}),this.productosFormArray&&this.productosFormArray.controls.forEach(e=>e.setValue(!1)),this.productSearch.setValue("")}getProductName(e){const r=this.productos.find(t=>t.id===e);return r?r.nombre:""}static{this.\u0275fac=function(r){return new(r||s)(o.rXU(i.ok),o.rXU(l._7),o.rXU(o.gRc))}}static{this.\u0275cmp=o.VBU({type:s,selectors:[["app-proveedores-page"]],decls:175,vars:13,consts:[[1,"row"],[1,"col-8"],[1,"col","text-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-4"],[1,"col-md-3"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"text-primary","mb-0"],[1,"text-muted"],[1,"text-danger","mb-0"],[1,"row","mt-3"],[1,"col"],[1,"card"],[1,"card-body","d-flex","gap-2"],["type","text","placeholder","Buscar proveedor...",1,"form-control",3,"formControl"],[1,"form-select",3,"formControl"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["class","col-12 text-center",4,"ngIf"],["class","col-12 col-md-4 mb-4",4,"ngFor","ngForOf"],["id","staticBackdrop","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[3,"formGroup","ngSubmit"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"col-12","col-sm-6"],[1,"bi","bi-building"],[1,"row","mt-2"],[1,"text-danger"],["type","text","placeholder","Nombre del proveedor","formControlName","nombre",1,"form-control"],["type","text","placeholder","B12345678","formControlName","cif",1,"form-control"],[1,"col-12"],["type","text","placeholder","Distribuciones S.L.","formControlName","razonSocial",1,"form-control"],["formGroupName","contacto"],["type","text","placeholder","Carlos Mendoza","formControlName","nombre",1,"form-control"],["type","tel","placeholder","+34 91 123 4567","formControlName","telefono",1,"form-control"],["type","email","placeholder","contacto@proveedor.com","formControlName","email",1,"form-control"],[1,"form-check"],["type","checkbox","id","checkDefault","formControlName","activo",1,"form-check-input"],["for","checkDefault",1,"form-check-label"],[1,"bi","bi-geo-alt-fill"],["formGroupName","direccion"],["type","text","placeholder","Calle Gran Via, 15","formControlName","calle",1,"form-control"],["type","text","placeholder","28013","formControlName","codigoPostal",1,"form-control"],["type","text","placeholder","Madrid","formControlName","ciudad",1,"form-control"],["type","text","placeholder","Madrid","formControlName","provincia",1,"form-control"],["type","text","placeholder","ES91 2100 0418 4502 0005 1332","formControlName","iban",1,"form-control"],["type","number","placeholder","30","formControlName","plazoPago",1,"form-control"],["type","number","placeholder","5","formControlName","descuento",1,"form-control"],["for",""],["name","","id","","formControlName","metodoPago",1,"form-select"],["value","SEPA"],["value","TRANSFERENCIA"],[1,"my-4"],[1,"bi","bi-box-seam-fill"],[1,"mb-3"],["type","text","placeholder","Buscar producto...",1,"form-control",3,"formControl"],["formArrayName","productos",1,"list-group",2,"max-height","200px","overflow-y","auto"],["class","list-group-item",3,"hidden",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-danger",3,"disabled"],[3,"value"],[1,"col-12","text-center"],[1,"col-12","col-md-4","mb-4"],[1,"card","shadow-sm","border-0","h-100"],[1,"card-body","p-4"],[1,"d-flex","justify-content-between","align-items-start","mb-4"],[1,"d-flex","align-items-center"],[1,"rounded-circle","me-3","d-flex","justify-content-center","align-items-center",2,"background-color","#03204c","width","48px","height","48px"],[1,"bi","bi-building-fill","text-white","fs-4"],[1,"mb-0","fw-bold"],[1,"btn","btn-outline-primary","btn-sm","me-2","rounded-1",3,"click"],[1,"bi","bi-pencil-fill"],[1,"btn","btn-outline-danger","btn-sm","rounded-1",3,"click"],[1,"bi","bi-trash3-fill"],[1,"mb-4"],[1,"d-flex","align-items-center","mb-2"],[1,"bi","bi-person-fill","me-2","text-primary"],[1,"bi","bi-envelope-fill","me-2","text-primary"],[1,"bi","bi-telephone-fill","me-2","text-primary"],[1,"bi","bi-geo-alt-fill","me-2","text-primary"],[1,"row","mb-3"],[1,"col-6"],[1,"bi","bi-calendar3","me-2","text-primary"],[1,"text-muted","d-block"],[1,"bi","bi-box-seam-fill","me-2","text-primary"],[1,"d-flex","flex-wrap","gap-1","mt-1"],["class","badge bg-light text-dark border",4,"ngFor","ngForOf"],[1,"bg-success","bg-opacity-10","text-success","px-3","py-2","rounded-1","mb-3"],["class","px-3 py-2 rounded-1",3,"ngClass",4,"ngIf"],[1,"badge","bg-light","text-dark","border"],[1,"px-3","py-2","rounded-1",3,"ngClass"],[1,"list-group-item",3,"hidden"],["type","checkbox",1,"form-check-input","me-1",3,"formControlName"]],template:function(r,t){if(1&r&&(o.j41(0,"div",0)(1,"div",1)(2,"h5"),o.EFF(3,"Gesti\xf3n de Proveedores"),o.k0s(),o.j41(4,"span"),o.EFF(5,"Administra tus proveedores y contactos"),o.k0s()(),o.j41(6,"div",2)(7,"button",3),o.bIt("click",function(){return t.abrirModalNuevo()}),o.nrm(8,"i",4),o.EFF(9," Nuevo Proveedor "),o.k0s()()(),o.j41(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"h1",9),o.EFF(15),o.k0s(),o.j41(16,"span",10),o.EFF(17,"Total Productos"),o.k0s()()()(),o.j41(18,"div",6)(19,"div",7)(20,"div",8)(21,"h1",11),o.EFF(22),o.k0s(),o.j41(23,"span",10),o.EFF(24,"Productos bajos en stock"),o.k0s()()()()(),o.j41(25,"div",12)(26,"div",13)(27,"div",14)(28,"div",15),o.nrm(29,"input",16),o.j41(30,"select",17)(31,"option",18),o.EFF(32,"Todas las categor\xedas"),o.k0s(),o.DNE(33,j,2,2,"option",19),o.k0s()()()()(),o.j41(34,"div",5),o.DNE(35,y,3,0,"div",20),o.DNE(36,N,55,11,"div",21),o.k0s(),o.j41(37,"div",22)(38,"div",23)(39,"div",24)(40,"form",25),o.bIt("ngSubmit",function(){return t.guardarProveedor()}),o.j41(41,"div",26)(42,"h4",27),o.EFF(43),o.k0s(),o.nrm(44,"button",28),o.k0s(),o.j41(45,"div",29)(46,"div",0)(47,"div",30)(48,"h6"),o.nrm(49,"i",31),o.EFF(50,"\xa0Informaci\xf3n de la Empresa"),o.k0s(),o.j41(51,"div",32)(52,"div",30)(53,"label"),o.EFF(54,"Nombre Comercial "),o.j41(55,"span",33),o.EFF(56,"*"),o.k0s()(),o.nrm(57,"input",34),o.k0s(),o.j41(58,"div",30)(59,"label"),o.EFF(60,"CIF "),o.j41(61,"span",33),o.EFF(62,"*"),o.k0s()(),o.nrm(63,"input",35),o.k0s()(),o.j41(64,"div",12)(65,"div",36)(66,"label"),o.EFF(67,"Raz\xf3n Social "),o.j41(68,"span",33),o.EFF(69,"*"),o.k0s()(),o.nrm(70,"input",37),o.k0s()(),o.j41(71,"div",38)(72,"div",12)(73,"div",30)(74,"label"),o.EFF(75,"Persona de Contacto "),o.j41(76,"span",33),o.EFF(77,"*"),o.k0s()(),o.nrm(78,"input",39),o.k0s(),o.j41(79,"div",30)(80,"label"),o.EFF(81,"Tel\xe9fono "),o.j41(82,"span",33),o.EFF(83,"*"),o.k0s()(),o.nrm(84,"input",40),o.k0s()(),o.j41(85,"div",12)(86,"div",36)(87,"label"),o.EFF(88,"Email "),o.j41(89,"span",33),o.EFF(90,"*"),o.k0s()(),o.nrm(91,"input",41),o.k0s()()(),o.j41(92,"div",12)(93,"div",13)(94,"div",42),o.nrm(95,"input",43),o.j41(96,"label",44),o.EFF(97,"Proveedor activo"),o.k0s()()()()(),o.j41(98,"div",30)(99,"h6"),o.nrm(100,"i",45),o.EFF(101,"\xa0Direcci\xf3n y Datos Fiscales"),o.k0s(),o.j41(102,"div",46)(103,"div",32)(104,"div",36)(105,"label"),o.EFF(106,"Direcci\xf3n "),o.j41(107,"span",33),o.EFF(108,"*"),o.k0s()(),o.nrm(109,"input",47),o.k0s()(),o.j41(110,"div",12)(111,"div",30)(112,"label"),o.EFF(113,"C\xf3digo Postal "),o.j41(114,"span",33),o.EFF(115,"*"),o.k0s()(),o.nrm(116,"input",48),o.k0s(),o.j41(117,"div",30)(118,"label"),o.EFF(119,"Ciudad "),o.j41(120,"span",33),o.EFF(121,"*"),o.k0s()(),o.nrm(122,"input",49),o.k0s()(),o.j41(123,"div",12)(124,"div",36)(125,"label"),o.EFF(126,"Provincia "),o.j41(127,"span",33),o.EFF(128,"*"),o.k0s()(),o.nrm(129,"input",50),o.k0s()()(),o.j41(130,"div",12)(131,"div",36)(132,"label"),o.EFF(133,"IBAN "),o.j41(134,"small",10),o.EFF(135,"(Opcional)"),o.k0s()(),o.nrm(136,"input",51),o.k0s()(),o.j41(137,"div",12)(138,"div",30)(139,"label"),o.EFF(140,"D\xedas de Pago"),o.k0s(),o.nrm(141,"input",52),o.k0s(),o.j41(142,"div",30)(143,"label"),o.EFF(144,"Descuentos "),o.j41(145,"small",10),o.EFF(146,"(%)"),o.k0s()(),o.nrm(147,"input",53),o.k0s()(),o.j41(148,"div",12)(149,"div",13)(150,"label",54),o.EFF(151,"Tipo de Pago"),o.k0s(),o.j41(152,"select",55)(153,"option",56),o.EFF(154,"SEPA"),o.k0s(),o.j41(155,"option",57),o.EFF(156,"TRANSFERENCIA"),o.k0s()()()()()(),o.nrm(157,"hr",58),o.j41(158,"div",0)(159,"div",36)(160,"h6"),o.nrm(161,"i",59),o.EFF(162,"\xa0Productos Suministrados"),o.k0s(),o.j41(163,"p",10),o.EFF(164,"Selecciona los productos que este proveedor suministra."),o.k0s(),o.j41(165,"div",60),o.nrm(166,"input",61),o.k0s(),o.j41(167,"div",62),o.DNE(168,S,3,3,"label",63),o.k0s()()()(),o.j41(169,"div",64)(170,"button",65),o.EFF(171,"Cancelar"),o.k0s(),o.j41(172,"button",66),o.EFF(173),o.k0s()()()()()(),o.EFF(174,">\n")),2&r){let a,d;o.R7$(15),o.JRh(t.totalProductos),o.R7$(7),o.JRh(t.productosBajosEnStock),o.R7$(7),o.Y8G("formControl",t.proveedorSearch),o.R7$(1),o.Y8G("formControl",t.categoryFilter),o.R7$(3),o.Y8G("ngForOf",t.categorias),o.R7$(2),o.Y8G("ngIf",0===t.filteredProveedores.length),o.R7$(1),o.Y8G("ngForOf",t.filteredProveedores),o.R7$(4),o.Y8G("formGroup",t.proveedorForm),o.R7$(3),o.SpI(" ",null!=(a=t.proveedorForm.get("id"))&&a.value?"Editar Proveedor":"Nuevo Proveedor"," "),o.R7$(123),o.Y8G("formControl",t.productSearch),o.R7$(2),o.Y8G("ngForOf",t.productosFormArray.controls),o.R7$(4),o.Y8G("disabled",t.proveedorForm.invalid),o.R7$(1),o.SpI(" ",null!=(d=t.proveedorForm.get("id"))&&d.value?"Actualizar Proveedor":"Crear Proveedor"," ")}},dependencies:[u.YU,u.Sq,u.bT,i.qT,i.xH,i.y7,i.me,i.Q0,i.Zm,i.wz,i.BC,i.cb,i.l_,i.j4,i.JD,i.$R,i.v8]})}}return s})()}];let I=(()=>{class s{static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275mod=o.$C({type:s})}static{this.\u0275inj=o.G2t({imports:[f.iI.forChild($),f.iI]})}}return s})(),A=(()=>{class s{static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275mod=o.$C({type:s})}static{this.\u0275inj=o.G2t({imports:[I,h.PrivateModule,u.MD,i.X1,i.YN]})}}return s})()}}]);