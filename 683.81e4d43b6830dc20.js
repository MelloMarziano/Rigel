"use strict";(self.webpackChunkrigel=self.webpackChunkrigel||[]).push([[683],{3683:(mt,y,f)=>{f.r(y),f.d(y,{InventarioPageModule:()=>gt});var S=f(2432),m=f(9417),C=f(177),E=f(8498),_=f(467),s=f(2418),R=f(8359),j=f(8032),l=f.n(j),t=f(7705),A=f(4441);function w(i,c){if(1&i&&(t.j41(0,"option",40),t.EFF(1),t.k0s()),2&i){const e=c.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function T(i,c){if(1&i&&(t.j41(0,"option",40),t.EFF(1),t.k0s()),2&i){const e=c.$implicit;t.Y8G("value",e.id),t.R7$(1),t.SpI(" ",e.nombre," ")}}function $(i,c){1&i&&t.nrm(0,"span",41)}function z(i,c){1&i&&t.nrm(0,"i",42)}function G(i,c){1&i&&(t.j41(0,"div",6)(1,"div",43)(2,"div",44)(3,"div",45),t.nrm(4,"i",46),t.k0s(),t.j41(5,"h4",47),t.EFF(6,"No hay inventario para esta fecha"),t.k0s(),t.j41(7,"p",48),t.EFF(8," Selecciona una fecha y crea un nuevo inventario o busca uno existente "),t.k0s()()()())}function D(i,c){1&i&&t.nrm(0,"span",41)}function N(i,c){1&i&&t.nrm(0,"i",81)}function Y(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",6)(1,"div",43)(2,"div",73),t.nrm(3,"i",74),t.j41(4,"div",75)(5,"strong"),t.EFF(6,"Inventario en borrador"),t.k0s(),t.EFF(7," - Este inventario no est\xe1 finalizado. Recuerda guardarlo o cancelarlo. "),t.k0s(),t.j41(8,"div",76)(9,"button",77),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.cancelarInventario())}),t.nrm(10,"i",78),t.EFF(11," Cancelar "),t.k0s(),t.j41(12,"button",79),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.guardarInventario())}),t.DNE(13,D,1,0,"span",19),t.DNE(14,N,1,0,"i",80),t.EFF(15),t.k0s()()()()()}if(2&i){const e=t.XpG(2);t.R7$(9),t.Y8G("disabled",e.isSaving),t.R7$(3),t.Y8G("disabled",e.isSaving),t.R7$(1),t.Y8G("ngIf",e.isSaving),t.R7$(1),t.Y8G("ngIf",!e.isSaving),t.R7$(1),t.SpI(" ",e.isSaving?"Guardando...":"Finalizar Inventario"," ")}}function B(i,c){if(1&i&&(t.j41(0,"div",82)(1,"div",43)(2,"div",63)(3,"span",83),t.nrm(4,"i",84),t.EFF(5," Inventario Finalizado "),t.k0s(),t.j41(6,"small",85),t.EFF(7),t.nI1(8,"date"),t.k0s()()()()),2&i){const e=t.XpG(2);t.R7$(7),t.SpI(" Finalizado el ",t.i5U(8,1,e.inventarioActual.fechaActualizacion,"dd/MM/yyyy HH:mm")," ")}}function U(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",88)(1,"div",89),t.bIt("click",function(){const o=t.eBV(e).$implicit,r=t.XpG(3);return t.Njj(r.filtrarPorFamilia(o.id||""))}),t.j41(2,"div",90)(3,"div",91)(4,"div",99),t.nrm(5,"i",100),t.k0s(),t.j41(6,"h6",94),t.EFF(7),t.k0s(),t.j41(8,"div",95)(9,"span",101),t.EFF(10),t.k0s(),t.j41(11,"small",85),t.EFF(12),t.k0s(),t.j41(13,"small",97),t.EFF(14),t.k0s()()()()()()}if(2&i){const e=c.$implicit,n=t.XpG(3);t.R7$(1),t.AVh("selected",n.familiaSeleccionada===e.id),t.R7$(6),t.JRh(e.nombre),t.R7$(3),t.SpI(" ",n.getProductosPorFamilia(e.id||"").length," productos "),t.R7$(2),t.SpI(" Sin contar: ",n.getProductosSinContarPorFamilia(e.id||"")," "),t.R7$(2),t.SpI(" COSTO FAMILIA: ",n.formatearMoneda(n.getCostoTotalPorFamilia(e.id||""))," ")}}function X(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",82)(1,"div",43)(2,"h6",47),t.nrm(3,"i",86),t.EFF(4,"Filtrar por Familia "),t.k0s(),t.j41(5,"div",87)(6,"div",88)(7,"div",89),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.filtrarPorFamilia(""))}),t.j41(8,"div",90)(9,"div",91)(10,"div",92),t.nrm(11,"i",93),t.k0s(),t.j41(12,"h6",94),t.EFF(13,"Todas las familias"),t.k0s(),t.j41(14,"div",95)(15,"span",96),t.EFF(16),t.k0s(),t.j41(17,"small",85),t.EFF(18),t.k0s(),t.j41(19,"small",97),t.EFF(20),t.k0s()()()()()(),t.DNE(21,U,15,6,"div",98),t.k0s()()()}if(2&i){const e=t.XpG(2);t.R7$(7),t.AVh("selected",""===e.familiaSeleccionada),t.R7$(9),t.SpI(" ",e.inventarioActual.productos.length," productos "),t.R7$(2),t.SpI(" Sin contar: ",e.getTotalProductosSinContar()," "),t.R7$(2),t.SpI(" COSTO TOTAL: ",e.formatearMoneda(e.getCostoTotalInventario())," "),t.R7$(1),t.Y8G("ngForOf",e.getFamiliasConProductos())("ngForTrackBy",e.trackByFamilia)}}function V(i,c){1&i&&(t.j41(0,"span",102),t.EFF(1,"Borrador"),t.k0s())}function L(i,c){1&i&&(t.j41(0,"span",103),t.EFF(1,"Finalizado"),t.k0s())}function J(i,c){if(1&i&&(t.j41(0,"span",104),t.EFF(1),t.k0s()),2&i){const e=t.XpG(2);t.R7$(1),t.JRh(e.getNombreFamiliaSeleccionada())}}function H(i,c){1&i&&t.nrm(0,"span",41)}function Z(i,c){1&i&&t.nrm(0,"i",106)}function K(i,c){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"button",77),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.cancelarInventario())}),t.nrm(2,"i",78),t.EFF(3," Cancelar "),t.k0s(),t.j41(4,"button",79),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.guardarInventario())}),t.DNE(5,H,1,0,"span",19),t.DNE(6,Z,1,0,"i",105),t.EFF(7),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(1),t.Y8G("disabled",e.isSaving),t.R7$(3),t.Y8G("disabled",e.isSaving),t.R7$(1),t.Y8G("ngIf",e.isSaving),t.R7$(1),t.Y8G("ngIf",!e.isSaving),t.R7$(1),t.SpI(" ",e.isSaving?"Finalizando...":"Finalizar Inventario"," ")}}function Q(i,c){1&i&&(t.j41(0,"div")(1,"span",53),t.nrm(2,"i",107),t.EFF(3," Inventario finalizado - Solo lectura "),t.k0s()())}function W(i,c){if(1&i&&(t.j41(0,"small"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&i){const e=t.XpG().$implicit;t.HbH(e.diferencia>0?"text-success":"text-danger"),t.R7$(1),t.Lme(" ",e.diferencia>0?"+":"","",t.i5U(2,4,e.diferencia,"1.1-1")," ")}}function q(i,c){if(1&i){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"div")(3,"strong"),t.EFF(4),t.k0s(),t.nrm(5,"br"),t.j41(6,"small",85),t.EFF(7),t.k0s()()(),t.j41(8,"td")(9,"span",96),t.EFF(10),t.k0s()(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td")(14,"span"),t.EFF(15),t.nI1(16,"number"),t.k0s()(),t.j41(17,"td"),t.EFF(18),t.nI1(19,"currency"),t.k0s(),t.j41(20,"td")(21,"input",108),t.bIt("ngModelChange",function(a){const r=t.eBV(e).$implicit;return t.Njj(r.stockContado=a)})("ngModelChange",function(){const o=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.calcularValorTotal(o))}),t.k0s(),t.DNE(22,W,3,7,"small",109),t.k0s(),t.j41(23,"td")(24,"strong"),t.EFF(25),t.nI1(26,"currency"),t.k0s()()()}if(2&i){const e=c.$implicit,n=t.XpG(2);t.R7$(4),t.JRh(e.nombre),t.R7$(3),t.JRh(e.unidadMedida),t.R7$(3),t.JRh(e.categoria),t.R7$(2),t.JRh(e.proveedor),t.R7$(2),t.HbH(n.getStockClass(e.stockActual)),t.R7$(1),t.SpI(" ",t.i5U(16,16,e.stockActual,"1.1-1")," "),t.R7$(3),t.SpI(" ",t.ii3(19,19,e.costoUnitario,"EUR","symbol","1.2-2")," "),t.R7$(3),t.AVh("is-invalid",0!==e.diferencia),t.Y8G("ngModel",e.stockContado)("disabled","finalizado"===n.inventarioActual.estado),t.R7$(1),t.Y8G("ngIf",0!==e.diferencia),t.R7$(2),t.HbH(0!==e.diferencia?"text-danger":"text-success"),t.R7$(1),t.SpI(" ",t.ii3(26,24,e.valorTotal,"EUR","symbol","1.0-0")," ")}}function tt(i,c){if(1&i&&(t.j41(0,"div"),t.DNE(1,Y,16,5,"div",21),t.DNE(2,B,9,4,"div",49),t.j41(3,"div",6)(4,"div",50)(5,"div",8)(6,"div",51)(7,"div",52)(8,"span",53),t.EFF(9,"Inversi\xf3n Total"),t.k0s(),t.nrm(10,"i",54),t.k0s(),t.j41(11,"h3",55),t.EFF(12),t.nI1(13,"currency"),t.k0s()()()(),t.j41(14,"div",50)(15,"div",8)(16,"div",51)(17,"div",52)(18,"span",53),t.EFF(19,"Total Productos"),t.k0s(),t.nrm(20,"i",56),t.k0s(),t.j41(21,"h3",57),t.EFF(22),t.k0s()()()(),t.j41(23,"div",50)(24,"div",8)(25,"div",51)(26,"div",52)(27,"span",53),t.EFF(28,"Total Unidades"),t.k0s(),t.nrm(29,"i",58),t.k0s(),t.j41(30,"h3",59),t.EFF(31),t.nI1(32,"number"),t.k0s()()()(),t.j41(33,"div",50)(34,"div",8)(35,"div",51)(36,"div",52)(37,"span",53),t.EFF(38,"Costo Promedio"),t.k0s(),t.nrm(39,"i",60),t.k0s(),t.j41(40,"h3",61),t.EFF(41),t.nI1(42,"currency"),t.k0s()()()()(),t.DNE(43,X,22,7,"div",49),t.j41(44,"div",6)(45,"div",43)(46,"div",8)(47,"div",62)(48,"div",63)(49,"h5",64),t.EFF(50),t.DNE(51,V,2,0,"span",65),t.DNE(52,L,2,0,"span",66),t.DNE(53,J,2,1,"span",67),t.k0s(),t.DNE(54,K,8,5,"div",22),t.DNE(55,Q,4,0,"div",22),t.k0s()(),t.j41(56,"div",68)(57,"div",69)(58,"table",70)(59,"thead",71)(60,"tr")(61,"th"),t.EFF(62,"PRODUCTO"),t.k0s(),t.j41(63,"th"),t.EFF(64,"CATEGOR\xcdA"),t.k0s(),t.j41(65,"th"),t.EFF(66,"PROVEEDOR"),t.k0s(),t.j41(67,"th"),t.EFF(68,"STOCK ACTUAL"),t.k0s(),t.j41(69,"th"),t.EFF(70,"COSTO UNITARIO"),t.k0s(),t.j41(71,"th"),t.EFF(72,"STOCK CONTADO"),t.k0s(),t.j41(73,"th"),t.EFF(74,"VALOR TOTAL"),t.k0s()()(),t.j41(75,"tbody"),t.DNE(76,q,27,29,"tr",72),t.k0s()()()()()()()()),2&i){const e=t.XpG();t.R7$(1),t.Y8G("ngIf","borrador"===e.inventarioActual.estado),t.R7$(1),t.Y8G("ngIf","finalizado"===e.inventarioActual.estado),t.R7$(10),t.SpI(" ",t.ii3(13,16,e.inventarioActual.inversionTotal,"EUR","symbol","1.0-0")," "),t.R7$(10),t.SpI(" ",e.inventarioActual.totalProductos," "),t.R7$(9),t.SpI(" ",t.i5U(32,21,e.inventarioActual.totalUnidades,"1.1-1")," "),t.R7$(10),t.SpI(" ",t.ii3(42,24,e.inventarioActual.costoPromedio,"EUR","symbol","1.0-0")," "),t.R7$(2),t.Y8G("ngIf",e.familiasDisponibles.length>0),t.R7$(7),t.Lme(" Productos del Inventario (",e.productosFiltrados.length," de ",e.inventarioActual.productos.length,") "),t.R7$(1),t.Y8G("ngIf","borrador"===e.inventarioActual.estado),t.R7$(1),t.Y8G("ngIf","finalizado"===e.inventarioActual.estado),t.R7$(1),t.Y8G("ngIf",e.familiaSeleccionada),t.R7$(1),t.Y8G("ngIf","borrador"===e.inventarioActual.estado),t.R7$(1),t.Y8G("ngIf","finalizado"===e.inventarioActual.estado),t.R7$(21),t.Y8G("ngForOf",e.productosFiltrados)("ngForTrackBy",e.trackByProducto)}}function et(i,c){1&i&&(t.j41(0,"div",6)(1,"div",43)(2,"div",44)(3,"div",110)(4,"span",111),t.EFF(5,"Cargando..."),t.k0s()(),t.j41(6,"h4",47),t.EFF(7,"Creando inventario..."),t.k0s(),t.j41(8,"p",85),t.EFF(9," Cargando productos y preparando el inventario para la fecha seleccionada "),t.k0s()()()())}function nt(i,c){if(1&i&&(t.j41(0,"div",120)(1,"small",121),t.EFF(2),t.k0s()()),2&i){const e=t.XpG().$implicit,n=t.XpG();t.R7$(2),t.Lme(" ",e.familias.length," familias: ",n.getFamiliasNombres(e.familias)," ")}}function it(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",112)(1,"div",113),t.bIt("click",function(){const o=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.seleccionarCategoria(o.id||""))}),t.j41(2,"div",9)(3,"div",114)(4,"div",115),t.nrm(5,"i"),t.k0s(),t.j41(6,"div",75)(7,"h6",116),t.EFF(8),t.k0s(),t.j41(9,"small",85),t.EFF(10),t.k0s(),t.DNE(11,nt,3,2,"div",117),t.k0s(),t.j41(12,"div",118),t.nrm(13,"i",119),t.k0s()()()()()}if(2&i){const e=c.$implicit,n=t.XpG();t.R7$(1),t.AVh("selected",n.categoriaSeleccionada===e.id),t.R7$(3),t.xc7("background-color",e.colorFondo),t.R7$(1),t.HbH("bi "+e.icono+" text-white"),t.R7$(3),t.JRh(e.nombre),t.R7$(2),t.SpI("",n.getTotalProductosCategoria(e.id)," productos"),t.R7$(1),t.Y8G("ngIf",e.familias&&e.familias.length>0),t.R7$(2),t.HbH(n.categoriaSeleccionada===e.id?"bi-check-circle-fill text-success":"bi-circle text-muted")}}function at(i,c){if(1&i&&(t.j41(0,"span",129),t.EFF(1),t.k0s()),2&i){const e=c.$implicit,n=t.XpG(3);t.R7$(1),t.Lme(" ",e.nombre," (",n.getProductosPorFamiliaEnCategoria(e.id||"").length," productos) ")}}function ot(i,c){if(1&i&&(t.j41(0,"div",126)(1,"h6",123),t.EFF(2,"Familias incluidas:"),t.k0s(),t.j41(3,"div",127),t.DNE(4,at,2,2,"span",128),t.k0s()()),2&i){const e=t.XpG(2);t.R7$(4),t.Y8G("ngForOf",e.getFamiliasCategoria())}}function rt(i,c){if(1&i&&(t.j41(0,"div",43)(1,"div",122)(2,"h6",123),t.nrm(3,"i",124),t.EFF(4," Categor\xeda seleccionada: "),t.j41(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"p",123),t.EFF(8," Se incluir\xe1n "),t.j41(9,"strong"),t.EFF(10),t.k0s(),t.EFF(11," productos de esta categor\xeda en el inventario. "),t.k0s(),t.DNE(12,ot,5,1,"div",125),t.k0s()()),2&i){const e=t.XpG();t.R7$(6),t.JRh(e.getNombreCategoriaSeleccionada()),t.R7$(4),t.JRh(e.getTotalProductosCategoria()),t.R7$(2),t.Y8G("ngIf",e.getFamiliasCategoria().length>0)}}function ct(i,c){1&i&&t.nrm(0,"span",41)}function st(i,c){1&i&&t.nrm(0,"i",130)}const lt=[{path:"",component:(()=>{class i{constructor(e,n){this.firestore=e,this.authService=n,this.isLoading=!1,this.isCreatingInventory=!1,this.isSaving=!1,this.inventarioActual=null,this.productos=[],this.categorias=[],this.proveedores=[],this.fechaSeleccionada=new Date,this.fechaFiltro=new m.MJ((new Date).toISOString().split("T")[0]),this.categoriaFiltro=new m.MJ(""),this.proveedorFiltro=new m.MJ(""),this.categoriaSeleccionada="",this.familiasDisponibles=[],this.familiaSeleccionada="",this.productosFiltrados=[],this.subscriptions=new R.yU}convertirFecha(e){if(e){if(e instanceof Date)return e;if("object"==typeof e&&"toDate"in e)return e.toDate();if("string"==typeof e)return new Date(e)}}limpiarObjetoParaFirebase(e){const n={};for(const[a,o]of Object.entries(e))null!=o&&(n[a]=Array.isArray(o)?o.map(r=>"object"==typeof r?this.limpiarObjetoParaFirebase(r):r):"object"==typeof o&&null!==o?this.limpiarObjetoParaFirebase(o):o);return n}ngOnInit(){this.authService.getCurrentUser()?(this.cargarDatosIniciales(),this.setupFiltros(),this.buscarInventario()):l().fire("Error","Usuario no autenticado","error")}ngOnDestroy(){this.subscriptions.unsubscribe()}setupFiltros(){this.subscriptions.add(this.fechaFiltro.valueChanges.subscribe(e=>{if(e)try{this.fechaSeleccionada=new Date(e)}catch{this.fechaSeleccionada=new Date}}))}cargarDatosIniciales(){var e=this;return(0,_.A)(function*(){try{const n=(0,s.rJ)(e.firestore,"productos");e.subscriptions.add((0,s.xs)(n,{idField:"id"}).subscribe({next:r=>{e.productos=r.filter(u=>!u.esCombinado)},error:r=>{l().fire("Error","Error al cargar productos","error")}}));const a=(0,s.rJ)(e.firestore,"categorias");e.subscriptions.add((0,s.xs)(a,{idField:"id"}).subscribe({next:r=>{e.categorias=r,e.inventarioActual&&(e.configurarFamiliasDisponibles(),e.aplicarFiltroFamilia())},error:r=>{l().fire("Error","Error al cargar categor\xedas","error")}}));const o=(0,s.rJ)(e.firestore,"proveedores");e.subscriptions.add((0,s.xs)(o,{idField:"id"}).subscribe({next:r=>{e.proveedores=r},error:r=>{l().fire("Error","Error al cargar proveedores","error")}}))}catch{l().fire("Error","Error al cargar los datos iniciales","error")}})()}buscarInventario(){var e=this;return(0,_.A)(function*(){e.isLoading=!0;try{const n=e.fechaSeleccionada.toISOString().split("T")[0],a=(0,s.rJ)(e.firestore,"inventarios"),o=(0,s.P)(a,(0,s._M)("fecha","==",n)),r=yield(0,s.GG)(o);if(r.empty)e.inventarioActual=null;else{const u=r.docs.filter(v=>!v.data().eliminado);if(u.length>0){const v=u.filter(h=>"borrador"===h.data().estado),p=v.length>0?v[0]:u[0];e.inventarioActual={id:p.id,...p.data()},e.inventarioActual.fecha=e.convertirFecha(e.inventarioActual.fecha)||e.inventarioActual.fecha,e.inventarioActual.fechaActualizacion=e.convertirFecha(e.inventarioActual.fechaActualizacion),e.inventarioActual.fechaCreacion=e.convertirFecha(e.inventarioActual.fechaCreacion),"borrador"===e.inventarioActual.estado&&setTimeout(()=>{const P=e.categorias.find(O=>O.id===e.inventarioActual?.categoriaId)?.nombre||"Sin categor\xeda";l().fire({title:"Inventario en borrador encontrado",text:`Se ha cargado un inventario en borrador de ${P} para esta fecha. Puedes continuar edit\xe1ndolo.`,icon:"info",confirmButtonText:"Continuar",timer:3e3,timerProgressBar:!0})},1e3)}else e.inventarioActual=null}e.inventarioActual&&(e.configurarFamiliasDisponibles(),e.aplicarFiltroFamilia())}catch{e.inventarioActual=null}finally{e.isLoading=!1}})()}crearNuevoInventario(){var e=this;return(0,_.A)(function*(){if(!e.inventarioActual||(yield l().fire({title:"\xbfCrear nuevo inventario?",text:"Ya existe un inventario para esta fecha. \xbfDeseas reemplazarlo?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, crear nuevo",cancelButtonText:"Cancelar"})).isConfirmed){e.isCreatingInventory=!0;try{let n=[...e.productos];const a=e.categoriaFiltro.value,o=e.proveedorFiltro.value;a&&(n=n.filter(g=>g.categoriaId===a)),o&&(n=n.filter(g=>g.proveedorId===o));const r=n.map(g=>{const b=e.categorias.find(k=>k.id===g.categoriaId),M=e.proveedores.find(k=>k.id===g.proveedorId);return{productoId:g.id,nombre:g.nombre,categoria:b?.nombre||"Sin categor\xeda",proveedor:M?.nombre||"Sin proveedor",stockActual:g.stock||0,stockContado:null,costoUnitario:g.costo,valorTotal:(g.stock||0)*g.costo,unidadMedida:g.unidadMedida,diferencia:0}}),u=r.reduce((g,b)=>g+b.valorTotal,0),v=r.length,p=r.reduce((g,b)=>g+(b.stockContado??0),0),h=p>0?u/p:0,P={fecha:e.fechaSeleccionada.toISOString().split("T")[0],categoriaId:a||void 0,proveedorId:o||void 0,productos:r,inversionTotal:u,totalProductos:v,totalUnidades:p,costoPromedio:h,fechaCreacion:(0,s.O5)(),usuarioId:e.authService.getCurrentUser()?.id,estado:"borrador"},O=e.limpiarObjetoParaFirebase(P),I=(0,s.rJ)(e.firestore,"inventarios"),x=yield(0,s.gS)(I,O);e.inventarioActual={id:x.id,fecha:e.fechaSeleccionada,categoriaId:a||void 0,proveedorId:o||void 0,productos:r,inversionTotal:u,totalProductos:v,totalUnidades:p,costoPromedio:h,fechaCreacion:new Date,usuarioId:e.authService.getCurrentUser()?.id,estado:"borrador"},a&&e.categorias.find(g=>g.id===a),l().fire("\xa1Creado!",`Inventario creado con ${v} productos. Puedes editarlo y luego finalizarlo.`,"success")}catch{l().fire("Error","Error al crear el inventario","error")}finally{e.isCreatingInventory=!1}}})()}recalcularTotales(){this.inventarioActual&&(this.inventarioActual.inversionTotal=this.inventarioActual.productos.reduce((e,n)=>e+n.valorTotal,0),this.inventarioActual.totalUnidades=this.inventarioActual.productos.reduce((e,n)=>e+(n.stockContado??0),0),this.inventarioActual.costoPromedio=this.inventarioActual.totalUnidades>0?this.inventarioActual.inversionTotal/this.inventarioActual.totalUnidades:0)}guardarInventario(){var e=this;return(0,_.A)(function*(){if(e.inventarioActual&&("borrador"!==e.inventarioActual.estado||(yield l().fire({title:"\xbfFinalizar inventario?",text:"Una vez finalizado, no podr\xe1s editarlo. \xbfEst\xe1s seguro?",icon:"question",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, finalizar",cancelButtonText:"Cancelar"})).isConfirmed)){e.isSaving=!0;try{const n={...e.inventarioActual,fecha:e.fechaSeleccionada.toISOString().split("T")[0],fechaActualizacion:(0,s.O5)(),estado:"finalizado"},a=e.limpiarObjetoParaFirebase(n);if(e.inventarioActual.id){const o=(0,s.H9)(e.firestore,"inventarios",e.inventarioActual.id);yield(0,s.mZ)(o,a),e.inventarioActual.estado="finalizado",e.inventarioActual.fechaActualizacion=new Date}else{const o=(0,s.rJ)(e.firestore,"inventarios"),r=yield(0,s.gS)(o,a);e.inventarioActual.id=r.id,e.inventarioActual.estado="finalizado"}l().fire("\xa1Finalizado!","Inventario finalizado exitosamente","success")}catch{l().fire("Error","Error al finalizar el inventario","error")}finally{e.isSaving=!1}}})()}getStockClass(e){return e<=0?"text-danger fw-bold":e<=5?"text-warning fw-bold":"text-success fw-bold"}trackByProducto(e,n){return n.productoId}cancelarInventario(){var e=this;return(0,_.A)(function*(){if(e.inventarioActual?.id){if((yield l().fire({title:"\xbfCancelar inventario?",text:"Se eliminar\xe1 completamente el inventario en borrador. Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, eliminar",cancelButtonText:"No cancelar"})).isConfirmed){e.isSaving=!0;try{const a=(0,s.H9)(e.firestore,"inventarios",e.inventarioActual.id);yield(0,s.kd)(a),e.inventarioActual=null,e.familiasDisponibles=[],e.familiaSeleccionada="",e.productosFiltrados=[],l().fire({title:"\xa1Eliminado!",text:"El inventario ha sido eliminado completamente",icon:"success",timer:2e3,timerProgressBar:!0})}catch{l().fire("Error","Error al eliminar el inventario","error")}finally{e.isSaving=!1}}}else l().fire("Error","No hay inventario para cancelar","error")})()}calcularValorTotal(e){if("finalizado"===this.inventarioActual?.estado)return;const n=e.stockContado??0;e.diferencia=n-e.stockActual,e.valorTotal=n*e.costoUnitario,this.recalcularTotales(),"borrador"===this.inventarioActual?.estado&&this.autoGuardarBorrador()}autoGuardarBorrador(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.guardarBorrador()},2e3)}guardarBorrador(){var e=this;return(0,_.A)(function*(){if(e.inventarioActual?.id&&"borrador"===e.inventarioActual.estado)try{const n=(0,s.H9)(e.firestore,"inventarios",e.inventarioActual.id);yield(0,s.mZ)(n,{productos:e.inventarioActual.productos,inversionTotal:e.inventarioActual.inversionTotal,totalUnidades:e.inventarioActual.totalUnidades,costoPromedio:e.inventarioActual.costoPromedio,fechaActualizacion:(0,s.O5)()})}catch{}})()}abrirModalNuevoInventario(){this.categoriaSeleccionada="";const e=document.getElementById("modalNuevoInventario");e&&(this.modal=new bootstrap.Modal(e),this.modal.show())}cerrarModalNuevoInventario(){this.modal&&this.modal.hide(),this.categoriaSeleccionada=""}seleccionarCategoria(e){this.categoriaSeleccionada=e}getNombreCategoriaSeleccionada(){return this.categorias.find(n=>n.id===this.categoriaSeleccionada)?.nombre||""}getTotalProductosCategoria(e){const n=e||this.categoriaSeleccionada;return n?this.productos.filter(a=>a.categoriaId===n&&!a.esCombinado).length:0}getFamiliasCategoria(){return this.categorias.find(n=>n.id===this.categoriaSeleccionada)?.familias||[]}getProductosPorFamiliaEnCategoria(e){return this.productos.filter(n=>n.categoriaId===this.categoriaSeleccionada&&n.familiaId===e&&!n.esCombinado)}getFamiliasNombres(e){return e&&0!==e.length?e.map(n=>n.nombre).join(", "):""}crearInventarioConSeleccion(){var e=this;return(0,_.A)(function*(){if(e.categoriaSeleccionada)if(0!==e.productos.length)if(0!==e.categorias.length){if(e.inventarioActual){const a="borrador"===e.inventarioActual.estado?"en borrador":"finalizado";if(!(yield l().fire({title:"\xbfCrear nuevo inventario?",text:`Ya existe un inventario ${a} para esta fecha. \xbfDeseas reemplazarlo?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"S\xed, reemplazar",cancelButtonText:"Cancelar"})).isConfirmed)return;if(e.inventarioActual.id)try{const r=(0,s.H9)(e.firestore,"inventarios",e.inventarioActual.id);yield(0,s.kd)(r)}catch(r){console.error("Error eliminando inventario anterior:",r)}}e.isCreatingInventory=!0;try{const n=e.authService.getCurrentUser();if(!n?.id)return void l().fire("Error","Usuario no autenticado","error");const a=e.productos.filter(d=>d.categoriaId===e.categoriaSeleccionada&&!d.esCombinado);if(0===a.length)return void l().fire("Error","No hay productos disponibles en la categor\xeda seleccionada.","error");const o=a.map(d=>{const F=e.categorias.find(M=>M.id===d.categoriaId),g=e.proveedores.find(M=>M.id===d.proveedorId),b={productoId:d.id||"",nombre:d.nombre||"",categoria:F?.nombre||"Sin categor\xeda",proveedor:g?.nombre||"Sin proveedor",stockActual:d.stock||0,stockContado:null,costoUnitario:d.costo||0,valorTotal:(d.stock||0)*(d.costo||0),unidadMedida:d.unidadMedida||"",diferencia:0};return d.familiaId&&(b.familiaId=d.familiaId),b}),r=o.reduce((d,F)=>d+F.valorTotal,0),u=o.length,v=o.reduce((d,F)=>d+(F.stockContado??0),0),p=v>0?r/v:0,h={fecha:e.fechaSeleccionada.toISOString().split("T")[0],categoriaId:e.categoriaSeleccionada||"",productos:o,inversionTotal:r||0,totalProductos:u||0,totalUnidades:v||0,costoPromedio:p||0,fechaCreacion:(0,s.O5)(),usuarioId:n.id||"",estado:"borrador"},P=e.limpiarObjetoParaFirebase(h),O=(0,s.rJ)(e.firestore,"inventarios"),I=yield(0,s.gS)(O,P);e.inventarioActual={id:I.id,fecha:e.fechaSeleccionada,categoriaId:e.categoriaSeleccionada,productos:o,inversionTotal:r,totalProductos:u,totalUnidades:v,costoPromedio:p,fechaCreacion:new Date,usuarioId:n.id,estado:"borrador"},e.configurarFamiliasDisponibles(),e.aplicarFiltroFamilia(),e.cerrarModalNuevoInventario();const x=e.getNombreCategoriaSeleccionada();l().fire("\xa1Creado!",`Inventario de ${x} creado con ${u} productos. Puedes editarlo y luego finalizarlo.`,"success")}catch(n){let a="Error al crear el inventario";n?.message&&(a+=": "+n.message),l().fire("Error",a,"error")}finally{e.isCreatingInventory=!1}}else l().fire("Error","No se han cargado las categor\xedas. Intenta recargar la p\xe1gina.","error");else l().fire("Error","No se han cargado los productos. Intenta recargar la p\xe1gina.","error");else l().fire("Error","Selecciona una categor\xeda para el inventario","error")})()}configurarFamiliasDisponibles(){if(!this.inventarioActual)return;const e=new Set,n=new Map,a=this.categorias.find(o=>o.id===this.inventarioActual?.categoriaId);a?.familias&&a.familias.forEach(o=>{o.id&&!e.has(o.id)&&(e.add(o.id),n.set(o.id,o))}),this.familiasDisponibles=Array.from(n.values())}filtrarPorFamilia(e){this.familiaSeleccionada=e,this.aplicarFiltroFamilia()}aplicarFiltroFamilia(){this.inventarioActual&&(this.productosFiltrados=this.familiaSeleccionada?this.inventarioActual.productos.filter(e=>this.productos.find(a=>a.id===e.productoId)?.familiaId===this.familiaSeleccionada):[...this.inventarioActual.productos])}getProductosPorFamilia(e){return this.inventarioActual?this.inventarioActual.productos.filter(n=>this.productos.find(o=>o.id===n.productoId)?.familiaId===e):[]}getNombreFamiliaSeleccionada(){return this.familiasDisponibles.find(n=>n.id===this.familiaSeleccionada)?.nombre||""}trackByFamilia(e,n){return n.id||""}getProductosSinContarPorFamilia(e){return this.inventarioActual?this.getProductosPorFamilia(e).filter(a=>null==a.stockContado).length:0}getCostoTotalPorFamilia(e){return this.inventarioActual?this.getProductosPorFamilia(e).reduce((a,o)=>a+(o.stockContado??0)*o.costoUnitario,0):0}formatearMoneda(e){return e.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0})}getTotalProductosSinContar(){return this.inventarioActual?this.inventarioActual.productos.filter(e=>null==e.stockContado).length:0}getCostoTotalInventario(){return this.inventarioActual?this.inventarioActual.productos.reduce((e,n)=>e+(n.stockContado??0)*n.costoUnitario,0):0}getFamiliasConProductos(){return this.familiasDisponibles?this.familiasDisponibles.filter(e=>this.getProductosPorFamilia(e.id||"").length>0):[]}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(s._7),t.rXU(A.u))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-inventario-page"]],decls:67,vars:23,consts:[[1,"container-fluid"],[1,"row"],[1,"col-8"],[1,"col","text-end"],[1,"btn","btn-danger",3,"disabled","click"],[1,"bi","bi-plus-lg","me-2"],[1,"row","mt-4"],[1,"col"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"row","align-items-center"],[1,"col-12","col-md-3","mb-2","mb-md-0"],[1,"form-label","small","text-muted"],["type","date",1,"form-control",3,"formControl","value"],[1,"form-select",3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-md-3","text-end","mt-4"],[1,"btn","btn-outline-danger","w-100",3,"disabled","click"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","bi bi-search me-2",4,"ngIf"],["class","row mt-4",4,"ngIf"],[4,"ngIf"],["id","modalNuevoInventario","tabindex","-1","data-bs-backdrop","static",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"bi","bi-clipboard-check","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"col-12","mb-4"],[1,"mb-3"],[1,"bi","bi-tags","me-2"],["class","col-md-6 mb-3",4,"ngFor","ngForOf"],["class","col-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"disabled","click"],["class","bi bi-plus me-2",4,"ngIf"],[3,"value"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-search","me-2"],[1,"col-12"],[1,"text-center","py-5"],[1,"mb-4"],[1,"bi","bi-archive","text-muted",2,"font-size","4rem"],[1,"text-muted","mb-3"],[1,"text-muted","mb-4"],["class","row mt-3",4,"ngIf"],[1,"col-12","col-md-3","mb-3"],[1,"card-body","text-center"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"text-muted","small"],[1,"bi","bi-currency-euro","text-danger"],[1,"text-danger","fw-bold","mb-0"],[1,"bi","bi-box","text-info"],[1,"text-info","fw-bold","mb-0"],[1,"bi","bi-graph-up","text-success"],[1,"text-success","fw-bold","mb-0"],[1,"bi","bi-calculator","text-warning"],[1,"text-warning","fw-bold","mb-0"],[1,"card-header","bg-white","border-0","py-3"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["class","badge bg-warning ms-2",4,"ngIf"],["class","badge bg-success ms-2",4,"ngIf"],["class","badge bg-info ms-2",4,"ngIf"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[4,"ngFor","ngForOf","ngForTrackBy"],["role","alert",1,"alert","alert-warning","d-flex","align-items-center"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"flex-grow-1"],[1,"ms-3"],[1,"btn","btn-outline-secondary","btn-sm","me-2",3,"disabled","click"],[1,"bi","bi-x-lg","me-1"],[1,"btn","btn-danger","btn-sm",3,"disabled","click"],["class","bi bi-save me-1",4,"ngIf"],[1,"bi","bi-save","me-1"],[1,"row","mt-3"],[1,"badge","bg-success","fs-6"],[1,"bi","bi-check-circle","me-1"],[1,"text-muted"],[1,"bi","bi-funnel","me-2"],[1,"row","g-3"],[1,"col-12","col-sm-6","col-md-4","col-lg-3"],[1,"card","familia-filter-card","cursor-pointer","h-100",3,"click"],[1,"card-body","text-center","p-3"],[1,"d-flex","flex-column","align-items-center"],[1,"rounded-circle","bg-primary","bg-opacity-10","p-3","mb-2"],[1,"bi","bi-grid-3x3-gap","text-primary","fs-4"],[1,"card-title","mb-1","fw-bold"],[1,"d-flex","flex-column","gap-1"],[1,"badge","bg-primary","rounded-pill"],[1,"text-success","fw-bold"],["class","col-12 col-sm-6 col-md-4 col-lg-3",4,"ngFor","ngForOf","ngForTrackBy"],[1,"rounded-circle","bg-info","bg-opacity-10","p-3","mb-2"],[1,"bi","bi-collection","text-info","fs-4"],[1,"badge","bg-info","rounded-pill"],[1,"badge","bg-warning","ms-2"],[1,"badge","bg-success","ms-2"],[1,"badge","bg-info","ms-2"],["class","bi bi-save me-2",4,"ngIf"],[1,"bi","bi-save","me-2"],[1,"bi","bi-lock","me-1"],["type","number","step","0.1","min","0","placeholder","Ingrese cantidad contada",1,"form-control","form-control-sm",2,"width","100px",3,"ngModel","disabled","ngModelChange"],[3,"class",4,"ngIf"],["role","status",1,"spinner-border","text-danger","mb-3"],[1,"visually-hidden"],[1,"col-md-6","mb-3"],[1,"card","h-100","cursor-pointer","categoria-card",3,"click"],[1,"d-flex","align-items-center"],[1,"rounded-circle","p-2","me-3"],[1,"mb-1"],["class","mt-1",4,"ngIf"],[1,"ms-2"],[1,"bi","fs-5"],[1,"mt-1"],[1,"text-info"],[1,"alert","alert-success"],[1,"mb-2"],[1,"bi","bi-check-circle","me-2"],["class","mt-3",4,"ngIf"],[1,"mt-3"],[1,"d-flex","flex-wrap","gap-2"],["class","badge bg-primary","style","font-size: 0.85rem; padding: 6px 12px;",4,"ngFor","ngForOf"],[1,"badge","bg-primary",2,"font-size","0.85rem","padding","6px 12px"],[1,"bi","bi-plus","me-2"]],template:function(n,a){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),t.EFF(4,"Gesti\xf3n de Inventario"),t.k0s(),t.j41(5,"span"),t.EFF(6,"Control y conteo de stock por fechas"),t.k0s()(),t.j41(7,"div",3)(8,"button",4),t.bIt("click",function(){return a.abrirModalNuevoInventario()}),t.nrm(9,"i",5),t.EFF(10," Nuevo Inventario "),t.k0s()()(),t.j41(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"div",11)(17,"label",12),t.EFF(18,"Fecha del Inventario"),t.k0s(),t.nrm(19,"input",13),t.nI1(20,"date"),t.k0s(),t.j41(21,"div",11)(22,"label",12),t.EFF(23,"Categor\xeda"),t.k0s(),t.j41(24,"select",14)(25,"option",15),t.EFF(26,"Todas las categor\xedas"),t.k0s(),t.DNE(27,w,2,2,"option",16),t.k0s()(),t.j41(28,"div",11)(29,"label",12),t.EFF(30,"Proveedor"),t.k0s(),t.j41(31,"select",14)(32,"option",15),t.EFF(33,"Todos los proveedores"),t.k0s(),t.DNE(34,T,2,2,"option",16),t.k0s()(),t.j41(35,"div",17)(36,"button",18),t.bIt("click",function(){return a.buscarInventario()}),t.DNE(37,$,1,0,"span",19),t.DNE(38,z,1,0,"i",20),t.EFF(39),t.k0s()()()()()()(),t.DNE(40,G,9,0,"div",21),t.DNE(41,tt,77,29,"div",22),t.DNE(42,et,10,0,"div",21),t.k0s(),t.j41(43,"div",23)(44,"div",24)(45,"div",25)(46,"div",26)(47,"h5",27),t.nrm(48,"i",28),t.EFF(49," Crear Nuevo Inventario "),t.k0s(),t.j41(50,"button",29),t.bIt("click",function(){return a.cerrarModalNuevoInventario()}),t.k0s()(),t.j41(51,"div",30)(52,"div",1)(53,"div",31)(54,"h6",32),t.nrm(55,"i",33),t.EFF(56," Selecciona la categor\xeda para el inventario: "),t.k0s(),t.j41(57,"div",1),t.DNE(58,it,14,11,"div",34),t.k0s()(),t.DNE(59,rt,13,3,"div",35),t.k0s()(),t.j41(60,"div",36)(61,"button",37),t.bIt("click",function(){return a.cerrarModalNuevoInventario()}),t.EFF(62," Cancelar "),t.k0s(),t.j41(63,"button",38),t.bIt("click",function(){return a.crearInventarioConSeleccion()}),t.DNE(64,ct,1,0,"span",19),t.DNE(65,st,1,0,"i",39),t.EFF(66),t.k0s()()()()()),2&n&&(t.R7$(8),t.Y8G("disabled",a.isLoading),t.R7$(11),t.Y8G("formControl",a.fechaFiltro)("value",t.i5U(20,20,a.fechaSeleccionada,"yyyy-MM-dd")),t.R7$(5),t.Y8G("formControl",a.categoriaFiltro),t.R7$(3),t.Y8G("ngForOf",a.categorias),t.R7$(4),t.Y8G("formControl",a.proveedorFiltro),t.R7$(3),t.Y8G("ngForOf",a.proveedores),t.R7$(2),t.Y8G("disabled",a.isLoading),t.R7$(1),t.Y8G("ngIf",a.isLoading),t.R7$(1),t.Y8G("ngIf",!a.isLoading),t.R7$(1),t.SpI(" ",a.isLoading?"Buscando...":"Buscar"," "),t.R7$(1),t.Y8G("ngIf",!a.inventarioActual&&!a.isLoading),t.R7$(1),t.Y8G("ngIf",a.inventarioActual&&!a.isCreatingInventory),t.R7$(1),t.Y8G("ngIf",a.isCreatingInventory),t.R7$(16),t.Y8G("ngForOf",a.categorias),t.R7$(1),t.Y8G("ngIf",a.categoriaSeleccionada),t.R7$(4),t.Y8G("disabled",!a.categoriaSeleccionada||a.isCreatingInventory),t.R7$(1),t.Y8G("ngIf",a.isCreatingInventory),t.R7$(1),t.Y8G("ngIf",!a.isCreatingInventory),t.R7$(1),t.SpI(" ",a.isCreatingInventory?"Creando...":"Crear Inventario"," "))},dependencies:[C.Sq,C.bT,m.xH,m.y7,m.me,m.Q0,m.wz,m.BC,m.VZ,m.l_,m.vS,C.QX,C.oe,C.vh],styles:['.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:#6c757d;border-bottom:2px solid #dee2e6}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle;font-size:.875rem}.form-control-sm[_ngcontent-%COMP%]{font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.75rem}.text-danger.fw-bold[_ngcontent-%COMP%]{color:#dc3545!important}.text-warning.fw-bold[_ngcontent-%COMP%]{color:#ffc107!important}.text-success.fw-bold[_ngcontent-%COMP%]{color:#198754!important}.card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{font-size:.8rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.form-control-sm[_ngcontent-%COMP%]{width:70px!important;font-size:.75rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.65rem;padding:.5rem .25rem}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:.75rem;padding:.5rem .25rem}.card-header[_ngcontent-%COMP%]{padding:.75rem 1rem}.card-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1rem}.card-header[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .5rem}}.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.family-filter-cards[_ngcontent-%COMP%]{margin-bottom:1.5rem}.family-filter-cards[_ngcontent-%COMP%]   .filter-title[_ngcontent-%COMP%]{color:var(--ion-color-dark);font-weight:600;margin-bottom:1rem;font-size:1.1rem}.family-filter-cards[_ngcontent-%COMP%]   .cards-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}@media (max-width: 768px){.family-filter-cards[_ngcontent-%COMP%]   .cards-container[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.75rem}}@media (min-width: 1200px){.family-filter-cards[_ngcontent-%COMP%]   .cards-container[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}}.family-filter-cards[_ngcontent-%COMP%]   .family-card[_ngcontent-%COMP%]{background:white;border:2px solid #e9ecef;border-radius:12px;padding:1rem;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 4px #0000000d}.family-filter-cards[_ngcontent-%COMP%]   .family-card[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);box-shadow:0 4px 12px #0000001a;transform:translateY(-2px)}.family-filter-cards[_ngcontent-%COMP%]   .family-card.active[_ngcontent-%COMP%]{border-color:var(--ion-color-primary);background:linear-gradient(135deg,var(--ion-color-primary-tint) 0%,white 100%);box-shadow:0 4px 16px rgba(var(--ion-color-primary-rgb),.2)}.family-filter-cards[_ngcontent-%COMP%]   .family-card.active[_ngcontent-%COMP%]   .family-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.family-filter-cards[_ngcontent-%COMP%]   .family-card.active[_ngcontent-%COMP%]   .family-name[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:600}.family-filter-cards[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.family-filter-cards[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .family-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--ion-color-medium);transition:color .3s ease}.family-filter-cards[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .family-name[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark);font-size:1rem;transition:all .3s ease;flex:1}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.875rem}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium-shade);font-weight:500}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-weight:600}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value.uncounted[_ngcontent-%COMP%]{color:var(--ion-color-warning);background:var(--ion-color-warning-tint);padding:.25rem .5rem;border-radius:12px;font-size:.75rem}.family-filter-cards[_ngcontent-%COMP%]   .card-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value.cost[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700}@media (max-width: 768px){.familia-filter-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem!important}.familia-filter-card[_ngcontent-%COMP%]   .rounded-circle[_ngcontent-%COMP%]{padding:.75rem!important}.familia-filter-card[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem!important}.familia-filter-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:.9rem}}@media (max-width: 576px){.familia-filter-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:.75rem!important}.familia-filter-card[_ngcontent-%COMP%]   .rounded-circle[_ngcontent-%COMP%]{padding:.5rem!important}.familia-filter-card[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem!important}.familia-filter-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:.85rem}.familia-filter-card[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:.3rem .6rem}}input[type=number][_ngcontent-%COMP%]{text-align:center}input[type=number][_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.bi-archive[_ngcontent-%COMP%]{opacity:.5}.btn-outline-danger[_ngcontent-%COMP%]:hover{background-color:#dc3545;border-color:#dc3545}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}.area-card[_ngcontent-%COMP%], .categoria-card[_ngcontent-%COMP%], .familia-filter-card[_ngcontent-%COMP%]{transition:all .3s ease;border:2px solid transparent}.area-card[_ngcontent-%COMP%]:hover, .categoria-card[_ngcontent-%COMP%]:hover, .familia-filter-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.area-card.selected[_ngcontent-%COMP%], .categoria-card.selected[_ngcontent-%COMP%], .familia-filter-card.selected[_ngcontent-%COMP%]{border-color:var(--bs-primary);background-color:#0d6efd0d;transform:translateY(-2px);box-shadow:0 8px 25px #0d6efd33}.area-card.selected[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%], .categoria-card.selected[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%], .familia-filter-card.selected[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{background-color:transparent}.area-card.selected[_ngcontent-%COMP%]   .rounded-circle[_ngcontent-%COMP%], .categoria-card.selected[_ngcontent-%COMP%]   .rounded-circle[_ngcontent-%COMP%], .familia-filter-card.selected[_ngcontent-%COMP%]   .rounded-circle[_ngcontent-%COMP%]{background-color:#0d6efd26!important}.area-card.selected[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .categoria-card.selected[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .familia-filter-card.selected[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--bs-primary)!important}.area-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:2rem}.area-card[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.area-card[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1)}.categoria-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{transition:all .2s ease}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}@media (max-width: 768px){.area-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem}.btn-group[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.5rem}}@media (max-width: 576px){.area-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1rem}.area-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem!important}.categoria-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:.75rem}}.familia-pills-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;padding:0 .5rem}.familia-pills-scroll[_ngcontent-%COMP%]{display:flex;gap:.75rem;overflow-x:auto;padding:.75rem 0;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none}.familia-pills-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.familia-pills-scroll[_ngcontent-%COMP%]:before, .familia-pills-scroll[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;bottom:0;width:20px;pointer-events:none;z-index:1}.familia-pills-scroll[_ngcontent-%COMP%]:before{left:0;background:linear-gradient(to right,rgb(255,255,255),rgba(255,255,255,0))}.familia-pills-scroll[_ngcontent-%COMP%]:after{right:0;background:linear-gradient(to left,rgb(255,255,255),rgba(255,255,255,0))}.familia-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#f8f9fa;border:1.5px solid #e9ecef;border-radius:25px;cursor:pointer;transition:all .3s ease;white-space:nowrap;flex-shrink:0;min-height:40px;-webkit-user-select:none;user-select:none}.familia-pill[_ngcontent-%COMP%]   .pill-text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#495057}.familia-pill[_ngcontent-%COMP%]   .pill-count[_ngcontent-%COMP%]{background:#6c757d;color:#fff;font-size:.75rem;font-weight:600;padding:.2rem .5rem;border-radius:12px;min-width:24px;text-align:center;line-height:1}.familia-pill[_ngcontent-%COMP%]:hover{background:#e9ecef;border-color:#adb5bd;transform:translateY(-1px);box-shadow:0 2px 8px #0000001a}.familia-pill.active[_ngcontent-%COMP%]{background:var(--bs-primary, #0d6efd);border-color:var(--bs-primary, #0d6efd);box-shadow:0 2px 12px #0d6efd4d}.familia-pill.active[_ngcontent-%COMP%]   .pill-text[_ngcontent-%COMP%]{color:#fff;font-weight:600}.familia-pill.active[_ngcontent-%COMP%]   .pill-count[_ngcontent-%COMP%]{background:rgba(255,255,255,.2);color:#fff;font-weight:700}.familia-pill.active[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 16px #0d6efd66}.familia-pill[_ngcontent-%COMP%]:active{transform:scale(.98)}@media (max-width: 768px){.familia-pills-container[_ngcontent-%COMP%]{margin:0 -1rem 1rem;padding:0 1rem}.familia-pill[_ngcontent-%COMP%]{padding:.4rem .8rem;min-height:36px}.familia-pill[_ngcontent-%COMP%]   .pill-text[_ngcontent-%COMP%]{font-size:.8rem}.familia-pill[_ngcontent-%COMP%]   .pill-count[_ngcontent-%COMP%]{font-size:.7rem;padding:.15rem .4rem;min-width:20px}}@media (max-width: 576px){.familia-pills-scroll[_ngcontent-%COMP%]{gap:.5rem;padding:.5rem 0}.familia-pill[_ngcontent-%COMP%]{padding:.35rem .7rem;min-height:32px}.familia-pill[_ngcontent-%COMP%]   .pill-text[_ngcontent-%COMP%]{font-size:.75rem}.familia-pill[_ngcontent-%COMP%]   .pill-count[_ngcontent-%COMP%]{font-size:.65rem;padding:.1rem .35rem;min-width:18px}}.container-fluid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}*[_ngcontent-%COMP%]{-webkit-tap-highlight-color:transparent}@media (max-width: 576px){.btn[_ngcontent-%COMP%]{touch-action:manipulation}.row[_ngcontent-%COMP%]:first-child{margin-bottom:1rem}.row[_ngcontent-%COMP%]:first-child   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.25rem}.row[_ngcontent-%COMP%]:first-child   span[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.card-body[_ngcontent-%COMP%]{padding:.75rem}.form-label[_ngcontent-%COMP%]{font-size:.8rem;margin-bottom:.25rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .5rem}}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.scroll-indicator[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);background:linear-gradient(to left,rgba(255,255,255,.9),rgba(255,255,255,0));padding:.5rem .75rem .5rem 1.5rem;pointer-events:none;z-index:2}.scroll-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#6c757d;font-size:.875rem;animation:_ngcontent-%COMP%_bounce-horizontal 2s infinite}@keyframes _ngcontent-%COMP%_bounce-horizontal{0%,20%,50%,80%,to{transform:translate(0)}40%{transform:translate(3px)}60%{transform:translate(1px)}}']})}}return i})()}];let dt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[E.iI.forChild(lt),E.iI]})}}return i})(),gt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[dt,S.PrivateModule,C.MD,m.X1,m.YN]})}}return i})()}}]);